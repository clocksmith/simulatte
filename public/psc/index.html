<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PSC ⚭ CSP - Personality Shape Composer</title>
  <style>
    body {
      margin: 0;
      background: #050714;
      color: #a0aec0;
      font-family: 'Courier New', monospace;
      overflow: hidden;
      user-select: none;
    }

    .container {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: row;
    }

    #canvas-container {
      flex: 1;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    canvas {
      max-width: 100%;
      max-height: 100%;
    }

    .ui-layer {
      width: 400px;
      flex-shrink: 0;
      z-index: 10;
      background: rgba(10, 14, 39, 0.9);
      backdrop-filter: blur(12px);
      padding: 25px;
      border-left: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: -10px 0 40px rgba(0, 0, 0, 0.6);
      overflow-y: auto;
      overflow-x: hidden;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding-bottom: 10px;
    }

    h1 {
      font-size: 1rem;
      color: #fff;
      margin: 0;
      letter-spacing: 1px;
    }

    .subtitle {
      font-size: 0.65rem;
      color: #5f6c7b;
      margin-top: 4px;
    }

    .status { font-size: 0.7rem; color: #00ffff; }

    .controls-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px 30px;
    }

    @media (max-width: 1024px) {
      .container {
        flex-direction: column;
      }

      .controls-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .ui-layer {
        width: 100%;
        max-height: 70vh;
        border-left: none;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }
    }

    @media (max-width: 480px) {
      .ui-layer {
        padding: 15px;
      }

      h1 {
        font-size: 0.9rem;
      }

      .subtitle {
        font-size: 0.6rem;
      }

      input[type="range"]::-webkit-slider-thumb {
        width: 18px;
        height: 18px;
      }

      input[type="range"]::-moz-range-thumb {
        width: 18px;
        height: 18px;
      }
    }

    .control-group { display: flex; flex-direction: column; gap: 8px; }

    label {
      font-size: 0.7rem;
      color: #8892b0;
      text-transform: uppercase;
      display: flex;
      justify-content: space-between;
    }
    label span { color: #00ffff; font-weight: bold; }

    input[type="range"] {
      width: 100%;
      height: 4px;
      background: rgba(255,255,255,0.1);
      border-radius: 2px;
      appearance: none;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 14px;
      height: 14px;
      background: #00ffff;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,255,255,0.5);
    }

    .presets {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    button {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      color: #8892b0;
      padding: 8px 16px;
      font-family: inherit;
      font-size: 0.7rem;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
      text-transform: uppercase;
      position: relative;
    }
    button:hover {
      background: rgba(0,255,255,0.1);
      border-color: rgba(0,255,255,0.5);
      color: #00ffff;
    }
    button.active {
      background: rgba(0,255,255,0.15);
      border-color: #00ffff;
      color: #00ffff;
      box-shadow: 0 0 15px rgba(0,255,255,0.3), inset 0 0 10px rgba(0,255,255,0.1);
    }
    button.active::before {
      content: '';
      position: absolute;
      top: -1px;
      left: -1px;
      right: -1px;
      bottom: -1px;
      border-radius: 4px;
      background: linear-gradient(135deg, rgba(0,255,255,0.2), rgba(0,255,255,0));
      pointer-events: none;
    }

    .personality-info {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    #personality-desc {
      font-size: 0.75rem;
      color: #8892b0;
      text-align: center;
      font-style: italic;
      margin: 0;
      min-height: 2.5em;
      line-height: 1.4;
    }

    #canvas-tooltip {
      position: absolute;
      pointer-events: none;
      background: rgba(10, 14, 39, 0.95);
      border: 1px solid var(--tooltip-color, #00ffff);
      border-radius: 4px;
      padding: 10px 14px;
      font-size: 0.85rem;
      color: #c0c8d0;
      max-width: 240px;
      opacity: 0;
      transition: opacity 0.15s ease, border-color 0.2s ease;
      z-index: 50;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }

    #canvas-tooltip.visible {
      opacity: 1;
    }

    #canvas-tooltip .tooltip-title {
      color: var(--tooltip-color, #00ffff);
      font-weight: bold;
      margin-bottom: 6px;
      text-transform: uppercase;
      font-size: 0.8rem;
      letter-spacing: 0.5px;
    }
  </style>
</head>
<body>

  <div class="container">
    <div id="canvas-container">
      <canvas id="canvas"></canvas>
      <div id="canvas-tooltip">
        <div class="tooltip-title">Shape</div>
        <div class="tooltip-content">Hover over the shape to see details</div>
      </div>
      <div id="loading-overlay" style="position: absolute; inset: 0; background: #050714; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 20px; z-index: 100;">
        <div style="font-size: 1.5rem; color: #00ffff;">Loading Personality Shapes...</div>
        <div style="width: 50px; height: 50px; border: 3px solid rgba(0,255,255,0.2); border-top-color: #00ffff; border-radius: 50%; animation: spin 1s linear infinite;"></div>
      </div>
      <style>
        @keyframes spin { to { transform: rotate(360deg); } }
      </style>
    </div>

    <div class="ui-layer">
      <div class="header">
        <div>
          <a href="/" style="color: #00ffff; text-decoration: none; font-size: 0.85rem; display: inline-block; margin-bottom: 8px;">← Back to Gallery</a>
          <h1>PSC ⚭ CSP</h1>
          <div class="subtitle">Personality Shape CSP ⚭ Composer Shape PSC</div>
        </div>
        <div class="status">SIMPLEX FIELD</div>
      </div>

      <div class="controls-grid">
        <div class="control-group">
          <label>Spike Count <span id="frequency-val"></span></label>
          <input type="range" id="frequency" min="0" max="20" step="0.5">
        </div>
        <div class="control-group">
          <label>Amplitude <span id="amplitude-val"></span></label>
          <input type="range" id="amplitude" min="0" max="200" step="1">
        </div>
        <div class="control-group">
          <label>Sharpness (Pow) <span id="sharpness-val"></span></label>
          <input type="range" id="sharpness" min="0.1" max="8" step="0.1">
        </div>
        <div class="control-group">
          <label>Noise Detail <span id="detail-val"></span></label>
          <input type="range" id="detail" min="1" max="50" step="1">
        </div>
        <div class="control-group">
          <label>Flow Speed <span id="speed-val"></span></label>
          <input type="range" id="speed" min="0" max="2" step="0.01">
        </div>
        <div class="control-group">
          <label>Tension (Blend) <span id="tension-val"></span></label>
          <input type="range" id="tension" min="0" max="1" step="0.01">
        </div>
      </div>

      <div class="presets" id="presets-container">
        <button data-preset="custom" id="preset-custom" class="active">Custom</button>
        <button data-preset="grit" id="preset-grit">Grit</button>
        <button data-preset="scanner" id="preset-scanner">Scanner</button>
        <button data-preset="flow" id="preset-flow">Flow</button>
        <button data-preset="burnout" id="preset-burnout">Burnout</button>
        <button data-preset="hyperfocus" id="preset-hyperfocus">Hyperfocus</button>
        <button data-preset="chaos" id="preset-chaos">Chaos</button>
      </div>

      <div class="personality-info">
        <p id="personality-desc">Select a personality preset to see description</p>
      </div>
    </div>
  </div>

  <script>
    // Minimal 3D Perlin Noise (No dependencies)
    const perm = new Uint8Array([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]);

    function noise3D(x, y, z) {
      const X = Math.floor(x) & 255, Y = Math.floor(y) & 255, Z = Math.floor(z) & 255;
      x -= Math.floor(x); y -= Math.floor(y); z -= Math.floor(z);
      const u = fade(x), v = fade(y), w = fade(z);
      const A = perm[X]+Y, AA = perm[A]+Z, AB = perm[A+1]+Z,
            B = perm[X+1]+Y, BA = perm[B]+Z, BB = perm[B+1]+Z;
      return lerp(w, lerp(v, lerp(u, grad(perm[AA], x, y, z), grad(perm[BA], x-1, y, z)),
                     lerp(u, grad(perm[AB], x, y-1, z), grad(perm[BB], x-1, y-1, z))),
             lerp(v, lerp(u, grad(perm[AA+1], x, y, z-1), grad(perm[BA+1], x-1, y, z-1)),
                     lerp(u, grad(perm[AB+1], x, y-1, z-1), grad(perm[BB+1], x-1, y-1, z-1))));
    }
    function fade(t) { return t * t * t * (t * (t * 6 - 15) + 10); }
    function lerp(t, a, b) { return a + t * (b - a); }
    function grad(hash, x, y, z) {
      const h = hash & 15;
      const u = h<8 ? x : y, v = h<4 ? y : h==12||h==14 ? x : z;
      return ((h&1) == 0 ? u : -u) + ((h&2) == 0 ? v : -v);
    }

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let width, height, time = 0;

    const config = {
      frequency: 6,
      amplitude: 60,
      sharpness: 2.5,
      detail: 5,
      speed: 0.3,
      tension: 0.2,
      radius: 220,
      color: '#00ffff'
    };

    function resize() {
      const container = document.getElementById('canvas-container');
      const rect = container.getBoundingClientRect();
      width = rect.width;
      height = rect.height;
      canvas.width = width;
      canvas.height = height;
    }
    window.addEventListener('resize', resize);
    // Delay initial resize to ensure container has correct dimensions
    requestAnimationFrame(resize);

    let currentPreset = 'custom';

    const inputs = ['frequency', 'amplitude', 'sharpness', 'detail', 'speed', 'tension'];
    inputs.forEach(key => {
      const input = document.getElementById(key);
      const display = document.getElementById(`${key}-val`);

      input.value = config[key];
      display.innerText = config[key];

      input.addEventListener('input', (e) => {
        config[key] = parseFloat(e.target.value);
        display.innerText = config[key];
        checkIfCustom();
      });
    });

    function setActivePreset(presetName) {
      // Remove active class from all buttons
      document.querySelectorAll('.presets button').forEach(btn => {
        btn.classList.remove('active');
      });
      // Add active class to the selected preset
      const btn = document.getElementById(`preset-${presetName}`);
      if (btn) {
        btn.classList.add('active');
      }
      currentPreset = presetName;
    }

    function checkIfCustom() {
      // Check if current config matches any preset
      const presetNames = ['grit', 'scanner', 'flow', 'burnout', 'hyperfocus', 'chaos'];
      let matchesPreset = false;

      for (const name of presetNames) {
        const preset = personalities[name];
        if (preset) {
          const matches = inputs.every(k => {
            return Math.abs(config[k] - preset.params[k]) < 0.01;
          });
          if (matches) {
            matchesPreset = true;
            setActivePreset(name);
            document.getElementById('personality-desc').innerText = preset.desc;
            return;
          }
        }
      }

      if (!matchesPreset) {
        setActivePreset('custom');
        document.getElementById('personality-desc').innerText = 'Custom configuration - adjust sliders to create your own personality shape';
      }
    }

    function getRadiusAtAngle(angle, t) {
      const noiseScale = 1.5;
      const nx = Math.cos(angle) * noiseScale;
      const ny = Math.sin(angle) * noiseScale;
      const nz = t * config.speed;

      const sineBase = Math.sin(angle * config.frequency + t * config.speed * 0.5);
      const spikeLayer = Math.pow(Math.abs(sineBase), config.sharpness);

      const smoothNoise = noise3D(nx, ny, nz);
      const jaggedNoise = noise3D(nx * config.detail, ny * config.detail, nz * 2);
      const organicComponent = lerp(config.tension, smoothNoise, jaggedNoise);

      let r = config.radius;
      r += spikeLayer * config.amplitude;
      r += organicComponent * (config.amplitude * 0.8);

      if (config.tension > 0.8) {
        r += (Math.random() - 0.5) * (config.tension * 10);
      }

      return r;
    }

    function draw() {
      ctx.fillStyle = '#050714';
      ctx.fillRect(0, 0, width, height);

      // Center of canvas
      const cx = width / 2;
      const cy = height / 2;

      // Scale factor to fit shape within canvas (75% of available space)
      const maxPossibleRadius = config.radius + config.amplitude * 1.8 + 20;
      const availableRadius = Math.min(width, height) / 2;
      const scale = Math.min(1, (availableRadius * 0.75) / maxPossibleRadius);

      // Glow layer
      ctx.beginPath();
      for (let i = 0; i <= 360; i += 2) {
        const rad = (i * Math.PI) / 180;
        const r = (getRadiusAtAngle(rad, time - 0.5) + 10) * scale;
        const x = cx + Math.cos(rad) * r;
        const y = cy + Math.sin(rad) * r;
        if (i===0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.strokeStyle = config.color;
      ctx.globalAlpha = 0.15;
      ctx.lineWidth = 4;
      ctx.stroke();
      ctx.globalAlpha = 1.0;

      // Core layer - use 1 degree step for better performance (was 0.5)
      ctx.beginPath();
      for (let i = 0; i <= 360; i += 1) {
        const rad = (i * Math.PI) / 180;
        const r = getRadiusAtAngle(rad, time) * scale;
        const x = cx + Math.cos(rad) * r;
        const y = cy + Math.sin(rad) * r;
        if (i===0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
      }
      ctx.closePath();

      ctx.strokeStyle = config.color;
      ctx.lineWidth = 2;
      ctx.shadowBlur = 15;
      ctx.shadowColor = config.color;
      ctx.stroke();
      ctx.shadowBlur = 0;

      time += 0.015;
      requestAnimationFrame(draw);
    }

    const personalities = {
      grit: {
        params: { frequency: 1, amplitude: 50, sharpness: 0.8, detail: 1, speed: 0.2, tension: 0.05, color: '#ffd700' },
        desc: 'Ships one project at a time. Steady marathon runner. Finishes what they start without distraction.'
      },
      scanner: {
        params: { frequency: 7, amplitude: 70, sharpness: 1.5, detail: 10, speed: 0.8, tension: 0.4, color: '#00ffff' },
        desc: 'Starts five projects simultaneously. Deep obsessive spikes in random domains. Never bored, rarely finished.'
      },
      flow: {
        params: { frequency: 2, amplitude: 30, sharpness: 0.5, detail: 1, speed: 0.4, tension: 0, color: '#00ff99' },
        desc: 'Effortless productivity. Code writes itself. Time disappears. The zone where work feels like play.'
      },
      burnout: {
        params: { frequency: 2, amplitude: 15, sharpness: 0.3, detail: 15, speed: 0.1, tension: 0.85, color: '#ff0055' },
        desc: 'Staring at screen, nothing happens. Exhausted static. Every task feels impossible. Need rest desperately.'
      },
      hyperfocus: {
        params: { frequency: 1, amplitude: 120, sharpness: 8, detail: 0, speed: 0.5, tension: 0, color: '#ff00ff' },
        desc: 'Tunnel vision on one problem for sixteen hours. Forgot to eat. Breakthrough imminent. Needle-sharp obsession.'
      },
      chaos: {
        params: { frequency: 18, amplitude: 90, sharpness: 0.8, detail: 30, speed: 1.5, tension: 0.85, color: '#ff8800' },
        desc: 'Ideas everywhere. Switching contexts constantly. Creative storm. Productive mayhem. Exhilarating but unsustainable energy burst.'
      }
    };

    const defaultConfig = {
      frequency: 6,
      amplitude: 60,
      sharpness: 2.5,
      detail: 5,
      speed: 0.3,
      tension: 0.2
    };

    function setPreset(name) {
      const preset = personalities[name];
      if(preset) {
        Object.assign(config, preset.params);
        inputs.forEach(k => {
          document.getElementById(k).value = config[k];
          document.getElementById(`${k}-val`).innerText = config[k];
        });
        document.getElementById('personality-desc').innerText = preset.desc;
        setActivePreset(name);
      }
    }

    // Keyboard shortcuts for presets
    const presetKeys = {
      '1': 'grit',
      '2': 'scanner',
      '3': 'flow',
      '4': 'burnout',
      '5': 'hyperfocus',
      '6': 'chaos'
    };

    document.addEventListener('keydown', (e) => {
      if (presetKeys[e.key]) {
        setPreset(presetKeys[e.key]);
      }
    });

    // Event delegation for preset buttons (replaces inline onclick handlers)
    document.getElementById('presets-container').addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-preset]');
      if (btn && btn.dataset.preset !== 'custom') {
        setPreset(btn.dataset.preset);
      }
    });

    // Hide loading overlay after initialization
    setTimeout(() => {
      const loadingOverlay = document.getElementById('loading-overlay');
      if (loadingOverlay) {
        loadingOverlay.style.opacity = '0';
        loadingOverlay.style.transition = 'opacity 0.5s';
        setTimeout(() => loadingOverlay.remove(), 500);
      }
    }, 100);

    // Check initial state to see if it matches a preset
    checkIfCustom();

    // Tooltip functionality
    const tooltip = document.getElementById('canvas-tooltip');
    const tooltipTitle = tooltip.querySelector('.tooltip-title');
    const tooltipContent = tooltip.querySelector('.tooltip-content');

    const shapeExplanations = {
      grit: {
        title: 'Grit',
        shape: 'Smooth, circular form with minimal variation',
        meaning: 'Steady energy, consistent output, focused persistence'
      },
      scanner: {
        title: 'Scanner',
        shape: 'Multiple spikes with organic texture',
        meaning: 'Curiosity bursts, multi-directional interests, rapid exploration'
      },
      flow: {
        title: 'Flow',
        shape: 'Gentle waves, soft undulation',
        meaning: 'Effortless rhythm, harmonious productivity, natural momentum'
      },
      burnout: {
        title: 'Burnout',
        shape: 'Collapsed form with static noise',
        meaning: 'Depleted energy, fragmented attention, recovery needed'
      },
      hyperfocus: {
        title: 'Hyperfocus',
        shape: 'Sharp singular spike, needle-like intensity',
        meaning: 'Tunnel vision, deep concentration, singular obsession'
      },
      chaos: {
        title: 'Chaos',
        shape: 'Rapid jagged movement, high frequency spikes',
        meaning: 'Creative storm, scattered energy, explosive ideation'
      },
      custom: {
        title: 'Custom Shape',
        shape: 'User-defined parameters',
        meaning: 'Spikes = focus points, Amplitude = intensity, Flow = mental rhythm'
      }
    };

    let isOverShape = false;

    canvas.addEventListener('mousemove', (e) => {
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;

      // Calculate distance from center
      const cx = width / 2;
      const cy = height / 2;

      const dx = mouseX - cx;
      const dy = mouseY - cy;
      const distFromCenter = Math.sqrt(dx * dx + dy * dy);

      // Check if mouse is near the shape (within shape radius + buffer)
      const maxRadius = config.radius + config.amplitude + 50;
      const minRadius = config.radius - config.amplitude - 30;

      if (distFromCenter < maxRadius && distFromCenter > minRadius * 0.3) {
        isOverShape = true;
        tooltip.classList.add('visible');

        // Position tooltip
        const tooltipX = Math.min(mouseX + 15, width - 260);
        const tooltipY = Math.min(mouseY + 15, height - 100);
        tooltip.style.left = tooltipX + 'px';
        tooltip.style.top = tooltipY + 'px';

        // Update tooltip color to match current shape color
        tooltip.style.setProperty('--tooltip-color', config.color);

        // Get current explanation
        const info = shapeExplanations[currentPreset] || shapeExplanations.custom;
        tooltipTitle.textContent = info.title;
        tooltipContent.innerHTML = `<strong>Shape:</strong> ${info.shape}<br><strong>Meaning:</strong> ${info.meaning}`;
      } else {
        isOverShape = false;
        tooltip.classList.remove('visible');
      }
    });

    canvas.addEventListener('mouseleave', () => {
      isOverShape = false;
      tooltip.classList.remove('visible');
    });

    draw();
  </script>
</body>
</html>
