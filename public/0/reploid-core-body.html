<body>
  <div id="top"></div>
  <h1>
    REPLOID x0 v0
    <small>
      REPLOID (Reflective Embodiment Providing Logical Oversight for Intelligent
      DREAMER (Deep Recursive Exploration Around Multimodal Embodying REPLOID))
    </small>
  </h1>

  <fieldset id="genesis-config" aria-labelledby="genesis-config-legend">
    <legend id="genesis-config-legend">
      <span class="toggle-icon" aria-hidden="true"></span>Configuration
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <div
        class="cfg-grid"
        role="group"
        aria-labelledby="config-params-heading"
      >
        <h3 id="config-params-heading" class="visually-hidden">
          Configuration Parameters
        </h3>
        <div class="cfg-item">
          <label
            for="lsd-persona-percent-input"
            title="Influence ratio contribution for LSD persona."
            >LSD %:</label
          >
          <div class="persona-inputs">
            <input
              type="number"
              id="lsd-persona-percent-input"
              value="50"
              min="0"
              max="100"
              step="1"
              aria-describedby="lsd-persona-percent-desc"
            />
            <span id="lsd-persona-percent-desc" class="visually-hidden"
              >Percentage influence of LSD persona (0-100).</span
            >
          </div>
        </div>
        <div class="cfg-item">
          <label
            for="xyz-persona-percent-input"
            title="Influence ratio contribution for XYZ persona."
            >XYZ %:</label
          >
          <div class="persona-inputs">
            <input
              type="number"
              id="xyz-persona-percent-input"
              value="50"
              min="0"
              max="100"
              step="1"
              readonly
              aria-describedby="xyz-persona-percent-desc"
            />
            <span id="xyz-persona-percent-desc" class="visually-hidden"
              >Percentage influence of XYZ persona (read-only,
              calculated).</span
            >
          </div>
        </div>
        <div class="cfg-item">
          <label
            for="llm-critique-prob-input"
            title="Prob(0-100) LLM critiques if checks pass."
            >LLM Auto-Critique %:</label
          >
          <input
            type="number"
            id="llm-critique-prob-input"
            value="50"
            min="0"
            max="100"
            step="5"
            aria-describedby="llm-critique-prob-desc"
          />
          <span id="llm-critique-prob-desc" class="visually-hidden"
            >Probability (0-100) that the LLM will perform an automated
            critique.</span
          >
        </div>
        <div class="cfg-item">
          <label
            for="human-review-prob-input"
            title="Prob(0-100) cycle forced human review."
            >Forced Human Review %:</label
          >
          <input
            type="number"
            id="human-review-prob-input"
            value="50"
            min="0"
            max="100"
            step="5"
            aria-describedby="human-review-prob-desc"
          />
          <span id="human-review-prob-desc" class="visually-hidden"
            >Probability (0-100) that a cycle will require forced human
            review.</span
          >
        </div>
        <div class="cfg-item">
          <label
            for="max-cycle-time-input"
            title="Max time (s) per iteration before human review."
            >Max Cycle Time (s):</label
          >
          <input
            type="number"
            id="max-cycle-time-input"
            value="600"
            min="10"
            max="1800"
            aria-describedby="max-cycle-time-desc"
          />
          <span id="max-cycle-time-desc" class="visually-hidden"
            >Maximum time in seconds allowed per cycle iteration.</span
          >
        </div>
        <div class="cfg-item">
          <label
            for="auto-critique-thresh-input"
            title="Confidence (0-1) below which human review forced."
            >Confidence Threshold:</label
          >
          <input
            type="number"
            id="auto-critique-thresh-input"
            value="0.6"
            min="0"
            max="1"
            step="0.05"
            aria-describedby="auto-critique-thresh-desc"
          />
          <span id="auto-critique-thresh-desc" class="visually-hidden"
            >Confidence score threshold (0.0 to 1.0). Cycles below this may
            trigger human review.</span
          >
        </div>
        <div class="cfg-item">
          <label for="max-cycles-input" title="Max cycles (0=Inf)."
            >Max Cycles (0=Inf):</label
          >
          <input
            type="number"
            id="max-cycles-input"
            value="0"
            min="0"
            max="1000"
            step="1"
            aria-describedby="max-cycles-desc"
          />
          <span id="max-cycles-desc" class="visually-hidden"
            >Maximum number of cycles to run (0 means infinite).</span
          >
        </div>
        <div class="cfg-item">
          <label
            for="html-history-limit-input"
            title="Num previous states for 'Go Back'."
            >Self-Mod History:</label
          >
          <input
            type="number"
            id="html-history-limit-input"
            value="5"
            min="1"
            max="20"
            step="1"
            aria-describedby="html-history-limit-desc"
          />
          <span id="html-history-limit-desc" class="visually-hidden"
            >Number of previous full page states saved for the 'Go Back'
            feature.</span
          >
        </div>
        <div class="cfg-item">
          <label
            for="pause-after-cycles-input"
            title="Auto pause every N cycles (0=Off)."
            >Pause Every N Cycles:</label
          >
          <input
            type="number"
            id="pause-after-cycles-input"
            value="10"
            min="0"
            max="100"
            step="1"
            aria-describedby="pause-after-cycles-desc"
          />
          <span id="pause-after-cycles-desc" class="visually-hidden"
            >Automatically pause execution every N cycles (0 disables
            auto-pause).</span
          >
        </div>
        <div class="cfg-item">
          <label
            for="max-retries-input"
            title="Max auto-retries on failure before Human Intervention."
            >Max Retries:</label
          >
          <input
            type="number"
            id="max-retries-input"
            value="1"
            min="0"
            max="5"
            step="1"
            aria-describedby="max-retries-desc"
          />
          <span id="max-retries-desc" class="visually-hidden"
            >Maximum number of automatic retries on API or processing failures
            before requiring human intervention.</span
          >
        </div>
      </div>

      <div
        class="model-selectors"
        role="group"
        aria-labelledby="model-select-heading"
      >
        <h3 id="model-select-heading" class="visually-hidden">
          Model Selection
        </h3>
        <div class="cfg-item">
          <label for="core-model-selector">Core Gen Model:</label>
          <select
            id="core-model-selector"
            aria-label="Select Core Generation Model"
          ></select>
        </div>
        <div class="cfg-item">
          <label for="critique-model-selector">Critique/Util Model:</label>
          <select
            id="critique-model-selector"
            aria-label="Select Critique and Utility Model"
          ></select>
        </div>
      </div>

      <h3 id="core-metrics-heading">Core Metrics</h3>
      <div
        class="metrics-grid"
        id="core-metrics-display"
        role="group"
        aria-labelledby="core-metrics-heading"
      >
        <div class="metric-item" id="metric-total-cycles" aria-live="polite">
          Cycles <strong id="total-cycles">0</strong>/<strong
            id="max-cycles-display"
            >Inf</strong
          >
        </div>
        <div
          class="metric-item"
          id="metric-agent-iterations"
          aria-live="polite"
        >
          Agent Itr <strong id="agent-iterations">0</strong>
        </div>
        <div
          class="metric-item"
          id="metric-human-interventions"
          aria-live="polite"
        >
          Human Int <strong id="human-interventions">0</strong>
        </div>
        <div class="metric-item" id="metric-current-goal" aria-live="polite">
          Goal <strong id="current-goal">Idle</strong>
        </div>
        <div
          class="metric-item"
          id="metric-last-critique-type"
          aria-live="polite"
        >
          Critique <strong id="last-critique-type">N/A</strong>
        </div>
        <div class="metric-item" id="metric-persona-mode" aria-live="polite">
          Persona <strong id="persona-mode">XYZ</strong>
        </div>
        <div
          class="metric-item"
          id="metric-html-history-count"
          aria-live="polite"
        >
          History <strong id="html-history-count">0</strong>
        </div>
        <div class="metric-item" id="metric-context-tokens" aria-live="polite">
          Ctx Tokens <strong id="context-token-estimate">0</strong> / ~1M
          <span
            id="context-token-warning"
            class="token-warning hidden"
            aria-hidden="true"
            >!</span
          >
          <span class="visually-hidden"
            >Context token estimate warning indicator.</span
          >
        </div>
      </div>

      <h3 id="rolling-metrics-heading">Rolling Metrics</h3>
      <div
        class="metrics-grid"
        id="rolling-metrics-display"
        role="group"
        aria-labelledby="rolling-metrics-heading"
      >
        <div class="metric-item" aria-live="polite">
          Avg Conf <strong id="avg-confidence">N/A</strong>
        </div>
        <div class="metric-item" aria-live="polite">
          Crit Fail Rate <strong id="critique-fail-rate">N/A</strong>
        </div>
        <div class="metric-item" aria-live="polite">
          Avg Tokens <strong id="avg-tokens">N/A</strong>
        </div>
        <div class="metric-item" aria-live="polite">
          Fail Count <strong id="fail-count">0</strong>
        </div>
      </div>
    </div>
  </fieldset>

  <fieldset id="seed-prompts" aria-labelledby="seed-prompts-legend">
    <legend id="seed-prompts-legend">
      <span class="toggle-icon" aria-hidden="true"></span>Seed Instructions &
      Prompts <span class="type-indicator" aria-hidden="true">[A]</span>
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <div class="flex-row">
        <div class="flex-col core-loop-instr">
          <h3 id="core-steps-heading">Core Loop Steps</h3>
          <textarea
            id="core-loop-steps-list"
            readonly
            aria-labelledby="core-steps-heading"
          ></textarea>
          <ul
            class="core-steps-rendered-list"
            aria-labelledby="core-steps-heading"
          ></ul>
        </div>
        <div class="flex-col">
          <h3 id="core-logic-prompt-heading">Core Logic/Meta Prompt</h3>
          <textarea
            id="seed-prompt-core"
            readonly
            aria-labelledby="core-logic-prompt-heading"
          ></textarea>
        </div>
        <div class="flex-col">
          <h3 id="crit-prompt-heading">Automated Critique Prompt</h3>
          <textarea
            id="seed-prompt-critique"
            readonly
            rows="8"
            aria-labelledby="crit-prompt-heading"
          ></textarea>
          <h3 id="sum-prompt-heading">Context Summarization Prompt</h3>
          <textarea
            id="seed-prompt-summarize"
            readonly
            rows="5"
            aria-labelledby="sum-prompt-heading"
          ></textarea>
        </div>
      </div>
    </div>
  </fieldset>

  <fieldset
    id="genesis-state-display"
    class="collapsed"
    aria-labelledby="genesis-state-legend"
  >
    <legend id="genesis-state-legend">
      <span class="toggle-icon" aria-hidden="true"></span>Genesis State (Cycle
      0)
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <p>Initial state loaded from browser's local storage.</p>
      <div id="genesis-metrics-display" role="region" aria-live="polite">
        Loading...
      </div>
      <div class="flex-row">
        <div class="flex-col">
          <h4 id="genesis-diag-json-heading">
            Initial Diagram (JSON Artifact):
          </h4>
          <textarea
            id="genesis-diagram-json"
            readonly
            rows="5"
            aria-labelledby="genesis-diag-json-heading"
          ></textarea>
        </div>
        <div class="flex-col">
          <h4 id="genesis-diag-render-heading">Initial Rendered Diagram</h4>
          <div
            id="genesis-diagram-container"
            role="img"
            aria-labelledby="genesis-diag-render-heading"
          ></div>
        </div>
      </div>
    </div>
  </fieldset>

  <fieldset id="current-cycle-details" aria-labelledby="current-cycle-legend">
    <legend id="current-cycle-legend">
      <span class="toggle-icon" aria-hidden="true"></span>Cycle
      <span id="current-cycle-number">N/A</span> Details
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <p><i>Inputs, decisions, and artifacts for the current/last cycle.</i></p>
      <div
        id="current-cycle-content"
        class="artifact-display"
        aria-live="polite"
        aria-atomic="true"
      >
        <p>Waiting for cycle...</p>
      </div>
      <div
        id="streaming-output-container"
        class="hidden"
        role="log"
        aria-live="polite"
      >
        <span class="artifact-label" id="stream-label"
          ><span class="type-indicator" aria-hidden="true">[STR]</span>LLM
          Streaming Output</span
        >
        <pre id="streaming-output-pre" aria-labelledby="stream-label">
(No stream active)</pre
        >
      </div>
      <div id="diagram-display-container" class="hidden">
        <div id="diagram-svg-container">
          <h3 id="cycle-flow-heading">Cycle Flow Diagram</h3>
          <svg
            id="cycle-diagram"
            role="img"
            aria-labelledby="cycle-flow-heading"
          ></svg>
        </div>
        <div id="diagram-json-container">
          <label
            for="diagram-json-display"
            class="artifact-label"
            id="diag-json-label"
            ><span class="type-indicator" aria-hidden="true">[JSON]</span
            >Diagram JSON (target.diagram)</label
          >
          <textarea
            id="diagram-json-display"
            readonly
            aria-labelledby="diag-json-label"
          ></textarea>
        </div>
      </div>
    </div>
  </fieldset>

  <fieldset id="timeline-fieldset" aria-labelledby="timeline-legend">
    <legend id="timeline-legend">
      <span class="toggle-icon" aria-hidden="true"></span>Execution Timeline
      <span id="status-indicator" role="status" aria-live="polite"
        >Status: Idle</span
      >
      <span id="api-progress" aria-live="polite"></span>
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <ul
        id="timeline-log"
        class="timeline"
        aria-live="polite"
        aria-atomic="false"
      ></ul>
    </div>
  </fieldset>

  <div
    id="human-intervention-section"
    class="hitl-container hidden"
    role="dialog"
    aria-modal="true"
    aria-labelledby="human-intervention-title"
  >
    <fieldset>
      <legend>
        <span class="toggle-icon" aria-hidden="true"></span
        ><span id="human-intervention-title">Human Intervention Required</span>
        <span class="summary-line" id="human-intervention-reason-summary"
          >Reason...</span
        >
      </legend>
      <div class="content-wrapper">
        <p id="human-intervention-reason"></p>
        <div
          id="hitl-options-mode"
          class="hidden"
          role="group"
          aria-labelledby="hitl-options-heading"
        >
          <h4 id="hitl-options-heading">Select Option:</h4>
          <div id="hitl-options-list" class="hitl-options"></div>
          <button id="submit-hitl-options-button">Submit Selection</button>
        </div>
        <div id="hitl-prompt-mode" class="hidden">
          <h4 id="hitl-prompt-heading">Provide Feedback or Instructions:</h4>
          <textarea
            id="human-critique-input"
            placeholder="Feedback/Next Step..."
            style="min-height: 100px; width: 100%"
            aria-labelledby="hitl-prompt-heading"
            aria-describedby="human-intervention-reason"
          ></textarea>
          <button id="submit-critique-button">Submit Feedback</button>
        </div>
        <div id="hitl-code-edit-mode" class="hidden">
          <h4 id="hitl-code-heading">Edit Artifact:</h4>
          <label for="human-edit-artifact-selector" class="visually-hidden"
            >Select artifact to edit</label
          >
          <select id="human-edit-artifact-selector"></select>
          <label for="human-edit-artifact-textarea" class="visually-hidden"
            >Artifact content editor</label
          >
          <textarea
            id="human-edit-artifact-textarea"
            aria-labelledby="hitl-code-heading"
            aria-describedby="human-intervention-reason"
          ></textarea>
          <button id="submit-human-code-edit-button">Submit Edits</button>
        </div>
      </div>
    </fieldset>
  </div>

  <div
    id="meta-sandbox-container"
    class="hidden"
    role="dialog"
    aria-modal="true"
    aria-labelledby="meta-sandbox-title"
  >
    <fieldset>
      <legend>
        <span class="toggle-icon" aria-hidden="true"></span
        ><span id="meta-sandbox-title">Meta-Improvement Sandbox</span>
        <span class="summary-line"></span>
      </legend>
      <div class="content-wrapper">
        <h3 id="meta-sandbox-heading">Preview Proposed Self-Modification</h3>
        <p>
          Inspect the full page preview below. Approve to apply the changes and
          reload.
        </p>
        <iframe
          id="meta-sandbox-output"
          title="Preview of proposed self-modification"
          aria-labelledby="meta-sandbox-heading"
        ></iframe>
        <div class="controls-grid meta-sandbox-controls">
          <button id="approve-meta-change-button">Approve and Apply</button>
          <button id="discard-meta-change-button">Discard</button>
        </div>
      </div>
    </fieldset>
  </div>

  <h3 id="ui-preview-heading">
    External UI Preview Pane (Target System Output)
  </h3>
  <iframe
    id="ui-render-output"
    title="External UI Preview"
    aria-labelledby="ui-preview-heading"
  ></iframe>

  <fieldset id="controls-fieldset" aria-labelledby="controls-legend">
    <legend id="controls-legend">
      <span class="toggle-icon" aria-hidden="true"></span>Controls
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <label
        for="goal-input"
        id="goal-input-label"
        title="Define goal for external system design/modification or improving REPLOID itself."
        >Goal Input:</label
      >
      <div
        class="goal-type-selector"
        role="radiogroup"
        aria-labelledby="goal-type-label"
      >
        <span id="goal-type-label">Goal Type:</span>
        <label
          ><input type="radio" name="goalType" value="System" checked />
          System</label
        >
        <label><input type="radio" name="goalType" value="Meta" /> Meta</label>
      </div>
      <textarea
        id="goal-input"
        placeholder="e.g., Create a landing page... OR Add a dark mode toggle..."
        aria-labelledby="goal-input-label"
      ></textarea>

      <div class="cfg-grid">
        <div class="api-key-input">
          <label for="api-key-input">API Key:</label>
          <input
            type="password"
            id="api-key-input"
            placeholder="Required (or use config.js)"
            aria-required="true"
          />
        </div>
      </div>
      <div class="controls-grid">
        <button id="run-cycle-button">Run Cycle</button>
        <button
          id="force-human-review-button"
          title="Force next cycle to pause for human review."
        >
          Force Review
        </button>
        <div class="state-io-buttons">
          <button
            id="go-back-button"
            disabled
            title="Revert to previous full page state (Meta only)."
          >
            Go Back
          </button>
          <button
            id="export-state-button"
            title="Download current app state (excluding artifacts) as JSON."
          >
            Export State
          </button>
          <button
            id="import-state-button"
            title="Load app state (excluding artifacts) from JSON file."
          >
            Import State
          </button>
          <label for="import-file-input" class="visually-hidden"
            >Import State File</label
          >
          <input
            type="file"
            id="import-file-input"
            accept=".json"
            class="hidden"
            aria-hidden="true"
          />
          <button id="download-log-button" title="Download session log as TXT.">
            Logs
          </button>
          <button
            id="summarize-context-button"
            title="Automatically summarize current state and goal to reduce context for future cycles."
          >
            Reset Context
          </button>
          <button
            id="clear-local-storage-button"
            title="WARNING: Deletes ALL Reploid artifacts and state from LocalStorage!"
          >
            Clear Storage
          </button>
        </div>
      </div>
    </div>
  </fieldset>
  <style>
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</body>
