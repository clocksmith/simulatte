<body>
  <div id="top"></div>
  <h1>
    REPLOID v0.0
    <small
      >REPLOID (Reflective Embodiment Providing Logical Oversight for
      Intelligent DREAMER (Deep Recursive Exploration Around Multimodal
      Embodying REPLOID))</small
    >
  </h1>

  <fieldset id="genesis-config">
    <legend>
      <span class="toggle-icon"></span>Configuration
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <div class="cfg-grid">
        <div class="cfg-item">
          <label
            for="lsd-persona-percent"
            title="Influence ratio contribution for LSD persona."
            >LSD %:</label
          >
          <div class="persona-inputs">
            <input
              type="number"
              id="lsd-persona-percent"
              value="50"
              min="0"
              max="100"
              step="1"
            />
          </div>
        </div>
        <div class="cfg-item">
          <label
            for="xyz-persona-percent"
            title="Influence ratio contribution for XYZ persona."
            >XYZ %:</label
          >
          <div class="persona-inputs">
            <input
              type="number"
              id="xyz-persona-percent"
              value="50"
              min="0"
              max="100"
              step="1"
              readonly
            />
          </div>
        </div>
        <div class="cfg-item">
          <label
            for="llm-critique-prob"
            title="Prob(0-100) LLM critiques if checks pass."
            >LLM Auto-Critique %:</label
          >
          <input
            type="number"
            id="llm-critique-prob"
            value="50"
            min="0"
            max="100"
            step="5"
          />
        </div>
        <div class="cfg-item">
          <label
            for="human-review-prob"
            title="Prob(0-100) cycle forced human review."
            >Forced Human Review %:</label
          >
          <input
            type="number"
            id="human-review-prob"
            value="50"
            min="0"
            max="100"
            step="5"
          />
        </div>
        <div class="cfg-item">
          <label
            for="max-cycle-time"
            title="Max time (s) per iteration before human review."
            >Max Cycle Time (s):</label
          >
          <input
            type="number"
            id="max-cycle-time"
            value="600"
            min="10"
            max="1800"
          />
        </div>
        <div class="cfg-item">
          <label
            for="auto-critique-thresh"
            title="Confidence (0-1) below which human review forced."
            >Confidence Threshold:</label
          >
          <input
            type="number"
            id="auto-critique-thresh"
            value="0.6"
            min="0"
            max="1"
            step="0.05"
          />
        </div>
        <div class="cfg-item">
          <label for="max-cycles" title="Max cycles (0=Inf)."
            >Max Cycles (0=Inf):</label
          >
          <input
            type="number"
            id="max-cycles"
            value="0"
            min="0"
            max="1000"
            step="1"
          />
        </div>
        <div class="cfg-item">
          <label
            for="html-history-limit"
            title="Num previous states for 'Go Back'."
            >Self-Mod History:</label
          >
          <input
            type="number"
            id="html-history-limit"
            value="5"
            min="1"
            max="20"
            step="1"
          />
        </div>
        <div class="cfg-item">
          <label
            for="pause-after-cycles"
            title="Auto pause every N cycles (0=Off)."
            >Pause Every N Cycles:</label
          >
          <input
            type="number"
            id="pause-after-cycles"
            value="10"
            min="0"
            max="100"
            step="1"
          />
        </div>
        <div class="cfg-item">
          <label
            for="max-retries"
            title="Max auto-retries on failure before Human Intervention."
            >Max Retries:</label
          >
          <input
            type="number"
            id="max-retries"
            value="1"
            min="0"
            max="5"
            step="1"
          />
        </div>
      </div>

      <div class="model-selectors">
        <div class="cfg-item">
          <label for="core-model-selector">Core Gen Model:</label>
          <select id="core-model-selector"></select>
        </div>
        <div class="cfg-item">
          <label for="critique-model-selector">Critique/Util Model:</label>
          <select id="critique-model-selector"></select>
        </div>
      </div>

      <h3>Core Metrics</h3>
      <div class="metrics-grid" id="core-metrics-display">
        <div class="metric-item" id="metric-total-cycles">
          Cycles<strong id="total-cycles">0</strong>/<strong
            id="max-cycles-display"
            >Inf</strong
          >
        </div>
        <div class="metric-item" id="metric-agent-iterations">
          Agent Itr<strong id="agent-iterations">0</strong>
        </div>
        <div class="metric-item" id="metric-human-interventions">
          Human Int<strong id="human-interventions">0</strong>
        </div>
        <div class="metric-item" id="metric-current-goal">
          Goal<strong id="current-goal">Idle</strong>
        </div>
        <div class="metric-item" id="metric-last-critique-type">
          Critique<strong id="last-critique-type">N/A</strong>
        </div>
        <div class="metric-item" id="metric-persona-mode">
          Persona<strong id="persona-mode">XYZ</strong>
        </div>
        <div class="metric-item" id="metric-html-history-count">
          History<strong id="html-history-count">0</strong>
        </div>
        <div class="metric-item" id="metric-context-tokens">
          Ctx Tokens<strong id="context-token-estimate">0</strong> / ~1M
          <span id="context-token-warning" class="token-warning hidden">!</span>
        </div>
      </div>

      <h3>Rolling Metrics</h3>
      <div class="metrics-grid" id="rolling-metrics-display">
        <div class="metric-item">
          Avg Conf<strong id="avg-confidence">N/A</strong>
        </div>
        <div class="metric-item">
          Crit Fail Rate<strong id="critique-fail-rate">N/A</strong>
        </div>
        <div class="metric-item">
          Avg Tokens<strong id="avg-tokens">N/A</strong>
        </div>
        <div class="metric-item">
          Fail Count<strong id="fail-count">0</strong>
        </div>
      </div>
    </div>
  </fieldset>

  <fieldset id="seed-prompts">
    <legend>
      <span class="toggle-icon"></span>Seed Instructions & Prompts
      <span class="type-indicator">[A]</span> <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <div class="flex-row">
        <div class="flex-col core-loop-instr">
          <h3>Core Loop Steps</h3>
          <textarea id="core-loop-steps-list" readonly></textarea>
        </div>
        <div class="flex-col">
          <h3>Core Logic/Meta Prompt</h3>
          <textarea id="seed-prompt-core" readonly></textarea>
        </div>
        <div class="flex-col">
          <h3>Automated Critique Prompt</h3>
          <textarea id="seed-prompt-critique" readonly rows="8"></textarea>
          <h3>Context Summarization Prompt</h3>
          <textarea id="seed-prompt-summarize" readonly rows="5"></textarea>
        </div>
      </div>
    </div>
  </fieldset>

  <fieldset id="genesis-state-display" class="collapsed">
    <legend>
      <span class="toggle-icon"></span>Genesis State (Cycle 0)
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <p>Initial state loaded from browser's local storage.</p>
      <div id="genesis-metrics-display">Loading...</div>
      <div class="flex-row">
        <div class="flex-col">
          <h4>Initial Diagram (JSON Artifact):</h4>
          <textarea id="genesis-diagram-json" readonly rows="5"></textarea>
        </div>
      </div>
    </div>
  </fieldset>

  <fieldset id="current-cycle-details">
    <legend>
      <span class="toggle-icon"></span>Cycle
      <span id="current-cycle-number">N/A</span> Details
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <p>
        <i
          >Inputs used, decisions made, and artifacts generated/modified during
          the current/last cycle.</i
        >
      </p>
      <div id="current-cycle-content" class="artifact-display">
        <p>Waiting for cycle...</p>
      </div>
      <div id="diagram-display-container" class="hidden">
        <div id="diagram-svg-container">
          <h3>Cycle Flow Diagram</h3>
          <svg id="cycle-diagram"></svg>
        </div>
        <div id="diagram-json-container">
          <label for="diagram-json-display" class="artifact-label"
            ><span class="type-indicator">[JSON]</span>Diagram JSON
            (target.diagram)</label
          >
          <textarea id="diagram-json-display" readonly></textarea>
        </div>
      </div>
    </div>
  </fieldset>

  <fieldset id="timeline-fieldset">
    <legend>
      <span class="toggle-icon"></span>Execution Timeline
      <span id="status-indicator">Status: Idle</span>
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <ul id="timeline-log" class="timeline"></ul>
    </div>
  </fieldset>

  <div id="human-intervention-section" class="hitl-container hidden">
    <fieldset>
      <legend>
        <span class="toggle-icon"></span
        ><span id="human-intervention-title">Human Intervention Required</span>
        <span class="summary-line" id="human-intervention-reason-summary"
          >Reason...</span
        >
      </legend>
      <div class="content-wrapper">
        <p id="human-intervention-reason"></p>
        <div id="hitl-options-mode" class="hidden">
          <h4>Select Option:</h4>
          <div id="hitl-options-list" class="hitl-options"></div>
          <button id="submit-hitl-options-button">Submit Selection</button>
        </div>
        <div id="hitl-prompt-mode" class="hidden">
          <h4>Provide Feedback or Instructions:</h4>
          <textarea
            id="human-critique-input"
            placeholder="Feedback/Next Step..."
            style="min-height: 100px; width: 100%"
          ></textarea>
          <button id="submit-critique-button">Submit Feedback</button>
        </div>
        <div id="hitl-code-edit-mode" class="hidden">
          <h4>Edit Artifact:</h4>
          <select id="human-edit-artifact-selector"></select>
          <textarea id="human-edit-artifact-textarea"></textarea>
          <button id="submit-human-code-edit-button">Submit Edits</button>
        </div>
      </div>
    </fieldset>
  </div>

  <div id="meta-sandbox-container" class="hidden">
    <fieldset>
      <legend>
        <span class="toggle-icon"></span>Meta-Improvement Sandbox
        <span class="summary-line"></span>
      </legend>
      <div class="content-wrapper">
        <h3>Preview Proposed Self-Modification</h3>
        <p>
          Inspect the full page preview below. Approve to apply the changes and
          reload.
        </p>
        <iframe id="meta-sandbox-output"></iframe>
        <div style="margin-top: 15px">
          <button id="approve-meta-change-button">Approve and Apply</button>
          <button id="discard-meta-change-button">Discard</button>
        </div>
      </div>
    </fieldset>
  </div>

  <h3>External UI Preview Pane (Target System Output)</h3>
  <iframe id="ui-render-output" title="External UI Preview"></iframe>

  <fieldset id="controls-fieldset">
    <legend>
      <span class="toggle-icon"></span>Controls
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <label
        for="goal-input"
        title="Define goal for external system design/modification or improving REPLOID itself."
        >Goal Input:</label
      >
      <div class="goal-type-selector">
        <span>Goal Type:</span>
        <label
          ><input type="radio" name="goalType" value="System" checked />
          System</label
        >
        <label
          ><input type="radio" name="goalType" value="Meta" /> Meta
          (Self-Improvement)</label
        >
      </div>
      <textarea
        id="goal-input"
        placeholder="e.g., Create a landing page with a signup form... OR Add a dark mode toggle button..."
      ></textarea>

      <div class="cfg-grid">
        <div class="api-key-input">
          <label for="api-key-input">API Key:</label>
          <input
            type="password"
            id="api-key-input"
            placeholder="Required (or use config.js)"
          />
        </div>
      </div>
      <div class="controls-grid">
        <button id="run-cycle-button">Run Cycle</button>
        <button
          id="force-human-review-button"
          title="Force next cycle to pause for human review."
        >
          Force Review
        </button>
        <div class="state-io-buttons">
          <button
            id="go-back-button"
            disabled
            title="Revert to previous full page state (Meta only)."
          >
            Go Back
          </button>
          <button
            id="export-state-button"
            title="Download current app state (excluding artifacts) as JSON."
          >
            Export State
          </button>
          <button
            id="import-state-button"
            title="Load app state (excluding artifacts) from JSON file."
          >
            Import State
          </button>
          <input
            type="file"
            id="import-file-input"
            accept=".json"
            class="hidden"
          />
          <button id="download-log-button" title="Download session log as TXT.">
            Logs
          </button>
          <button
            id="summarize-context-button"
            title="Automatically summarize current state and goal to reduce context for future cycles."
          >
            Reset Context
          </button>
          <button
            id="clear-local-storage-button"
            title="WARNING: Deletes ALL Reploid artifacts and state from LocalStorage!"
          >
            Clear Storage
          </button>
        </div>
      </div>
    </div>
  </fieldset>
</body>
