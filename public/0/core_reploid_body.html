<body>
  <div id="top"></div>
  <h1>
    REPLOID v0.0
    <small
      >REPLOID (Reflective Embodiment Providing Logical Oversight for
      Intelligent DREAMER (Deep Recursive Exploration Around Multimodal
      Embodying REPLOID))</small
    >
  </h1>

  <fieldset id="genesisConfig">
    <legend>
      <span class="toggle-icon"></span>Configuration
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <div class="cfg-grid">
        <div class="cfg-item">
          <label
            for="lsdPersonaPercent"
            title="Influence ratio contribution for LSD persona."
            >LSD %:</label
          >
          <div class="persona-inputs">
            <input
              type="number"
              id="lsdPersonaPercent"
              value="50"
              min="0"
              max="100"
              step="1"
            />
          </div>
        </div>
        <div class="cfg-item">
          <label
            for="xyzPersonaPercent"
            title="Influence ratio contribution for XYZ persona."
            >XYZ %:</label
          >
          <div class="persona-inputs">
            <input
              type="number"
              id="xyzPersonaPercent"
              value="50"
              min="0"
              max="100"
              step="1"
              readonly
            />
          </div>
        </div>
        <div class="cfg-item">
          <label
            for="llmCritiqueProb"
            title="Prob(0-100) LLM critiques if checks pass."
            >LLM Auto-Critique %:</label
          >
          <input
            type="number"
            id="llmCritiqueProb"
            value="50"
            min="0"
            max="100"
            step="5"
          />
        </div>
        <div class="cfg-item">
          <label
            for="humanReviewProb"
            title="Prob(0-100) cycle forced human review."
            >Forced Human Review %:</label
          >
          <input
            type="number"
            id="humanReviewProb"
            value="50"
            min="0"
            max="100"
            step="5"
          />
        </div>
        <div class="cfg-item">
          <label
            for="maxCycleTime"
            title="Max time (s) per iteration before human review."
            >Max Cycle Time (s):</label
          >
          <input
            type="number"
            id="maxCycleTime"
            value="600"
            min="10"
            max="1800"
          />
        </div>
        <div class="cfg-item">
          <label
            for="autoCritiqueThresh"
            title="Confidence (0-1) below which human review forced."
            >Confidence Threshold:</label
          >
          <input
            type="number"
            id="autoCritiqueThresh"
            value="0.6"
            min="0"
            max="1"
            step="0.05"
          />
        </div>
        <div class="cfg-item">
          <label for="maxCycles" title="Max cycles (0=Inf)."
            >Max Cycles (0=Inf):</label
          >
          <input
            type="number"
            id="maxCycles"
            value="0"
            min="0"
            max="1000"
            step="1"
          />
        </div>
        <div class="cfg-item">
          <label
            for="htmlHistoryLimit"
            title="Num previous states for 'Go Back'."
            >Self-Mod History:</label
          >
          <input
            type="number"
            id="htmlHistoryLimit"
            value="5"
            min="1"
            max="20"
            step="1"
          />
        </div>
        <div class="cfg-item">
          <label
            for="pauseAfterCycles"
            title="Auto pause every N cycles (0=Off)."
            >Pause Every N Cycles:</label
          >
          <input
            type="number"
            id="pauseAfterCycles"
            value="10"
            min="0"
            max="100"
            step="1"
          />
        </div>
        <div class="cfg-item">
          <label
            for="maxRetries"
            title="Max auto-retries on failure before Human Intervention."
            >Max Retries:</label
          >
          <input
            type="number"
            id="maxRetries"
            value="1"
            min="0"
            max="5"
            step="1"
          />
        </div>
      </div>

      <div class="model-selectors">
        <div class="cfg-item">
          <label for="coreModelSelector">Core Gen Model:</label>
          <select id="coreModelSelector"></select>
        </div>
        <div class="cfg-item">
          <label for="critiqueModelSelector">Critique/Util Model:</label>
          <select id="critiqueModelSelector"></select>
        </div>
      </div>

      <h3>Core Metrics</h3>
      <div class="metrics-grid" id="core-metrics-display">
        <div class="metric-item" id="metrictotal-cycles">
          Cycles<strong id="total-cycles">0</strong>/<strong
            id="maxCyclesDisplay"
            >Inf</strong
          >
        </div>
        <div class="metric-item" id="metricAgentIterations">
          Agent Itr<strong id="agentIterations">0</strong>
        </div>
        <div class="metric-item" id="metricHumanInterventions">
          Human Int<strong id="humanInterventions">0</strong>
        </div>
        <div class="metric-item" id="metricCurrentGoal">
          Goal<strong id="currentGoal">Idle</strong>
        </div>
        <div class="metric-item" id="metricLastCritiqueType">
          Critique<strong id="lastCritiqueType">N/A</strong>
        </div>
        <div class="metric-item" id="metricPersonaMode">
          Persona<strong id="personaMode">XYZ</strong>
        </div>
        <div class="metric-item" id="metricHtmlHistoryCount">
          History<strong id="htmlHistoryCount">0</strong>
        </div>
        <div class="metric-item" id="metricContextTokens">
          Ctx Tokens<strong id="contextTokenEstimate">0</strong> / ~1M
          <span id="contextTokenWarning" class="token-warning hidden">!</span>
        </div>
      </div>

      <h3>Rolling Metrics</h3>
      <div class="metrics-grid" id="rolling-metrics-display">
        <div class="metric-item">
          Avg Conf<strong id="avgConfidence">N/A</strong>
        </div>
        <div class="metric-item">
          Crit Fail Rate<strong id="critiqueFailRate">N/A</strong>
        </div>
        <div class="metric-item">
          Avg Tokens<strong id="avgTokens">N/A</strong>
        </div>
        <div class="metric-item">
          Fail Count<strong id="failCount">0</strong>
        </div>
      </div>
    </div>
  </fieldset>

  <fieldset id="seed-prompts">
    <legend>
      <span class="toggle-icon"></span>Seed Instructions &amp; Prompts
      <span class="type-indicator">[A]</span> <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <div class="flex-row">
        <div class="flex-col core-loop-instr">
          <h3>Core Loop Steps</h3>
          <textarea id="coreLoopStepsList" readonly></textarea>
        </div>
        <div class="flex-col">
          <h3>Core Logic/Meta Prompt</h3>
          <textarea id="seed-prompt-core" readonly></textarea>
        </div>
        <div class="flex-col">
          <h3>Automated Critique Prompt</h3>
          <textarea id="seed-prompt-critique" readonly rows="8"></textarea>
          <h3>Context Summarization Prompt</h3>
          <textarea id="seed-promptsummarize" readonly rows="5"></textarea>
        </div>
      </div>
    </div>
  </fieldset>

  <fieldset id="genesisStateDisplay" class="collapsed">
    <legend>
      <span class="toggle-icon"></span>Genesis State (Cycle 0)
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <p>Initial state loaded from browser's local storage.</p>
      <div id="genesisMetricsDisplay">Loading...</div>
      <div class="flex-row">
        <div class="flex-col">
          <h4>Initial Diagram (JSON Artifact):</h4>
          <textarea id="genesisDiagramJson" readonly rows="5"></textarea>
        </div>
      </div>
    </div>
  </fieldset>

  <fieldset id="currentCycleDetails">
    <legend>
      <span class="toggle-icon"></span>Cycle
      <span id="currentCycleNumber">N/A</span> Details
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <p>
        <i
          >Inputs used, decisions made, and artifacts generated/modified during
          the current/last cycle.</i
        >
      </p>
      <div id="currentCycleContent" class="artifact-display">
        <p>Waiting for cycle...</p>
      </div>
      <div id="diagram-display-container" class="hidden">
        <div id="diagram-svg-container">
          <h3>Cycle Flow Diagram</h3>
          <svg id="cycle-diagram"></svg>
        </div>
        <div id="diagram-json-container">
          <label for="diagramJsonDisplay" class="artifact-label"
            ><span class="type-indicator">[JSON]</span>Diagram JSON
            (target.diagram)</label
          >
          <textarea id="diagramJsonDisplay" readonly></textarea>
        </div>
      </div>
    </div>
  </fieldset>

  <fieldset id="timelineFieldset">
    <legend>
      <span class="toggle-icon"></span>Execution Timeline
      <span id="statusIndicator">Status: Idle</span>
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <ul id="timelineLog" class="timeline"></ul>
    </div>
  </fieldset>

  <div id="humanInterventionSection" class="hitl-container hidden">
    <fieldset>
      <legend>
        <span class="toggle-icon"></span
        ><span id="humanInterventionTitle">Human Intervention Required</span>
        <span class="summary-line" id="humanInterventionReasonSummary"
          >Reason...</span
        >
      </legend>
      <div class="content-wrapper">
        <p id="humanInterventionReason"></p>
        <div id="hitlOptionsMode" class="hidden">
          <h4>Select Option:</h4>
          <div id="hitlOptionsList" class="hitl-options"></div>
          <button id="submitHitlOptionsButton">Submit Selection</button>
        </div>
        <div id="hitlPromptMode" class="hidden">
          <h4>Provide Feedback or Instructions:</h4>
          <textarea
            id="humanCritiqueInput"
            placeholder="Feedback/Next Step..."
            style="min-height: 100px; width: 100%"
          ></textarea>
          <button id="submitCritiqueButton">Submit Feedback</button>
        </div>
        <div id="hitlCodeEditMode" class="hidden">
          <h4>Edit Artifact:</h4>
          <select id="humanEditArtifactSelector"></select>
          <textarea id="human-edit-artifact-textarea"></textarea>
          <button id="submitHumanCodeEditButton">Submit Edits</button>
        </div>
      </div>
    </fieldset>
  </div>

  <div id="meta-sandbox-container" class="hidden">
    <fieldset>
      <legend>
        <span class="toggle-icon"></span>Meta-Improvement Sandbox
        <span class="summary-line"></span>
      </legend>
      <div class="content-wrapper">
        <h3>Preview Proposed Self-Modification</h3>
        <p>
          Inspect the full page preview below. Approve to apply the changes and
          reload.
        </p>
        <iframe id="metaSandboxOutput"></iframe>
        <div style="margin-top: 15px">
          <button id="approveMetaChangeButton">Approve and Apply</button>
          <button id="discardMetaChangeButton">Discard</button>
        </div>
      </div>
    </fieldset>
  </div>

  <h3>External UI Preview Pane (Target System Output)</h3>
  <iframe id="uiRenderOutput" title="External UI Preview"></iframe>

  <fieldset id="controlsFieldset">
    <legend>
      <span class="toggle-icon"></span>Controls
      <span class="summary-line"></span>
    </legend>
    <div class="content-wrapper">
      <label
        for="goal-input"
        title="Define goal for external system design/modification or improving REPLOID itself."
        >Goal Input:</label
      >
      <div class="goal-type-selector">
        <span>Goal Type:</span>
        <label
          ><input type="radio" name="goalType" value="System" checked />
          System</label
        >
        <label
          ><input type="radio" name="goalType" value="Meta" /> Meta
          (Self-Improvement)</label
        >
      </div>
      <textarea
        id="goal-input"
        placeholder="e.g., Create a landing page with a signup form... OR Add a dark mode toggle button..."
      ></textarea>

      <div class="cfg-grid">
        <div class="api-key-input">
          <label for="apiKeyInput">API Key:</label>
          <input
            type="password"
            id="apiKeyInput"
            placeholder="Required (or use config.js)"
          />
        </div>
      </div>
      <div class="controls-grid">
        <button id="runCycleButton">Run Cycle</button>
        <button
          id="forceHumanReviewButton"
          title="Force next cycle to pause for human review."
        >
          Force Review
        </button>
        <div class="state-io-buttons">
          <button
            id="goBackButton"
            disabled
            title="Revert to previous full page state (Meta only)."
          >
            Go Back
          </button>
          <button
            id="exportStateButton"
            title="Download current app state (excluding artifacts) as JSON."
          >
            Export State
          </button>
          <button
            id="importStateButton"
            title="Load app state (excluding artifacts) from JSON file."
          >
            Import State
          </button>
          <input
            type="file"
            id="importFileInput"
            accept=".json"
            class="hidden"
          />
          <button id="downloadLogButton" title="Download session log as TXT.">
            Logs
          </button>
          <button
            id="summarizeContextButton"
            title="Automatically summarize current state and goal to reduce context for future cycles."
          >
            Reset Context
          </button>
          <button
            id="clearLocalStorageButton"
            title="WARNING: Deletes ALL Reploid artifacts and state from LocalStorage!"
          >
            Clear Storage
          </button>
        </div>
      </div>
    </div>
  </fieldset>
</body>
