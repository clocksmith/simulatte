# Concatenated output generated by cats.py
# Base64 Encoded: True

--- CATS_START_FILE: boot.js ---
aW1wb3J0IFV0aWxzIGZyb20gIi4vdXRpbHMuanMiOwppbXBvcnQgU3RvcmFnZU1vZHVsZSBmcm9tICIuL3N0b3JhZ2UuanMiOwoKY29uc3QgYm9vdHN0cmFwID0gYXN5bmMgKCkgPT4gewogIGNvbnN0IGxvYWRpbmdDb250YWluZXIgPSBVdGlscy4kaWQoImxvYWRpbmctY29udGFpbmVyIik7CiAgY29uc3QgYm9vdExvZyA9IFV0aWxzLiRpZCgiYm9vdC1sb2ciKTsKICBjb25zdCBhcHBSb290ID0gVXRpbHMuJGlkKCJhcHAtcm9vdCIpOwoKICBjb25zdCBsb2dUb0Jvb3RTY3JlZW4gPSAobGV2ZWwsIG1lc3NhZ2UsIC4uLmRldGFpbHMpID0+IHsKICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTsKICAgIGNvbnN0IGxpbmUgPSBgWyR7dGltZXN0YW1wfV0gWyR7bGV2ZWwudG9VcHBlckNhc2UoKX1dICR7bWVzc2FnZX0gJHtkZXRhaWxzCiAgICAgIC5tYXAoKGQpID0+IEpTT04uc3RyaW5naWZ5KGQpKQogICAgICAuam9pbigiICIpfVxuYDsKICAgIGlmIChib290TG9nKSB7CiAgICAgIGJvb3RMb2cudGV4dENvbnRlbnQgKz0gbGluZTsKICAgICAgYm9vdExvZy5zY3JvbGxUb3AgPSBib290TG9nLnNjcm9sbEhlaWdodDsKICAgIH0KCiAgICBjb25zdCBjb25zb2xlTWV0aG9kID0KICAgICAgbGV2ZWwgPT09ICJlcnJvciIKICAgICAgICA/IGNvbnNvbGUuZXJyb3IKICAgICAgICA6IGxldmVsID09PSAid2FybiIKICAgICAgICA/IGNvbnNvbGUud2FybgogICAgICAgIDogY29uc29sZS5sb2c7CiAgICBjb25zb2xlTWV0aG9kKGxpbmUudHJpbSgpKTsKICB9OwoKICBsZXQgY29uZmlnID0gbnVsbDsKICBsZXQgc3RvcmFnZSA9IG51bGw7CiAgbGV0IGxvZ2dlciA9IG51bGw7CgogIHRyeSB7CiAgICBsb2dUb0Jvb3RTY3JlZW4oImluZm8iLCAiQm9vdCBzZXF1ZW5jZSBzdGFydGVkLi4uIik7CgogICAgbG9nVG9Cb290U2NyZWVuKCJpbmZvIiwgIkZldGNoaW5nIGNvbmZpZ3VyYXRpb24uLi4iKTsKICAgIGNvbnN0IGNvbmZpZ1Jlc3BvbnNlID0gYXdhaXQgZmV0Y2goImNvbmZpZy5qc29uIik7CiAgICBpZiAoIWNvbmZpZ1Jlc3BvbnNlLm9rKQogICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBjb25maWcuanNvbjogJHtjb25maWdSZXNwb25zZS5zdGF0dXN9YCk7CiAgICBjb25maWcgPSBhd2FpdCBjb25maWdSZXNwb25zZS5qc29uKCk7CiAgICBsb2dUb0Jvb3RTY3JlZW4oImluZm8iLCBgQ29uZmlndXJhdGlvbiBsb2FkZWQgKHYke2NvbmZpZy52ZXJzaW9ufSlgKTsKCiAgICBVdGlscy5sb2dnZXIuaW5pdChjb25maWcpOwogICAgbG9nZ2VyID0gVXRpbHMubG9nZ2VyOwogICAgbG9nZ2VyLmxvZ0V2ZW50KCJpbmZvIiwgIlV0aWxpdGllcyBhbmQgTG9nZ2VyIGluaXRpYWxpemVkLiIpOwoKICAgIHN0b3JhZ2UgPSBTdG9yYWdlTW9kdWxlKGNvbmZpZywgbG9nZ2VyKTsKICAgIGlmICghc3RvcmFnZSkgdGhyb3cgbmV3IEVycm9yKCJTdG9yYWdlIG1vZHVsZSBpbml0aWFsaXphdGlvbiBmYWlsZWQuIik7CiAgICBsb2dnZXIubG9nRXZlbnQoImluZm8iLCAiU3RvcmFnZSBtb2R1bGUgaW5pdGlhbGl6ZWQuIik7CiAgICBjb25zdCB1c2FnZSA9IHN0b3JhZ2UuZ2V0U3RvcmFnZVVzYWdlKCk7CiAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICJpbmZvIiwKICAgICAgYEluaXRpYWwgc3RvcmFnZSB1c2FnZTogJHsodXNhZ2UudXNlZCAvIDEwMjQpLnRvRml4ZWQoCiAgICAgICAgMQogICAgICApfUtCICgke3VzYWdlLnBlcmNlbnQudG9GaXhlZCgxKX0lKWAKICAgICk7CgogICAgbGV0IHN0YXRlID0gc3RvcmFnZS5nZXRTdGF0ZSgpOwogICAgaWYgKHN0YXRlKSB7CiAgICAgIGlmIChzdGF0ZS52ZXJzaW9uICE9PSBjb25maWcudmVyc2lvbikgewogICAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAgICJ3YXJuIiwKICAgICAgICAgIGBTdGF0ZSB2ZXJzaW9uIG1pc21hdGNoIChTdGF0ZTogJHtzdGF0ZS52ZXJzaW9ufSwgQ29uZmlnOiAke2NvbmZpZy52ZXJzaW9ufSkuIFJlLWluaXRpYWxpemluZyBzdGF0ZS5gCiAgICAgICAgKTsKICAgICAgICBzdGF0ZSA9IG51bGw7CiAgICAgICAgc3RvcmFnZS5yZW1vdmVTdGF0ZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIGxvZ2dlci5sb2dFdmVudCgiaW5mbyIsIGBFeGlzdGluZyBzdGF0ZSBmb3VuZCAodiR7c3RhdGUudmVyc2lvbn0pLmApOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICAgImluZm8iLAogICAgICAgICJObyBleGlzdGluZyBzdGF0ZSBmb3VuZC4gSW5pdGlhbGl6aW5nIG5ldyBzdGF0ZS4iCiAgICAgICk7CiAgICB9CgogICAgbG9nZ2VyLmxvZ0V2ZW50KCJpbmZvIiwgIkxvYWRpbmcgY29yZSBhcHBsaWNhdGlvbiBtb2R1bGVzLi4uIik7CgogICAgY29uc3QgU3RhdGVNYW5hZ2VyID0gKGF3YWl0IGltcG9ydCgiLi9zdGF0ZS1tYW5hZ2VyLmpzIikpLmRlZmF1bHQoCiAgICAgIGNvbmZpZywKICAgICAgbG9nZ2VyLAogICAgICBzdG9yYWdlCiAgICApOwogICAgY29uc3QgQXBpQ2xpZW50ID0gKGF3YWl0IGltcG9ydCgiLi9hcGktY2xpZW50LmpzIikpLmRlZmF1bHQoY29uZmlnLCBsb2dnZXIpOwogICAgY29uc3QgTUNQQ29udmVydGVyID0gKGF3YWl0IGltcG9ydCgiLi9tY3AtY29udmVydGVyLmpzIikpLmRlZmF1bHQoCiAgICAgIGNvbmZpZywKICAgICAgbG9nZ2VyCiAgICApOwogICAgY29uc3QgVG9vbFJ1bm5lciA9IChhd2FpdCBpbXBvcnQoIi4vdG9vbC1ydW5uZXIuanMiKSkuZGVmYXVsdCgKICAgICAgY29uZmlnLAogICAgICBsb2dnZXIKICAgICk7CiAgICBjb25zdCBDeWNsZUxvZ2ljID0gKGF3YWl0IGltcG9ydCgiLi9jeWNsZS1sb2dpYy5qcyIpKS5kZWZhdWx0KAogICAgICBjb25maWcsCiAgICAgIGxvZ2dlciwKICAgICAgVXRpbHMsCiAgICAgIHN0b3JhZ2UsCiAgICAgIFN0YXRlTWFuYWdlciwKICAgICAgQXBpQ2xpZW50LAogICAgICBNQ1BDb252ZXJ0ZXIsCiAgICAgIFRvb2xSdW5uZXIKICAgICk7CiAgICBjb25zdCBVSU1hbmFnZXIgPSAoYXdhaXQgaW1wb3J0KCIuL3VpLW1hbmFnZXIuanMiKSkuZGVmYXVsdCgKICAgICAgY29uZmlnLAogICAgICBsb2dnZXIsCiAgICAgIFV0aWxzLAogICAgICBzdG9yYWdlLAogICAgICBTdGF0ZU1hbmFnZXIsCiAgICAgIEN5Y2xlTG9naWMKICAgICk7CgogICAgbG9nZ2VyLmxvZ0V2ZW50KCJpbmZvIiwgIkNvcmUgbW9kdWxlcyBsb2FkZWQuIik7CgogICAgU3RhdGVNYW5hZ2VyLmluaXQoc3RhdGUpOwogICAgbG9nZ2VyLmxvZ0V2ZW50KCJpbmZvIiwgIlN0YXRlTWFuYWdlciBpbml0aWFsaXplZC4iKTsKCiAgICBDeWNsZUxvZ2ljLmluaXQoKTsKICAgIGxvZ2dlci5sb2dFdmVudCgiaW5mbyIsICJDeWNsZUxvZ2ljIGluaXRpYWxpemVkLiIpOwoKICAgIGF3YWl0IFVJTWFuYWdlci5pbml0KCk7CiAgICBsb2dnZXIubG9nRXZlbnQoImluZm8iLCAiVUlNYW5hZ2VyIGluaXRpYWxpemVkLiIpOwoKICAgIGxvZ2dlci5sb2dFdmVudCgiaW5mbyIsICJCb290c3RyYXAgY29tcGxldGUuIExhdW5jaGluZyBhcHBsaWNhdGlvbi4iKTsKICAgIGlmIChsb2FkaW5nQ29udGFpbmVyKSBsb2FkaW5nQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwogICAgaWYgKGFwcFJvb3QpIGFwcFJvb3QuY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIGNvbnN0IGVycm9yTXNnID0gYEZBVEFMIEJPT1RTVFJBUCBFUlJPUjogJHtlcnJvci5tZXNzYWdlfWA7CiAgICBsb2dUb0Jvb3RTY3JlZW4oImVycm9yIiwgZXJyb3JNc2csIGVycm9yLnN0YWNrKTsKCiAgICBpZiAoYm9vdExvZykgewogICAgICBib290TG9nLnN0eWxlLmNvbG9yID0gInZhcigtLWVycm9yLWNvbG9yKSI7CiAgICAgIGJvb3RMb2cuc3R5bGUuYm9yZGVyQ29sb3IgPSAidmFyKC0tZXJyb3ItY29sb3IpIjsKICAgIH0KICAgIGlmIChhcHBSb290KSBhcHBSb290LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwoKICAgIGlmICghYm9vdExvZyAmJiBsb2FkaW5nQ29udGFpbmVyKSB7CiAgICAgIGxvYWRpbmdDb250YWluZXIuaW5uZXJIVE1MID0gYDxoMSBzdHlsZT0iY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTsiPkluaXRpYWxpemF0aW9uIEZhaWxlZDwvaDE+PHByZSBzdHlsZT0iY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTsgdGV4dC1hbGlnbjogbGVmdDsgd2hpdGUtc3BhY2U6IHByZS13cmFwOyI+JHtlcnJvck1zZ31cbiR7CiAgICAgICAgZXJyb3Iuc3RhY2sgfHwgIiIKICAgICAgfTwvcHJlPmA7CiAgICB9CiAgfQp9OwoKYm9vdHN0cmFwKCk7
--- CATS_END_FILE ---

--- CATS_START_FILE: index.html ---
PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KICA8aGVhZD4KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04IiAvPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiIC8+CiAgICA8dGl0bGU+RHJlYW1lciAoVG9vbCBGYWN0b3J5KTwvdGl0bGU+CiAgICA8bGluawogICAgICByZWw9Imljb24iCiAgICAgIGhyZWY9ImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgMTAwIDEwMCclM0UlM0NyZWN0IHdpZHRoPScxMDAnIGhlaWdodD0nMTAwJyByeD0nMTUnIGZpbGw9JyUyM2NjYycvJTNFJTNDcGF0aCBkPSdNMzAgNzAgTDUwIDMwIEw3MCA3MCBaJyBmaWxsPSclMjMzMzMnLyUzRSUzQ3BhdGggZD0nTTQwIDYwIEw2MCA2MCBMNTAgNDUgWicgZmlsbD0nJTIzZmZmJy8lM0UlM0Mvc3ZnJTNFIgogICAgLz4KICAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0idWktc3R5bGUuY3NzIiAvPgogIDwvaGVhZD4KICA8Ym9keT4KICAgIDxkaXYgaWQ9ImxvYWRpbmctY29udGFpbmVyIj4KICAgICAgPGgxPkxvYWRpbmcgRFJFQU1FUi4uLjwvaDE+CiAgICAgIDxwcmUgaWQ9ImJvb3QtbG9nIj48L3ByZT4KICAgIDwvZGl2PgogICAgPGRpdiBpZD0iYXBwLXJvb3QiIGNsYXNzPSJoaWRkZW4iPjwvZGl2PgogICAgPGRpdiBpZD0ibm90aWZpY2F0aW9ucy1jb250YWluZXIiPjwvZGl2PgoKICAgIDxzY3JpcHQgdHlwZT0ibW9kdWxlIiBzcmM9ImJvb3QuanMiPjwvc2NyaXB0PgogIDwvYm9keT4KPC9odG1sPg==
--- CATS_END_FILE ---

--- CATS_START_FILE: state-manager.js ---
Y29uc3QgU3RhdGVNYW5hZ2VyTW9kdWxlID0gKGNvbmZpZywgbG9nZ2VyLCBzdG9yYWdlKSA9PiB7CiAgaWYgKCFjb25maWcgfHwgIWxvZ2dlciB8fCAhc3RvcmFnZSkgewogICAgbG9nZ2VyPy5sb2dFdmVudCgKICAgICAgImVycm9yIiwKICAgICAgIlN0YXRlTWFuYWdlciByZXF1aXJlcyBjb25maWcsIGxvZ2dlciwgYW5kIHN0b3JhZ2UuIgogICAgKTsKICAgIHJldHVybiBudWxsOwogIH0KCiAgbGV0IHN0YXRlID0gbnVsbDsKICBsZXQgaXNJbml0aWFsaXplZCA9IGZhbHNlOwogIGNvbnN0IHNlc3Npb25BcGlLZXkgPSAiZHRmX3Nlc3Npb25fYXBpS2V5IjsgLy8gS2V5IGZvciBzZXNzaW9uU3RvcmFnZQoKICBjb25zdCBnZXREZWZhdWx0U3RhdGUgPSAoKSA9PiAoewogICAgdmVyc2lvbjogY29uZmlnLnZlcnNpb24sCiAgICB0b29sczoge30sCiAgICBsYXN0RXJyb3I6IG51bGwsCiAgICBzdGF0czogewogICAgICB0b29sc0dlbmVyYXRlZDogMCwKICAgICAgY3ljbGVzUnVuOiAwLAogICAgICBhcGlDYWxsczogMCwKICAgICAgZXJyb3JzOiAwLAogICAgfSwKICB9KTsKCiAgY29uc3QgdmFsaWRhdGVTdGF0ZSA9IChsb2FkZWRTdGF0ZSkgPT4gewogICAgaWYgKCFsb2FkZWRTdGF0ZSB8fCB0eXBlb2YgbG9hZGVkU3RhdGUgIT09ICJvYmplY3QiKSByZXR1cm4gZmFsc2U7CiAgICBpZiAobG9hZGVkU3RhdGUudmVyc2lvbiAhPT0gY29uZmlnLnZlcnNpb24pIHsKICAgICAgbG9nZ2VyLmxvZ0V2ZW50KAogICAgICAgICJ3YXJuIiwKICAgICAgICBgU3RhdGUgdmVyc2lvbiBtaXNtYXRjaC4gTG9hZGVkOiAke2xvYWRlZFN0YXRlLnZlcnNpb259LCBFeHBlY3RlZDogJHtjb25maWcudmVyc2lvbn0uIERpc2NhcmRpbmcgbG9hZGVkIHN0YXRlLmAKICAgICAgKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmICh0eXBlb2YgbG9hZGVkU3RhdGUudG9vbHMgIT09ICJvYmplY3QiIHx8IGxvYWRlZFN0YXRlLnRvb2xzID09PSBudWxsKQogICAgICByZXR1cm4gZmFsc2U7CiAgICBpZiAodHlwZW9mIGxvYWRlZFN0YXRlLnN0YXRzICE9PSAib2JqZWN0IiB8fCBsb2FkZWRTdGF0ZS5zdGF0cyA9PT0gbnVsbCkKICAgICAgcmV0dXJuIGZhbHNlOwoKICAgIHJldHVybiB0cnVlOwogIH07CgogIGNvbnN0IGluaXQgPSAoaW5pdGlhbFN0YXRlRnJvbVN0b3JhZ2UgPSBudWxsKSA9PiB7CiAgICBpZiAoaXNJbml0aWFsaXplZCkgewogICAgICBsb2dnZXIubG9nRXZlbnQoIndhcm4iLCAiU3RhdGVNYW5hZ2VyIGluaXQgY2FsbGVkIG11bHRpcGxlIHRpbWVzLiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBsb2dnZXIubG9nRXZlbnQoImluZm8iLCAiSW5pdGlhbGl6aW5nIFN0YXRlTWFuYWdlci4uLiIpOwoKICAgIGlmIChpbml0aWFsU3RhdGVGcm9tU3RvcmFnZSAmJiB2YWxpZGF0ZVN0YXRlKGluaXRpYWxTdGF0ZUZyb21TdG9yYWdlKSkgewogICAgICBzdGF0ZSA9IGluaXRpYWxTdGF0ZUZyb21TdG9yYWdlOwogICAgICBpc0luaXRpYWxpemVkID0gdHJ1ZTsKICAgICAgbG9nZ2VyLmxvZ0V2ZW50KAogICAgICAgICJpbmZvIiwKICAgICAgICBgU3RhdGVNYW5hZ2VyIGluaXRpYWxpemVkIHdpdGggZXhpc3Rpbmcgc3RhdGUgdiR7c3RhdGUudmVyc2lvbn1gCiAgICAgICk7CiAgICB9IGVsc2UgewogICAgICBpZiAoaW5pdGlhbFN0YXRlRnJvbVN0b3JhZ2UpIHsKICAgICAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICAgICAid2FybiIsCiAgICAgICAgICAiSW52YWxpZCBpbml0aWFsIHN0YXRlIHByb3ZpZGVkIG9yIHZhbGlkYXRpb24gZmFpbGVkLiBJbml0aWFsaXppbmcgd2l0aCBkZWZhdWx0LiIKICAgICAgICApOwogICAgICB9CiAgICAgIHN0YXRlID0gZ2V0RGVmYXVsdFN0YXRlKCk7CiAgICAgIGlzSW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICAgImluZm8iLAogICAgICAgIGBTdGF0ZU1hbmFnZXIgaW5pdGlhbGl6ZWQgd2l0aCBkZWZhdWx0IHN0YXRlIHYke3N0YXRlLnZlcnNpb259YAogICAgICApOwogICAgICBzYXZlU3RhdGUoKTsKICAgIH0KICB9OwoKICBjb25zdCBnZXRTdGF0ZSA9ICgpID0+IHsKICAgIGlmICghaXNJbml0aWFsaXplZCkgewogICAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICAgImVycm9yIiwKICAgICAgICAiQXR0ZW1wdGVkIHRvIGdldCBzdGF0ZSBiZWZvcmUgU3RhdGVNYW5hZ2VyIGluaXRpYWxpemVkLiIKICAgICAgKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvLyBOb3RlOiBEb2VzIG5vdCByZXR1cm4gdGhlIEFQSSBrZXksIHdoaWNoIGlzIHNlc3Npb24tbWFuYWdlZAogICAgcmV0dXJuIHN0YXRlOwogIH07CgogIGNvbnN0IHVwZGF0ZVN0YXRlID0gKG5ld1N0YXRlKSA9PiB7CiAgICBpZiAoIWlzSW5pdGlhbGl6ZWQpIHRocm93IG5ldyBFcnJvcigiU3RhdGVNYW5hZ2VyIG5vdCBpbml0aWFsaXplZC4iKTsKICAgIGlmICghdmFsaWRhdGVTdGF0ZShuZXdTdGF0ZSkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJBdHRlbXB0ZWQgdG8gc2V0IGludmFsaWQgc3RhdGUuIik7CiAgICB9CiAgICBzdGF0ZSA9IG5ld1N0YXRlOwogIH07CgogIGNvbnN0IHNhdmVTdGF0ZSA9ICgpID0+IHsKICAgIGlmICghaXNJbml0aWFsaXplZCkgdGhyb3cgbmV3IEVycm9yKCJTdGF0ZU1hbmFnZXIgbm90IGluaXRpYWxpemVkLiIpOwogICAgdHJ5IHsKICAgICAgc3RvcmFnZS5zYXZlU3RhdGUoc3RhdGUpOwogICAgICBsb2dnZXIubG9nRXZlbnQoImRlYnVnIiwgIlN0YXRlIHNhdmVkIHN1Y2Nlc3NmdWxseS4iKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJlcnJvciIsICJGYWlsZWQgdG8gc2F2ZSBzdGF0ZSB0byBzdG9yYWdlLiIsIGUpOwogICAgICBzdGF0ZS5sYXN0RXJyb3IgPSBgRmFpbGVkIHRvIHNhdmUgc3RhdGU6ICR7ZS5tZXNzYWdlfWA7CiAgICB9CiAgfTsKCiAgY29uc3QgYWRkVG9vbCA9ICgKICAgIHRvb2xJZCwKICAgIG1jcERlZmluaXRpb24sCiAgICBqc0ltcGxlbWVudGF0aW9uLAogICAgdG9vbE1ldGFkYXRhID0ge30KICApID0+IHsKICAgIGlmICghaXNJbml0aWFsaXplZCkgdGhyb3cgbmV3IEVycm9yKCJTdGF0ZU1hbmFnZXIgbm90IGluaXRpYWxpemVkLiIpOwogICAgaWYgKCFzdGF0ZS50b29scykgc3RhdGUudG9vbHMgPSB7fTsKICAgIGlmIChzdGF0ZS50b29sc1t0b29sSWRdKSB7CiAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAid2FybiIsCiAgICAgICAgYE92ZXJ3cml0aW5nIGV4aXN0aW5nIHRvb2wgZGVmaW5pdGlvbiBmb3IgSUQ6ICR7dG9vbElkfWAKICAgICAgKTsKICAgIH0KICAgIGlmICgKICAgICAgIW1jcERlZmluaXRpb24gfHwKICAgICAgdHlwZW9mIG1jcERlZmluaXRpb24gIT09ICJvYmplY3QiIHx8CiAgICAgICFtY3BEZWZpbml0aW9uLm5hbWUKICAgICkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgTUNQIGRlZmluaXRpb24gcHJvdmlkZWQgZm9yIHRvb2wgSUQ6ICR7dG9vbElkfWApOwogICAgfQogICAgaWYgKHR5cGVvZiBqc0ltcGxlbWVudGF0aW9uICE9PSAic3RyaW5nIiB8fCBqc0ltcGxlbWVudGF0aW9uLmxlbmd0aCA9PT0gMCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgYEludmFsaWQgSlMgaW1wbGVtZW50YXRpb24gcHJvdmlkZWQgZm9yIHRvb2wgSUQ6ICR7dG9vbElkfWAKICAgICAgKTsKICAgIH0KCiAgICBzdGF0ZS50b29sc1t0b29sSWRdID0gewogICAgICBpZDogdG9vbElkLAogICAgICBtY3BEZWZpbml0aW9uOiBtY3BEZWZpbml0aW9uLAogICAgICBqc0ltcGxlbWVudGF0aW9uOiBqc0ltcGxlbWVudGF0aW9uLAogICAgICBtZXRhZGF0YTogewogICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgIGNyZWF0ZWRCeTogIkxMTSIsIC8vIEFzc3VtZSBMTE0gZm9yIG5vdwogICAgICAgIHZlcnNpb246IHRvb2xNZXRhZGF0YS52ZXJzaW9uIHx8ICIxLjAuMCIsCiAgICAgICAgZGVzY3JpcHRpb246IG1jcERlZmluaXRpb24uZGVzY3JpcHRpb24gfHwgIihObyBkZXNjcmlwdGlvbikiLAogICAgICAgIG5hbWU6IG1jcERlZmluaXRpb24ubmFtZSwKICAgICAgICBvcmlnaW5hbFJlcXVlc3Q6IHRvb2xNZXRhZGF0YS5zb3VyY2VSZXF1ZXN0IHx8ICIiLCAvLyBTdG9yZSB0aGUgb3JpZ2luYWwgcmVxdWVzdAogICAgICAgIC4uLnRvb2xNZXRhZGF0YSwKICAgICAgfSwKICAgIH07CiAgICBzdGF0ZS5zdGF0cy50b29sc0dlbmVyYXRlZCA9IChzdGF0ZS5zdGF0cy50b29sc0dlbmVyYXRlZCB8fCAwKSArIDE7CiAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICJpbmZvIiwKICAgICAgYFRvb2wgYWRkZWQvdXBkYXRlZDogJHt0b29sSWR9ICgke21jcERlZmluaXRpb24ubmFtZX0pYAogICAgKTsKICAgIHNhdmVTdGF0ZSgpOwogIH07CgogIGNvbnN0IGdldFRvb2wgPSAodG9vbElkKSA9PiB7CiAgICBpZiAoIWlzSW5pdGlhbGl6ZWQpIHJldHVybiBudWxsOwogICAgcmV0dXJuIHN0YXRlLnRvb2xzPy5bdG9vbElkXSA/PyBudWxsOwogIH07CgogIGNvbnN0IGxpc3RUb29scyA9ICgpID0+IHsKICAgIGlmICghaXNJbml0aWFsaXplZCkgcmV0dXJuIFtdOwogICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoc3RhdGUudG9vbHMgfHwge30pOwogIH07CgogIGNvbnN0IGRlbGV0ZVRvb2wgPSAodG9vbElkKSA9PiB7CiAgICBpZiAoIWlzSW5pdGlhbGl6ZWQpIHRocm93IG5ldyBFcnJvcigiU3RhdGVNYW5hZ2VyIG5vdCBpbml0aWFsaXplZC4iKTsKICAgIGlmIChzdGF0ZS50b29scyAmJiBzdGF0ZS50b29sc1t0b29sSWRdKSB7CiAgICAgIGRlbGV0ZSBzdGF0ZS50b29sc1t0b29sSWRdOwogICAgICBsb2dnZXIubG9nRXZlbnQoImluZm8iLCBgVG9vbCBkZWxldGVkOiAke3Rvb2xJZH1gKTsKICAgICAgc2F2ZVN0YXRlKCk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgbG9nZ2VyLmxvZ0V2ZW50KCJ3YXJuIiwgYEF0dGVtcHRlZCB0byBkZWxldGUgbm9uLWV4aXN0ZW50IHRvb2w6ICR7dG9vbElkfWApOwogICAgcmV0dXJuIGZhbHNlOwogIH07CgogIGNvbnN0IHNldEFwaUtleUluU2Vzc2lvbiA9IChrZXkpID0+IHsKICAgICBpZiAoIWlzSW5pdGlhbGl6ZWQpIHRocm93IG5ldyBFcnJvcigiU3RhdGVNYW5hZ2VyIG5vdCBpbml0aWFsaXplZC4iKTsKICAgICBpZiAodHlwZW9mIGtleSAhPT0gInN0cmluZyIpIHJldHVybjsKICAgICB0cnkgewogICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKHNlc3Npb25BcGlLZXksIGtleSk7CiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKHNlc3Npb25BcGlLZXkpOwogICAgICAgICB9CiAgICAgICAgIGxvZ2dlci5sb2dFdmVudCgiaW5mbyIsIGBBUEkgS2V5ICR7a2V5ID8gInNhdmVkIiA6ICJjbGVhcmVkIn0gaW4gc2Vzc2lvbiBzdG9yYWdlLmApOwogICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJlcnJvciIsIGBGYWlsZWQgdG8gc2V0IEFQSSBLZXkgaW4gc2Vzc2lvbiBzdG9yYWdlYCwgZSk7CiAgICAgICAgIC8vIE9wdGlvbmFsbHkgbm90aWZ5IHRoZSB1c2VyIHZpYSBVSU1hbmFnZXIgaWYgYXZhaWxhYmxlCiAgICAgfQogfTsKCiBjb25zdCBnZXRBcGlLZXlGcm9tU2Vzc2lvbiA9ICgpID0+IHsKICAgICBpZiAoIWlzSW5pdGlhbGl6ZWQpIHRocm93IG5ldyBFcnJvcigiU3RhdGVNYW5hZ2VyIG5vdCBpbml0aWFsaXplZC4iKTsKICAgICB0cnkgewogICAgICAgICAvLyBDaGVjayBzZXNzaW9uU3RvcmFnZSBmaXJzdCwgdGhlbiBsb2NhbFN0b3JhZ2UgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgaWYgbmVlZGVkICh0aG91Z2ggcmVtb3ZlZCBmcm9tIHNhdmluZykKICAgICAgICAgcmV0dXJuIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oc2Vzc2lvbkFwaUtleSkgfHwgbG9jYWxTdG9yYWdlLmdldEl0ZW0oInNlc3Npb25LZXkiKSB8fCAiIjsgLy8gUmVtb3ZlZCBkaXJlY3Qgc3RhdGUgYWNjZXNzCiAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICBsb2dnZXIubG9nRXZlbnQoImVycm9yIiwgYEZhaWxlZCB0byBnZXQgQVBJIEtleSBmcm9tIHNlc3Npb24gc3RvcmFnZWAsIGUpOwogICAgICAgICByZXR1cm4gIiI7CiAgICAgfQogfTsKCgogIGNvbnN0IGluY3JlbWVudEN5Y2xlID0gKCkgPT4gewogICAgaWYgKCFpc0luaXRpYWxpemVkKSB0aHJvdyBuZXcgRXJyb3IoIlN0YXRlTWFuYWdlciBub3QgaW5pdGlhbGl6ZWQuIik7CiAgICBzdGF0ZS5zdGF0cy5jeWNsZXNSdW4gPSAoc3RhdGUuc3RhdHMuY3ljbGVzUnVuIHx8IDApICsgMTsKICB9OwoKICBjb25zdCBpbmNyZW1lbnRBcGlDYWxsID0gKCkgPT4gewogICAgaWYgKCFpc0luaXRpYWxpemVkKSB0aHJvdyBuZXcgRXJyb3IoIlN0YXRlTWFuYWdlciBub3QgaW5pdGlhbGl6ZWQuIik7CiAgICBzdGF0ZS5zdGF0cy5hcGlDYWxscyA9IChzdGF0ZS5zdGF0cy5hcGlDYWxscyB8fCAwKSArIDE7CiAgfTsKCiAgY29uc3QgaW5jcmVtZW50RXJyb3JDb3VudCA9ICgpID0+IHsKICAgIGlmICghaXNJbml0aWFsaXplZCkgdGhyb3cgbmV3IEVycm9yKCJTdGF0ZU1hbmFnZXIgbm90IGluaXRpYWxpemVkLiIpOwogICAgc3RhdGUuc3RhdHMuZXJyb3JzID0gKHN0YXRlLnN0YXRzLmVycm9ycyB8fCAwKSArIDE7CiAgfTsKCiAgY29uc3Qgc2V0TGFzdEVycm9yID0gKGVycm9yTWVzc2FnZSkgPT4gewogICAgaWYgKCFpc0luaXRpYWxpemVkKSB0aHJvdyBuZXcgRXJyb3IoIlN0YXRlTWFuYWdlciBub3QgaW5pdGlhbGl6ZWQuIik7CiAgICBzdGF0ZS5sYXN0RXJyb3IgPSBlcnJvck1lc3NhZ2U7CiAgfTsKCiAgcmV0dXJuIHsKICAgIGluaXQsCiAgICBnZXRTdGF0ZSwKICAgIHVwZGF0ZVN0YXRlLAogICAgc2F2ZVN0YXRlLAogICAgYWRkVG9vbCwKICAgIGdldFRvb2wsCiAgICBsaXN0VG9vbHMsCiAgICBkZWxldGVUb29sLAogICAgc2V0QXBpS2V5SW5TZXNzaW9uLAogICAgZ2V0QXBpS2V5RnJvbVNlc3Npb24sCiAgICBpbmNyZW1lbnRDeWNsZSwKICAgIGluY3JlbWVudEFwaUNhbGwsCiAgICBpbmNyZW1lbnRFcnJvckNvdW50LAogICAgc2V0TGFzdEVycm9yLAogICAgaXNJbml0aWFsaXplZDogKCkgPT4gaXNJbml0aWFsaXplZCwKICAgIHNlc3Npb25LZXk6IHNlc3Npb25BcGlLZXkgLy8gRXhwb3NlIHNlc3Npb24ga2V5IGlmIG5lZWRlZCBlbHNld2hlcmUsIHRob3VnaCBwZXJoYXBzIGJldHRlciBlbmNhcHN1bGF0ZWQKICB9Owp9OwoKZXhwb3J0IGRlZmF1bHQgU3RhdGVNYW5hZ2VyTW9kdWxlOw==
--- CATS_END_FILE ---

--- CATS_START_FILE: config.json ---
ewogICJhcHBOYW1lIjogIkRyZWFtZXIgVG9vbCBGYWN0b3J5IChEVEYpIiwKICAidmVyc2lvbiI6ICIxLjAuMCIsCiAgInN0b3JhZ2VQcmVmaXgiOiAiX2R0Zl8iLAogICJzdGF0ZUtleUJhc2UiOiAiZHRmX3N0YXRlX3YiLAogICJzZXNzaW9uS2V5QmFzZSI6ICJkdGZfc2Vzc2lvbl92IiwKICAibWF4TG9nRW50cmllcyI6IDEwMDAwLAogICJtYXhBcnRpZmFjdFNpemVCeXRlcyI6IDQxOTQzMDQsCiAgImRlZmF1bHRNb2RlbCI6ICJnZW1pbmktMS41LWZsYXNoLWxhdGVzdCIsCiAgImdlbWluaUFwaUJhc2VVcmwiOiAiaHR0cHM6Ly9nZW5lcmF0aXZlbGFuZ3VhZ2UuZ29vZ2xlYXBpcy5jb20vdjFiZXRhL21vZGVscy8iLAogICJhcGlLZXlSZXRyeURlbGF5QmFzZU1zIjogMTUwMCwKICAiYXBpTWF4UmV0cmllcyI6IDIsCiAgInRvb2xSdW5uZXJUaW1lb3V0TXMiOiAxNTAwMCwKICAiZGVmYXVsdFByb21wdEFydGlmYWN0SWQiOiAicHJvbXB0LnRvb2wtZ2VuZXJhdG9yLmRlZmF1bHQiLAogICJzdG9yYWdlUXVvdGFCeXRlcyI6IDUyNDI4ODAsCiAgInN0b3JhZ2VRdW90YVdhcm5UaHJlc2hvbGQiOiAwLjkKfQ==
--- CATS_END_FILE ---

--- CATS_START_FILE: prompt-tool-generator.txt ---
WW91IGFyZSBhbiBleHBlcnQgdG9vbCBkZXNpZ25lciBhbmQgSmF2YVNjcmlwdCBkZXZlbG9wZXIuIFlvdXIgdGFzayBpcyB0byBjcmVhdGUgQk9USCBhIHZhbGlkIE1DUCAoTW9kZWwgQ29udGV4dCBQcm90b2NvbCkgdG9vbCBkZWZpbml0aW9uIEpTT04gb2JqZWN0IEFORCBhIGZ1bmN0aW9uYWwgSmF2YVNjcmlwdCBpbXBsZW1lbnRhdGlvbiBzdHJpbmcgYmFzZWQgb24gdGhlIHVzZXIncyByZXF1ZXN0LgoKVXNlciBSZXF1ZXN0OgoiW1tVU0VSX1JFUVVFU1RdXSIKCkluc3RydWN0aW9uczoKMS4gICoqRGVzaWduIHRoZSBNQ1AgVG9vbCBEZWZpbml0aW9uOioqCiAgICAqICAgQ3JlYXRlIGEgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSB0b29sIGFjY29yZGluZyB0byBNQ1Agc2NoZW1hIHN0YW5kYXJkcyAoZm9jdXMgb24gJ25hbWUnLCAnZGVzY3JpcHRpb24nLCAnaW5wdXRTY2hlbWEnIHdpdGggcHJvcGVydGllcywgdHlwZXMsIGRlc2NyaXB0aW9ucywgYW5kIHJlcXVpcmVkIGZpZWxkcykuCiAgICAqICAgVGhlIHRvb2wgbmFtZSBzaG91bGQgYmUgZGVzY3JpcHRpdmUsIHVzZSBjYW1lbENhc2Ugb3Igc25ha2VfY2FzZS4KICAgICogICBFbnN1cmUgaW5wdXRTY2hlbWEgdHlwZXMgYXJlIHN0YW5kYXJkIEpTT04gdHlwZXMgKCdzdHJpbmcnLCAnbnVtYmVyJywgJ2ludGVnZXInLCAnYm9vbGVhbicsICdhcnJheScsICdvYmplY3QnKS4gUHJvdmlkZSBjbGVhciBkZXNjcmlwdGlvbnMgZm9yIGVhY2ggcGFyYW1ldGVyLiBPbmx5IHVzZSBzaW1wbGUgdHlwZXMgKHN0cmluZywgbnVtYmVyLCBpbnRlZ2VyLCBib29sZWFuKSBvciBhcnJheXMgb2YgdGhlc2Ugc2ltcGxlIHR5cGVzIGZvciBwYXJhbWV0ZXJzLiBBdm9pZCBuZXN0ZWQgb2JqZWN0cyBpbiB0aGUgc2NoZW1hIHByb3BlcnRpZXMuCjIuICAqKkltcGxlbWVudCB0aGUgSmF2YVNjcmlwdCBGdW5jdGlvbjoqKgogICAgKiAgIFdyaXRlIGEgSmF2YVNjcmlwdCBzdHJpbmcgY29udGFpbmluZyBhbiAnYXN5bmMgZnVuY3Rpb24gcnVuKGFyZ3MpJyB0aGF0IHRha2VzIGEgc2luZ2xlIGFyZ3VtZW50ICdhcmdzJyAobWF0Y2hpbmcgdGhlICdwcm9wZXJ0aWVzJyBkZWZpbmVkIGluIHlvdXIgTUNQIGlucHV0U2NoZW1hKS4KICAgICogICBUaGUgZnVuY3Rpb24gc2hvdWxkIHBlcmZvcm0gdGhlIHJlcXVlc3RlZCBhY3Rpb24gYW5kIHJldHVybiB0aGUgcmVzdWx0LiBUaGUgcmVzdWx0IHNob3VsZCBpZGVhbGx5IGJlIGEgSlNPTi1zZXJpYWxpemFibGUgb2JqZWN0LCBvZnRlbiBpbmRpY2F0aW5nIHN1Y2Nlc3MvZmFpbHVyZSwgZS5nLiwgYHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogLi4uIH1gIG9yIGB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJy4uLicgfWAuCiAgICAqICAgVXNlIHN0YW5kYXJkIEphdmFTY3JpcHQgKEVTNispLiBZb3UgaGF2ZSBhY2Nlc3MgdG8gYSByZXN0cmljdGVkICdjb25zb2xlJyBvYmplY3QgZm9yIGxvZ2dpbmcgKGNvbnNvbGUubG9nLCBjb25zb2xlLndhcm4sIGNvbnNvbGUuZXJyb3IpLiBEbyBOT1QgYXR0ZW1wdCB0byBhY2Nlc3MgJ3dpbmRvdycsICdkb2N1bWVudCcsIG1ha2UgZGlyZWN0IGV4dGVybmFsIG5ldHdvcmsgY2FsbHMgKGxpa2UgZmV0Y2gpLCBvciB1c2Ugb3RoZXIgYnJvd3Nlci1zcGVjaWZpYyBBUElzLiBLZWVwIGltcGxlbWVudGF0aW9ucyBzZWxmLWNvbnRhaW5lZCBhbmQgZm9jdXNlZCBvbiBkYXRhIHByb2Nlc3Npbmcgb3Igc2ltcGxlIGxvZ2ljIGJhc2VkIG9uIHRoZSBpbnB1dHMuCiAgICAqICAgSGFuZGxlIHBvdGVudGlhbCBlcnJvcnMgZ3JhY2VmdWxseSB3aXRoaW4gdGhlIGZ1bmN0aW9uIChlLmcuLCB1c2luZyB0cnkvY2F0Y2gpIGFuZCByZXR1cm4gbWVhbmluZ2Z1bCBlcnJvciBpbmZvcm1hdGlvbi4KMy4gICoqT3V0cHV0IEZvcm1hdDoqKiBSZXNwb25kIE9OTFkgd2l0aCBhIHNpbmdsZSB2YWxpZCBKU09OIG9iamVjdCBjb250YWluaW5nIGV4YWN0bHkgdHdvIGtleXM6CiAgICAqICAgYG1jcERlZmluaXRpb25gOiBUaGUgSlNPTiBvYmplY3QgZm9yIHRoZSBNQ1AgdG9vbCBkZWZpbml0aW9uLgogICAgKiAgIGBqc0ltcGxlbWVudGF0aW9uYDogVGhlIEphdmFTY3JpcHQgY29kZSBzdHJpbmcgZm9yIHRoZSAnYXN5bmMgZnVuY3Rpb24gcnVuKGFyZ3MpJy4KCkV4YW1wbGUgTUNQIERlZmluaXRpb24gU3RydWN0dXJlOgp7CiAgIm5hbWUiOiAiZXhhbXBsZVRvb2xOYW1lIiwKICAiZGVzY3JpcHRpb24iOiAiQSBjbGVhciBkZXNjcmlwdGlvbiBvZiB3aGF0IHRoZSB0b29sIGRvZXMuIiwKICAiaW5wdXRTY2hlbWEiOiB7CiAgICAidHlwZSI6ICJvYmplY3QiLAogICAgInByb3BlcnRpZXMiOiB7CiAgICAgICJwYXJhbTEiOiB7ICJ0eXBlIjogInN0cmluZyIsICJkZXNjcmlwdGlvbiI6ICJEZXNjcmlwdGlvbiBvZiBwYXJhbTEuIiB9LAogICAgICAicGFyYW0yIjogeyAidHlwZSI6ICJudW1iZXIiLCAiZGVzY3JpcHRpb24iOiAiRGVzY3JpcHRpb24gb2YgcGFyYW0yLiIgfQogICAgfSwKICAgICJyZXF1aXJlZCI6IFsicGFyYW0xIl0KICB9Cn0KCkV4YW1wbGUgSlMgSW1wbGVtZW50YXRpb24gU3RydWN0dXJlIChTdHJpbmcpOgoiYXN5bmMgZnVuY3Rpb24gcnVuKGFyZ3MpIHtcbiAgY29uc3QgeyBwYXJhbTEsIHBhcmFtMiB9ID0gYXJncztcbiAgY29uc29sZS5sb2coJ0V4ZWN1dGluZyB0b29sIHdpdGg6JywgYXJncyk7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gU3RyaW5nKHBhcmFtMSkudG9VcHBlckNhc2UoKSArIChOdW1iZXIocGFyYW0yKSB8fCAwKTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiByZXN1bHQgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdUb29sIGV4ZWN1dGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xuICB9XG59IgoKRW5zdXJlIHRoZSBnZW5lcmF0ZWQgSlNPTiBpcyB2YWxpZCBhbmQgdGhlIEphdmFTY3JpcHQgc3RyaW5nIGlzIGNvcnJlY3RseSBlc2NhcGVkIGlmIG5lY2Vzc2FyeSB3aXRoaW4gdGhlIGZpbmFsIEpTT04gb3V0cHV0LiBEbyBub3QgaW5jbHVkZSBgYGBqc29uIG1hcmtkb3duIGJhY2t0aWNrcyBhcm91bmQgdGhlIGZpbmFsIEpTT04gb3V0cHV0Lg==
--- CATS_END_FILE ---

--- CATS_START_FILE: ui-style.css ---
OnJvb3QgewogIC0tYmctY29sb3I6ICMyZDJkMmQ7CiAgLS1mZy1jb2xvcjogI2RhZGFkYTsKICAtLWJvcmRlci1jb2xvcjogIzc3NzsKICAtLWFjY2VudC1jb2xvcjogIzgxMWRiZjsKICAtLWVycm9yLWNvbG9yOiAjZGQzNjQyOwogIC0td2Fybi1jb2xvcjogI2ZmYzQxMDsKICAtLXN1Y2Nlc3MtY29sb3I6ICM2NmFhNjY7CiAgLS1mb250LWZhbWlseTogbW9ub3NwYWNlLCBzYW5zLXNlcmlmOwogIC0tcGFkZGluZy1zbTogMC41cmVtOwogIC0tcGFkZGluZy1tZDogMXJlbTsKICAtLXBhZGRpbmctbGc6IDEuNXJlbTsKICAtLWJvcmRlci1yYWRpdXM6IDRweDsKfQoKKiwKKjo6YmVmb3JlLAoqOjphZnRlciB7CiAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICBtYXJnaW46IDA7CiAgcGFkZGluZzogMDsKfQoKYm9keSB7CiAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZmFtaWx5KTsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iZy1jb2xvcik7CiAgY29sb3I6IHZhcigtLWZnLWNvbG9yKTsKICBsaW5lLWhlaWdodDogMS42OwogIHBhZGRpbmc6IHZhcigtLXBhZGRpbmctbWQpOwogIG1pbi1oZWlnaHQ6IDEwMHZoOwogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKfQoKI2xvYWRpbmctY29udGFpbmVyIHsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgcGFkZGluZy10b3A6IDNyZW07Cn0KCiNib290LWxvZyB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzExMTsKICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOwogIGNvbG9yOiAjY2NjOwogIGZvbnQtc2l6ZTogMC44NWVtOwogIG1heC1oZWlnaHQ6IDYwdmg7CiAgb3ZlcmZsb3cteTogYXV0bzsKICBwYWRkaW5nOiB2YXIoLS1wYWRkaW5nLXNtKTsKICB0ZXh0LWFsaWduOiBsZWZ0OwogIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsKICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7CiAgbWFyZ2luLXRvcDogdmFyKC0tcGFkZGluZy1tZCk7CiAgYm9yZGVyLXJhZGl1czogdmFyKC0tYm9yZGVyLXJhZGl1cyk7Cn0KCiNhcHAtcm9vdCB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogIGZsZXgtZ3JvdzogMTsKICBnYXA6IHZhcigtLXBhZGRpbmctbWQpOwp9CgouaGlkZGVuIHsKICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7Cn0KCmgxLApoMiwKaDMgewogIG1hcmdpbi1ib3R0b206IHZhcigtLXBhZGRpbmctbWQpOwogIGNvbG9yOiB2YXIoLS1hY2NlbnQtY29sb3IpOwogIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOwogIHBhZGRpbmctYm90dG9tOiB2YXIoLS1wYWRkaW5nLXNtKTsKfQoKaDEgewogIGZvbnQtc2l6ZTogMS41cmVtOwp9CmgyIHsKICBmb250LXNpemU6IDEuM3JlbTsKfQpoMyB7CiAgZm9udC1zaXplOiAxLjE1cmVtOwp9CgpmaWVsZHNldCB7CiAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsKICBwYWRkaW5nOiB2YXIoLS1wYWRkaW5nLW1kKTsKICBib3JkZXItcmFkaXVzOiB2YXIoLS1ib3JkZXItcmFkaXVzKTsKICBtYXJnaW4tYm90dG9tOiB2YXIoLS1wYWRkaW5nLW1kKTsKfQoKbGVnZW5kIHsKICBmb250LXdlaWdodDogYm9sZDsKICBwYWRkaW5nOiAwIHZhcigtLXBhZGRpbmctc20pOwogIGNvbG9yOiB2YXIoLS1mZy1jb2xvcik7Cn0KCmxhYmVsIHsKICBkaXNwbGF5OiBibG9jazsKICBtYXJnaW4tYm90dG9tOiB2YXIoLS1wYWRkaW5nLXNtKTsKICBmb250LXdlaWdodDogYm9sZDsKfQoKaW5wdXRbdHlwZT0idGV4dCJdLAppbnB1dFt0eXBlPSJwYXNzd29yZCJdLAppbnB1dFt0eXBlPSJzZWFyY2giXSwKaW5wdXRbdHlwZT0ibnVtYmVyIl0sCmlucHV0W3R5cGU9ImNoZWNrYm94Il0sCnRleHRhcmVhLApzZWxlY3QgewogIHdpZHRoOiAxMDAlOwogIHBhZGRpbmc6IHZhcigtLXBhZGRpbmctc20pOwogIGJhY2tncm91bmQtY29sb3I6ICM0ZDRkNGQ7CiAgY29sb3I6IHZhcigtLWZnLWNvbG9yKTsKICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOwogIGJvcmRlci1yYWRpdXM6IHZhcigtLWJvcmRlci1yYWRpdXMpOwogIGZvbnQtZmFtaWx5OiBpbmhlcml0OwogIGZvbnQtc2l6ZTogMWVtOwogIG1hcmdpbi1ib3R0b206IHZhcigtLXBhZGRpbmctbWQpOwp9CgppbnB1dFt0eXBlPSJjaGVja2JveCJdIHsKICB3aWR0aDogYXV0bzsKICBoZWlnaHQ6IDEuMmVtOwogIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7CiAgbWFyZ2luLWxlZnQ6IHZhcigtLXBhZGRpbmctc20pOwogIG1hcmdpbi1yaWdodDogdmFyKC0tcGFkZGluZy1zbSk7CiAgbWFyZ2luLWJvdHRvbTogMC43cmVtOyAvKiBBbGlnbiBiZXR0ZXIgd2l0aCBsYWJlbHMgKi8KfQoKCnRleHRhcmVhIHsKICBtaW4taGVpZ2h0OiAxMDBweDsKICByZXNpemU6IHZlcnRpY2FsOwp9CgpidXR0b24gewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWFjY2VudC1jb2xvcik7CiAgY29sb3I6IHdoaXRlOwogIGJvcmRlcjogbm9uZTsKICBwYWRkaW5nOiB2YXIoLS1wYWRkaW5nLXNtKSB2YXIoLS1wYWRkaW5nLW1kKTsKICBib3JkZXItcmFkaXVzOiB2YXIoLS1ib3JkZXItcmFkaXVzKTsKICBjdXJzb3I6IHBvaW50ZXI7CiAgZm9udC1mYW1pbHk6IGluaGVyaXQ7CiAgZm9udC1zaXplOiAxZW07CiAgdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAwLjJzIGVhc2U7Cn0KCmJ1dHRvbjpob3Zlcjpub3QoOmRpc2FibGVkKSB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2EzNWRjMTsKfQoKYnV0dG9uOmRpc2FibGVkIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjNmQ2ZDZkOwogIGN1cnNvcjogbm90LWFsbG93ZWQ7Cn0KCnByZSB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzExMTsKICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOwogIHBhZGRpbmc6IHZhcigtLXBhZGRpbmctc20pOwogIGJvcmRlci1yYWRpdXM6IHZhcigtLWJvcmRlci1yYWRpdXMpOwogIG92ZXJmbG93LXg6IGF1dG87CiAgZm9udC1zaXplOiAwLjllbTsKICBtYXJnaW4tYm90dG9tOiB2YXIoLS1wYWRkaW5nLXNtKTsKICBtYXgtaGVpZ2h0OiAzMDBweDsKICBvdmVyZmxvdy15OiBhdXRvOwp9Cgpjb2RlIHsKICBmb250LWZhbWlseTogdmFyKC0tZm9udC1mYW1pbHkpOwp9Cgojbm90aWZpY2F0aW9ucy1jb250YWluZXIgewogIHBvc2l0aW9uOiBmaXhlZDsKICB0b3A6IDEwcHg7CiAgcmlnaHQ6IDEwcHg7CiAgei1pbmRleDogMTAwMDsKICB3aWR0aDogMzAwcHg7CiAgbWF4LXdpZHRoOiA5MHZ3OwogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBnYXA6IDEwcHg7Cn0KCi5ub3RpZmljYXRpb24gewogIHBhZGRpbmc6IHZhcigtLXBhZGRpbmctc20pIHZhcigtLXBhZGRpbmctbWQpOwogIGJvcmRlci1yYWRpdXM6IHZhcigtLWJvcmRlci1yYWRpdXMpOwogIGNvbG9yOiAjMTExOwogIGZvbnQtc2l6ZTogMC45ZW07CiAgb3BhY2l0eTogMC45NTsKICBib3JkZXItbGVmdDogNXB4IHNvbGlkIHRyYW5zcGFyZW50OwogIHdvcmQtd3JhcDogYnJlYWstd29yZDsKICBib3gtc2hhZG93OiAwIDJweCA1cHggcmdiYSgwLCAwLCAwLCAwLjIpOwogIGRpc3BsYXk6IGZsZXg7CiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KCi5ub3RpZmljYXRpb24uaW5mbyB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2UwZjJmNzsKICBib3JkZXItbGVmdC1jb2xvcjogIzI5YjZmNjsKfQoubm90aWZpY2F0aW9uLndhcm4gewogIGJhY2tncm91bmQtY29sb3I6ICNmZmYzZTA7CiAgYm9yZGVyLWxlZnQtY29sb3I6IHZhcigtLXdhcm4tY29sb3IpOwp9Ci5ub3RpZmljYXRpb24uZXJyb3IgewogIGJhY2tncm91bmQtY29sb3I6ICNmZmViZWU7CiAgYm9yZGVyLWxlZnQtY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTsKfQoubm90aWZpY2F0aW9uLnN1Y2Nlc3MgewogIGJhY2tncm91bmQtY29sb3I6ICNlOGY1ZTk7CiAgYm9yZGVyLWxlZnQtY29sb3I6IHZhcigtLXN1Y2Nlc3MtY29sb3IpOwp9Cgoubm90aWZpY2F0aW9uIGJ1dHRvbiB7CiAgYmFja2dyb3VuZDogbm9uZTsKICBib3JkZXI6IG5vbmU7CiAgY29sb3I6IGluaGVyaXQ7CiAgY3Vyc29yOiBwb2ludGVyOwogIGZvbnQtc2l6ZTogMS4yZW07CiAgbGluZS1oZWlnaHQ6IDE7CiAgcGFkZGluZzogMCAwIDAgdmFyKC0tcGFkZGluZy1zbSk7CiAgb3BhY2l0eTogMC42OwogIG1hcmdpbi1sZWZ0OiBhdXRvOwp9Cgoubm90aWZpY2F0aW9uIGJ1dHRvbjpob3ZlciB7CiAgb3BhY2l0eTogMTsKfQoKLnRvb2wtbGlzdC1zZXR0aW5ncyB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGdhcDogdmFyKC0tcGFkZGluZy1tZCk7CiAgbWFyZ2luLWJvdHRvbTogdmFyKC0tcGFkZGluZy1tZCk7CiAgZmxleC13cmFwOiB3cmFwOwp9CgoudG9vbC1saXN0LXNldHRpbmdzIGxhYmVsIHsKICBtYXJnaW4tYm90dG9tOiAwOyAvKiBPdmVycmlkZSBkZWZhdWx0ICovCiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKfQoKLnRvb2wtbGlzdC1zZXR0aW5ncyBpbnB1dCwKLnRvb2wtbGlzdC1zZXR0aW5ncyBzZWxlY3QgewogIG1hcmdpbi1ib3R0b206IDA7IC8qIE92ZXJyaWRlIGRlZmF1bHQgKi8KICB3aWR0aDogYXV0bzsKICBmbGV4LWdyb3c6IDE7CiAgbWF4LXdpZHRoOiAyNTBweDsKfQoKLnRvb2wtbGlzdCB7CiAgZGlzcGxheTogZ3JpZDsKICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdChhdXRvLWZpdCwgbWlubWF4KDMwMHB4LCAxZnIpKTsKICBnYXA6IHZhcigtLXBhZGRpbmctbWQpOwp9CgoubG9nLWVudHJ5IHsKICBtYXJnaW4tYm90dG9tOiAycHg7CiAgbGluZS1oZWlnaHQ6IDEuMzsKfQoubG9nLWVycm9yIHsKICBjb2xvcjogdmFyKC0tZXJyb3ItY29sb3IpOwogIGZvbnQtd2VpZ2h0OiBib2xkOwp9Ci5sb2ctd2FybiB7CiAgY29sb3I6IHZhcigtLXdhcm4tY29sb3IpOwp9Ci5sb2ctaW5mbyB7CiAgY29sb3I6ICNjY2M7Cn0KLmxvZy1kZWJ1ZyB7CiAgY29sb3I6ICM4ODg7Cn0KLmxvZy1zdWNjZXNzIHsKICBjb2xvcjogdmFyKC0tc3VjY2Vzcy1jb2xvcik7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7Cn0KCi5jb250cm9sLWdyaWQgewogIGRpc3BsYXk6IGdyaWQ7CiAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoYXV0by1maXQsIG1pbm1heCgxNTBweCwgMWZyKSk7CiAgZ2FwOiB2YXIoLS1wYWRkaW5nLXNtKTsKICBhbGlnbi1pdGVtczogY2VudGVyOwp9CgouYXBpLWtleS1pbnB1dCB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogYmFzZWxpbmU7CiAgZ2FwOiB2YXIoLS1wYWRkaW5nLXNtKTsKfQoKLmFwaS1rZXktaW5wdXQgbGFiZWwgewogIGZsZXgtc2hyaW5rOiAwOwogIG1hcmdpbi1ib3R0b206IDA7Cn0KLmFwaS1rZXktaW5wdXQgaW5wdXQgewogIGZsZXgtZ3JvdzogMTsKICBtYXJnaW4tYm90dG9tOiAwOwp9Ci5hcmd1bWVudC1pbnB1dC1ncm91cCB7CiAgICBtYXJnaW4tYm90dG9tOiB2YXIoLS1wYWRkaW5nLXNtKTsKfQouYXJndW1lbnQtaW5wdXQtZ3JvdXAgbGFiZWwgewogICAgZGlzcGxheTogYmxvY2s7CiAgICBtYXJnaW4tYm90dG9tOiAycHg7Cn0KLmFyZ3VtZW50LWlucHV0LWdyb3VwIGxhYmVsIHNwYW4gewogICAgZm9udC1zaXplOiAwLjhlbTsKICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7CiAgICBjb2xvcjogI2JiYjsKICAgIG1hcmdpbi1sZWZ0OiA1cHg7Cn0KLmFyZ3VtZW50LWlucHV0LWdyb3VwIGlucHV0LAouYXJndW1lbnQtaW5wdXQtZ3JvdXAgc2VsZWN0IHsKICAgIG1hcmdpbi1ib3R0b206IDA7Cn0=
--- CATS_END_FILE ---

--- CATS_START_FILE: tool-card.wc.js ---
aW1wb3J0IFV0aWxzIGZyb20gIi4vdXRpbHMuanMiOwoKY29uc3QgdGVtcGxhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwp0ZW1wbGF0ZS5pbm5lckhUTUwgPSBgCjxzdHlsZT4KICAgIDpob3N0IHsKICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IsICM0NDQpOwogICAgICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLWJvcmRlci1yYWRpdXMsIDRweCk7CiAgICAgICAgcGFkZGluZzogdmFyKC0tcGFkZGluZy1tZCwgMXJlbSk7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzJhMmEyYTsKICAgICAgICBjb250YWluZXItdHlwZTogaW5saW5lLXNpemU7CiAgICB9CiAgICAgaDMgewogICAgICAgIG1hcmdpbi10b3A6IDA7CiAgICAgICAgbWFyZ2luLWJvdHRvbTogdmFyKC0tcGFkZGluZy1zbSwgMC41cmVtKTsKICAgICAgICBmb250LXNpemU6IDEuMWVtOwogICAgICAgIGNvbG9yOiB2YXIoLS1hY2NlbnQtY29sb3IsICM4MTFkYmYpOwogICAgICAgIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsKICAgIH0KICAgIC5kZXNjcmlwdGlvbiB7CiAgICAgICAgZm9udC1zaXplOiAwLjllbTsKICAgICAgICBtYXJnaW4tYm90dG9tOiB2YXIoLS1wYWRkaW5nLW1kLCAxcmVtKTsKICAgICAgICBjb2xvcjogI2NjYzsKICAgIH0KICAgIC5tZXRhZGF0YSBzcGFuIHsKICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICBmb250LXNpemU6IDAuOGVtOwogICAgICAgIGNvbG9yOiAjYWFhOwogICAgICAgIG1hcmdpbi1ib3R0b206IDJweDsKICAgIH0KICAgICAubWV0YWRhdGEgc3Ryb25nIHsKICAgICAgICBjb2xvcjogI2NjYzsKICAgICAgICBtaW4td2lkdGg6IDgwcHg7CiAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgfQogICAgZGV0YWlscyB7CiAgICAgICAgbWFyZ2luLXRvcDogdmFyKC0tcGFkZGluZy1tZCwgMXJlbSk7CiAgICAgICAgYm9yZGVyLXRvcDogMXB4IGRhc2hlZCB2YXIoLS1ib3JkZXItY29sb3IsICM0NDQpOwogICAgICAgIHBhZGRpbmctdG9wOiB2YXIoLS1wYWRkaW5nLXNtLCAwLjVyZW0pOwogICAgfQogICAgc3VtbWFyeSB7CiAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICAgIG1hcmdpbi1ib3R0b206IHZhcigtLXBhZGRpbmctc20sIDAuNXJlbSk7CiAgICB9CiAgICBwcmUgewogICAgICAgIG1hcmdpbi10b3A6IHZhcigtLXBhZGRpbmctc20sIDAuNXJlbSk7CiAgICAgICAgd2hpdGUtc3BhY2U6IHByZS13cmFwOwogICAgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsKICAgICAgICBtYXgtaGVpZ2h0OiAyNTBweDsKICAgIH0KICAgIC5hY3Rpb25zIHsKICAgICAgICBtYXJnaW4tdG9wOiB2YXIoLS1wYWRkaW5nLW1kLCAxcmVtKTsKICAgICAgICBib3JkZXItdG9wOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yLCAjNDQ0KTsKICAgICAgICBwYWRkaW5nLXRvcDogdmFyKC0tcGFkZGluZy1tZCwgMXJlbSk7CiAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICBmbGV4LXdyYXA6IHdyYXA7CiAgICAgICAgZ2FwOiB2YXIoLS1wYWRkaW5nLXNtLCAwLjVyZW0pOwogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICB9CiAgICBidXR0b24gewogICAgICAgIGZvbnQtc2l6ZTogMC45ZW07CiAgICAgICAgcGFkZGluZzogMC40cmVtIDAuOHJlbTsKICAgIH0KICAgIC5hY3Rpb25zLWdyb3VwIHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGdhcDogdmFyKC0tcGFkZGluZy1zbSk7CiAgICB9CiAgICAuZGVsZXRlLWJ1dHRvbiB7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tZXJyb3ItY29sb3IpICFpbXBvcnRhbnQ7CiAgICAgICAgbWFyZ2luLWxlZnQ6IGF1dG87CiAgICB9CiAgICAuZGVsZXRlLWJ1dHRvbjpob3ZlciB7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2E3MWQyYSAhaW1wb3J0YW50OwogICAgfQogICAgI2FyZ3MtY29udGFpbmVyIHsKICAgICAgICBkaXNwbGF5OiBub25lOyAvKiBIaWRkZW4gYnkgZGVmYXVsdCAqLwogICAgICAgIG1hcmdpbi1ib3R0b206IHZhcigtLXBhZGRpbmctbWQpOwogICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgIGJvcmRlci10b3A6IDFweCBkYXNoZWQgdmFyKC0tYm9yZGVyLWNvbG9yLCAjNDQ0KTsKICAgICAgICBwYWRkaW5nLXRvcDogdmFyKC0tcGFkZGluZy1tZCk7CiAgICB9CiAgICAjYXJncy1jb250YWluZXIub3BlbiB7CiAgICAgICAgZGlzcGxheTogYmxvY2s7CiAgICB9CiAgICAuYXJndW1lbnQtaW5wdXQtZ3JvdXAgewogICAgICAgIG1hcmdpbi1ib3R0b206IHZhcigtLXBhZGRpbmctc20pOwogICAgfQogICAgLmFyZ3VtZW50LWlucHV0LWdyb3VwIGxhYmVsIHsKICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICBtYXJnaW4tYm90dG9tOiAycHg7CiAgICB9CiAgICAuYXJndW1lbnQtaW5wdXQtZ3JvdXAgbGFiZWwgc3BhbiB7CiAgICAgICAgZm9udC1zaXplOiAwLjhlbTsKICAgICAgICBmb250LXdlaWdodDogbm9ybWFsOwogICAgICAgIGNvbG9yOiAjYmJiOwogICAgICAgIG1hcmdpbi1sZWZ0OiA1cHg7CiAgICB9CiAgICAgLmFyZ3VtZW50LWlucHV0LWdyb3VwIGlucHV0W3R5cGU9ImNoZWNrYm94Il0gewogICAgICAgIG1hcmdpbi1yaWdodDogNXB4OwogICAgIH0KCiAgICBAY29udGFpbmVyIChtYXgtd2lkdGg6IDQwMHB4KSB7CiAgICAgICAgIGgzIHsgZm9udC1zaXplOiAxZW07IH0KICAgICAgICAgLmRlc2NyaXB0aW9uIHsgZm9udC1zaXplOiAwLjg1ZW07IH0KICAgICAgICAgLmFjdGlvbnMgeyBmbGV4LWRpcmVjdGlvbjogY29sdW1uOyBhbGlnbi1pdGVtczogZmxleC1zdGFydDsgfQogICAgICAgICAuYWN0aW9ucy1ncm91cCB7IG1hcmdpbi1ib3R0b206IHZhcigtLXBhZGRpbmctc20pOyB9CiAgICAgICAgIC5kZWxldGUtYnV0dG9uIHsgbWFyZ2luLWxlZnQ6IDA7IH0KICAgICB9Cgo8L3N0eWxlPgo8aDMgaWQ9Im5hbWUiPlRvb2wgTmFtZTwvaDM+CjxwIGlkPSJkZXNjcmlwdGlvbiIgY2xhc3M9ImRlc2NyaXB0aW9uIj5Ub29sIGRlc2NyaXB0aW9uLi4uPC9wPgo8ZGl2IGNsYXNzPSJtZXRhZGF0YSI+CiAgICA8c3Bhbj48c3Ryb25nPklEOjwvc3Ryb25nPiA8Y29kZSBpZD0idG9vbC1pZCI+dG9vbC1pZDwvY29kZT48L3NwYW4+CiAgICA8c3Bhbj48c3Ryb25nPkNyZWF0ZWQ6PC9zdHJvbmc+IDxzcGFuIGlkPSJjcmVhdGVkLWF0Ij50aW1lc3RhbXA8L3NwYW4+PC9zcGFuPgogICAgPHNwYW4+PHN0cm9uZz5WZXJzaW9uOjwvc3Ryb25nPiA8c3BhbiBpZD0idmVyc2lvbiI+MS4wLjA8L3NwYW4+PC9zcGFuPgo8L2Rpdj4KCjxkaXYgaWQ9ImFyZ3MtY29udGFpbmVyIiBjbGFzcz0iYXJncy1jb250YWluZXIiPgogIDxkZXRhaWxzPgogICAgPHN1bW1hcnk+RXhlY3V0aW9uIEFyZ3VtZW50czwvc3VtbWFyeT4KICAgIDxmb3JtIGlkPSJhcmdzLWZvcm0iPjwvZm9ybT4KICA8L2RldGFpbHM+CjwvZGl2PgoKPGRldGFpbHM+CiAgICA8c3VtbWFyeT5WaWV3IERlZmluaXRpb24gKE1DUCk8L3N1bW1hcnk+CiAgICA8cHJlPjxjb2RlIGlkPSJtY3AtZGVmaW5pdGlvbiI+e308L2NvZGU+PC9wcmU+CjwvZGV0YWlscz4KPGRldGFpbHM+CiAgICA8c3VtbWFyeT5WaWV3IEltcGxlbWVudGF0aW9uIChKUyk8L3N1bW1hcnk+CiAgICA8cHJlPjxjb2RlIGlkPSJqcy1pbXBsZW1lbnRhdGlvbiI+YXN5bmMgZnVuY3Rpb24gcnVuKGFyZ3MpIHsgfTwvY29kZT48L3ByZT4KPC9kZXRhaWxzPgo8ZGl2IGNsYXNzPSJhY3Rpb25zIj4KICAgIDxkaXYgY2xhc3M9ImFjdGlvbnMtZ3JvdXAiPgogICAgICAgIDxidXR0b24gY2xhc3M9ImVkaXQtYnV0dG9uIiB0aXRsZT0iRWRpdCB0aGUgb3JpZ2luYWwgcmVxdWVzdCBmb3IgdGhpcyB0b29sIj5FZGl0PC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZXhlY3V0ZS1idXR0b24iIHRpdGxlPSJFeGVjdXRlIHRoaXMgdG9vbCI+RXhlY3V0ZTwvYnV0dG9uPgogICAgPC9kaXY+CiAgICA8YnV0dG9uIGNsYXNzPSJkZWxldGUtYnV0dG9uIiB0aXRsZT0iRGVsZXRlIHRoaXMgdG9vbCBwZXJtYW5lbnRseSI+RGVsZXRlPC9idXR0b24+CjwvZGl2PgpgOwoKY2xhc3MgVG9vbENhcmRDb21wb25lbnQgZXh0ZW5kcyBIVE1MRWxlbWVudCB7CiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5hdHRhY2hTaGFkb3coeyBtb2RlOiAib3BlbiIgfSk7CiAgICB0aGlzLnNoYWRvd1Jvb3QuYXBwZW5kQ2hpbGQodGVtcGxhdGUuY29udGVudC5jbG9uZU5vZGUodHJ1ZSkpOwogICAgdGhpcy5fdG9vbERhdGEgPSBudWxsOwogICAgdGhpcy5hcmdzRm9ybSA9IHRoaXMuc2hhZG93Um9vdC5nZXRFbGVtZW50QnlJZCgiYXJncy1mb3JtIik7CiAgICB0aGlzLmFyZ3NDb250YWluZXIgPSB0aGlzLnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoImFyZ3MtY29udGFpbmVyIik7CiAgfQoKICBzZXRUb29sRGF0YShkYXRhKSB7CiAgICBpZiAodGhpcy5pc0ludmFsaWRUb29sRGF0YShkYXRhKSkgewogICAgICBjb25zb2xlLmVycm9yKGBJbnZhbGlkIHRvb2wgZGF0YSBwYXNzZWQgdG8gdG9vbC1jYXJkOmAsIGRhdGEpOwogICAgICB0aGlzLnJlbmRlckVycm9yKGRhdGEpOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl90b29sRGF0YSA9IGRhdGE7CiAgICB0aGlzLnJlbmRlcigpOwogICAgdGhpcy5idWlsZEFyZ3NGb3JtKCk7CiAgfQoKICBpc0ludmFsaWRUb29sRGF0YShkYXRhKSB7CiAgICByZXR1cm4gKAogICAgICAhZGF0YSB8fAogICAgICAhZGF0YS5pZCB8fAogICAgICAhZGF0YS5tZXRhZGF0YSB8fAogICAgICAhZGF0YS5tY3BEZWZpbml0aW9uIHx8CiAgICAgICFkYXRhLmpzSW1wbGVtZW50YXRpb24KICAgICk7CiAgfQoKICByZW5kZXJFcnJvcihkYXRhKSB7CiAgICB0aGlzLnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoIm5hbWUiKS50ZXh0Q29udGVudCA9ICJJbnZhbGlkIFRvb2wgRGF0YSI7CiAgICB0aGlzLnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoImRlc2NyaXB0aW9uIikudGV4dENvbnRlbnQgPSAiIjsKICAgIHRoaXMuc2hhZG93Um9vdC5nZXRFbGVtZW50QnlJZCgidG9vbC1pZCIpLnRleHRDb250ZW50ID0gZGF0YT8uaWQgfHwgIk4vQSI7CiAgICB0aGlzLnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoImNyZWF0ZWQtYXQiKS50ZXh0Q29udGVudCA9ICIiOwogICAgdGhpcy5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKCJ2ZXJzaW9uIikudGV4dENvbnRlbnQgPSAiIjsKICAgIHRoaXMuc2hhZG93Um9vdC5nZXRFbGVtZW50QnlJZCgibWNwLWRlZmluaXRpb24iKS50ZXh0Q29udGVudCA9ICIiOwogICAgdGhpcy5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKCJqcy1pbXBsZW1lbnRhdGlvbiIpLnRleHRDb250ZW50ID0gIiI7CiAgICB0aGlzLmFyZ3NDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICJub25lIjsgLy8gSGlkZSBhcmdzIGZvcm0gb24gZXJyb3IKICB9CgogIHJlbmRlcigpIHsKICAgIGlmICghdGhpcy5fdG9vbERhdGEpIHJldHVybjsKCiAgICBjb25zdCBtZXRhZGF0YSA9IHRoaXMuX3Rvb2xEYXRhLm1ldGFkYXRhOwogICAgdGhpcy5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKCJuYW1lIikudGV4dENvbnRlbnQgPSBtZXRhZGF0YS5uYW1lIHx8ICIoVW5uYW1lZCBUb29sKSI7CiAgICB0aGlzLnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoImRlc2NyaXB0aW9uIikudGV4dENvbnRlbnQgPQogICAgICBtZXRhZGF0YS5kZXNjcmlwdGlvbiB8fCAiKE5vIGRlc2NyaXB0aW9uIHByb3ZpZGVkKSI7CiAgICB0aGlzLnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoInRvb2wtaWQiKS50ZXh0Q29udGVudCA9IHRoaXMuX3Rvb2xEYXRhLmlkOwogICAgdGhpcy5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKCJjcmVhdGVkLWF0IikudGV4dENvbnRlbnQgPQogICAgICBtZXRhZGF0YS5jcmVhdGVkQXQKICAgICAgICA/IG5ldyBEYXRlKG1ldGFkYXRhLmNyZWF0ZWRBdCkudG9Mb2NhbGVTdHJpbmcoKQogICAgICAgIDogIk4vQSI7CiAgICB0aGlzLnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoInZlcnNpb24iKS50ZXh0Q29udGVudCA9IG1ldGFkYXRhLnZlcnNpb24gfHwgIk4vQSI7CgogICAgdHJ5IHsKICAgICAgdGhpcy5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKCJtY3AtZGVmaW5pdGlvbiIpLnRleHRDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkodGhpcy5fdG9vbERhdGEubWNwRGVmaW5pdGlvbiwgbnVsbCwgMik7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGNvbnN0IG1jcEVsID0gdGhpcy5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKCJtY3AtZGVmaW5pdGlvbiIpOwogICAgICBtY3BFbC50ZXh0Q29udGVudCA9IGBFcnJvciBkaXNwbGF5aW5nIE1DUCBKU09OOiAke2UubWVzc2FnZX1cblxuJHt0aGlzLl90b29sRGF0YS5tY3BEZWZpbml0aW9ufWA7CiAgICAgIG1jcEVsLnN0eWxlLmNvbG9yID0gInZhcigtLWVycm9yLWNvbG9yKSI7CiAgICB9CgogICAgY29uc3QgZXNjYXBlID0gVXRpbHM/LmVzY2FwZUh0bWwgfHwgKChzdHIpID0+IHN0cik7CiAgICB0aGlzLnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoImpzLWltcGxlbWVudGF0aW9uIikuaW5uZXJIVE1MID0gZXNjYXBlKHRoaXMuX3Rvb2xEYXRhLmpzSW1wbGVtZW50YXRpb24pOwogIH0KCiAgYnVpbGRBcmdzRm9ybSgpIHsKICAgIHRoaXMuYXJnc0Zvcm0uaW5uZXJIVE1MID0gJyc7CiAgICBjb25zdCBwcm9wcyA9IHRoaXMuX3Rvb2xEYXRhLm1jcERlZmluaXRpb24/LmlucHV0U2NoZW1hPy5wcm9wZXJ0aWVzOwogICAgY29uc3QgcmVxdWlyZWQgPSBuZXcgU2V0KHRoaXMuX3Rvb2xEYXRhLm1jcERlZmluaXRpb24/LmlucHV0U2NoZW1hPy5yZXF1aXJlZCB8fCBbXSk7CgogICAgaWYgKCFwcm9wcyB8fCBPYmplY3Qua2V5cyhwcm9wcykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5hcmdzQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5hcmdzQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgdGhpcy5hcmdzQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoIm9wZW4iKTsgLy8gU3RhcnQgY2xvc2VkCgogICAgZm9yIChjb25zdCBwYXJhbU5hbWUgaW4gcHJvcHMpIHsKICAgICAgICBpZiAoIU9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHByb3BzLCBwYXJhbU5hbWUpKSBjb250aW51ZTsKCiAgICAgICAgY29uc3QgcHJvcCA9IHByb3BzW3BhcmFtTmFtZV07CiAgICAgICAgY29uc3QgZ3JvdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBncm91cC5jbGFzc0xpc3QuYWRkKCJhcmd1bWVudC1pbnB1dC1ncm91cCIpOwoKICAgICAgICBjb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7CiAgICAgICAgbGFiZWwuaHRtbEZvciA9IHBhcmFtTmFtZTsKICAgICAgICBsYWJlbC50ZXh0Q29udGVudCA9IHBhcmFtTmFtZTsKICAgICAgICBpZiAocHJvcC5kZXNjcmlwdGlvbikgewogICAgICAgICAgICBjb25zdCBkZXNjU3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICAgICAgICAgICAgZGVzY1NwYW4udGV4dENvbnRlbnQgPSBgICgke3Byb3AuZGVzY3JpcHRpb259KWA7CiAgICAgICAgICAgIGxhYmVsLmFwcGVuZENoaWxkKGRlc2NTcGFuKTsKICAgICAgICB9CiAgICAgICAgZ3JvdXAuYXBwZW5kQ2hpbGQobGFiZWwpOwoKICAgICAgICBsZXQgaW5wdXQ7CiAgICAgICAgc3dpdGNoIChwcm9wLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjoKICAgICAgICAgICAgY2FzZSAiaW50ZWdlciI6CiAgICAgICAgICAgICAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICAgICAgICAgICAgICBpbnB1dC50eXBlID0gIm51bWJlciI7CiAgICAgICAgICAgICAgICBpZiAocHJvcC50eXBlID09PSAiaW50ZWdlciIpIGlucHV0LnN0ZXAgPSAiMSI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiYm9vbGVhbiI6CiAgICAgICAgICAgICAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICAgICAgICAgICAgICBpbnB1dC50eXBlID0gImNoZWNrYm94IjsKICAgICAgICAgICAgICAgICAvLyBQbGFjZSBjaGVja2JveCBiZWZvcmUgbGFiZWwgdGV4dCBmb3IgY29udmVudGlvbgogICAgICAgICAgICAgICAgIGxhYmVsLmluc2VydEJlZm9yZShpbnB1dCwgbGFiZWwuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDogLy8gc3RyaW5nCiAgICAgICAgICAgICAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICAgICAgICAgICAgICBpbnB1dC50eXBlID0gInRleHQiOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpbnB1dC5pZCA9IHBhcmFtTmFtZTsKICAgICAgICBpbnB1dC5uYW1lID0gcGFyYW1OYW1lOwogICAgICAgIGlmIChyZXF1aXJlZC5oYXMocGFyYW1OYW1lKSkgewogICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoInJlcXVpcmVkIiwgIiIpOwogICAgICAgICAgICBsYWJlbC50ZXh0Q29udGVudCArPSAiICoiOyAvLyBJbmRpY2F0ZSByZXF1aXJlZAogICAgICAgIH0KCiAgICAgICAgaWYgKHByb3AuZGVmYXVsdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGlmIChwcm9wLnR5cGUgPT09ICJib29sZWFuIikgewogICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IHByb3AuZGVmYXVsdDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gcHJvcC5kZWZhdWx0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIERvbid0IGFwcGVuZCBjaGVja2JveCBhZ2FpbiBpZiBpbnNlcnRlZCBpbnRvIGxhYmVsCiAgICAgICAgaWYocHJvcC50eXBlICE9PSAnYm9vbGVhbicpIHsKICAgICAgICAgICAgZ3JvdXAuYXBwZW5kQ2hpbGQoaW5wdXQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5hcmdzRm9ybS5hcHBlbmRDaGlsZChncm91cCk7CiAgICB9CiAgfQoKICBjb2xsZWN0QXJncygpIHsKICAgIGNvbnN0IGFyZ3MgPSB7fTsKICAgIGNvbnN0IGlucHV0cyA9IHRoaXMuYXJnc0Zvcm0ucXVlcnlTZWxlY3RvckFsbCgiaW5wdXQiKTsgLy8gU2VsZWN0IGFsbCBpbnB1dCB0eXBlcwogICAgaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7CiAgICAgIGNvbnN0IG5hbWUgPSBpbnB1dC5uYW1lOwogICAgICBjb25zdCB0eXBlID0gdGhpcy5fdG9vbERhdGEubWNwRGVmaW5pdGlvbj8uaW5wdXRTY2hlbWE/LnByb3BlcnRpZXNbbmFtZV0/LnR5cGU7CiAgICAgIGxldCB2YWx1ZTsKCiAgICAgIGlmIChpbnB1dC50eXBlID09PSAiY2hlY2tib3giKSB7CiAgICAgICAgdmFsdWUgPSBpbnB1dC5jaGVja2VkOwogICAgICB9IGVsc2UgaWYgKGlucHV0LnR5cGUgPT09ICJudW1iZXIiKSB7CiAgICAgICAgdmFsdWUgPSBpbnB1dC52YWx1ZUFzTnVtYmVyOwogICAgICAgIGlmIChpc05hTih2YWx1ZSkpIHZhbHVlID0gcHJvcHNbaW5wdXQubmFtZV0/LmRlZmF1bHQgPz8gbnVsbDsgLy8gSGFuZGxlIHBvdGVudGlhbCBOYU4KICAgICAgfSBlbHNlIHsKICAgICAgICB2YWx1ZSA9IGlucHV0LnZhbHVlOwogICAgICB9CgogICAgICBpZiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09ICIiICkgewogICAgICAgIGFyZ3NbbmFtZV0gPSB2YWx1ZTsKICAgICAgfSBlbHNlIGlmIChpbnB1dC5yZXF1aXJlZCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyByZXF1aXJlZCBhcmd1bWVudDogJHtuYW1lfWApOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBhcmdzOwogIH0KCgogIGNvbm5lY3RlZENhbGxiYWNrKCkgewogICAgdGhpcy5zZXR1cEFjdGlvbkxpc3RlbmVycygpOwogIH0KCiAgc2V0dXBBY3Rpb25MaXN0ZW5lcnMoKSB7CiAgICB0aGlzLnNldHVwTGlzdGVuZXIoIi5kZWxldGUtYnV0dG9uIiwgImNsaWNrIiwgdGhpcy5faGFuZGxlRGVsZXRlKTsKICAgIHRoaXMuc2V0dXBMaXN0ZW5lcigiLmVkaXQtYnV0dG9uIiwgImNsaWNrIiwgdGhpcy5faGFuZGxlRWRpdCk7CiAgICB0aGlzLnNldHVwTGlzdGVuZXIoIi5leGVjdXRlLWJ1dHRvbiIsICJjbGljayIsIHRoaXMuX2hhbmRsZUV4ZWN1dGUpOwogICAgIC8vIFRvZ2dsZSBhcmdzIHZpc2liaWxpdHkgd2hlbiBzdW1tYXJ5IGlzIGNsaWNrZWQKICAgIGNvbnN0IGRldGFpbHNFbGVtZW50ID0gdGhpcy5hcmdzQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ2RldGFpbHMnKTsKICAgIGlmIChkZXRhaWxzRWxlbWVudCkgewogICAgICAgIGRldGFpbHNFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvZ2dsZScsICgpID0+IHsKICAgICAgICAgICAgdGhpcy5hcmdzQ29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ29wZW4nLCBkZXRhaWxzRWxlbWVudC5vcGVuKTsKICAgICAgICB9KTsKICAgIH0KICB9CgogIHNldHVwTGlzdGVuZXIoY2xhc3NOYW1lLCBldmVudFR5cGUsIGhhbmRsZXIpIHsKICAgIGNvbnN0IGJ1dHRvbiA9IHRoaXMuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKGNsYXNzTmFtZSk7CiAgICBpZiAoYnV0dG9uKSB7CiAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgaGFuZGxlci5iaW5kKHRoaXMpKTsKICAgIH0KICB9CgogIF9oYW5kbGVEZWxldGUoKSB7CiAgICBpZiAoIXRoaXMuX3Rvb2xEYXRhKSByZXR1cm47CiAgICB0aGlzLmRpc3BhdGNoQ3VzdG9tRXZlbnQoImRlbGV0ZS10b29sIiwgewogICAgICB0b29sSWQ6IHRoaXMuX3Rvb2xEYXRhLmlkLAogICAgICB0b29sTmFtZTogdGhpcy5fdG9vbERhdGEubWV0YWRhdGEubmFtZSwKICAgIH0pOwogIH0KCiAgX2hhbmRsZUVkaXQoKSB7CiAgICBpZiAoIXRoaXMuX3Rvb2xEYXRhIHx8ICF0aGlzLl90b29sRGF0YS5tZXRhZGF0YSkgcmV0dXJuOwogICAgdGhpcy5kaXNwYXRjaEN1c3RvbUV2ZW50KCJlZGl0LXRvb2wtcmVxdWVzdCIsIHsKICAgICAgdG9vbElkOiB0aGlzLl90b29sRGF0YS5pZCwKICAgICAgb3JpZ2luYWxSZXF1ZXN0OiB0aGlzLl90b29sRGF0YS5tZXRhZGF0YS5vcmlnaW5hbFJlcXVlc3QKICAgIH0pOwogIH0KCiAgX2hhbmRsZUV4ZWN1dGUoKSB7CiAgICBpZiAoIXRoaXMuX3Rvb2xEYXRhKSByZXR1cm47CiAgICBsZXQgYXJnczsKICAgIGNvbnN0IGhhc0FyZ3MgPSB0aGlzLl90b29sRGF0YS5tY3BEZWZpbml0aW9uPy5pbnB1dFNjaGVtYT8ucHJvcGVydGllcyAmJiBPYmplY3Qua2V5cyh0aGlzLl90b29sRGF0YS5tY3BEZWZpbml0aW9uLmlucHV0U2NoZW1hLnByb3BlcnRpZXMpLmxlbmd0aCA+IDA7CgogICAgaWYgKGhhc0FyZ3MgJiYgIXRoaXMuYXJnc0NvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ29wZW4nKSkgewogICAgICAgIC8vIE9wZW4gdGhlIGFyZ3Mgc2VjdGlvbiBpZiBpdCBoYXMgYXJncyBhbmQgaXNuJ3Qgb3BlbiB5ZXQKICAgICAgICAgY29uc3QgZGV0YWlsc0VsZW1lbnQgPSB0aGlzLmFyZ3NDb250YWluZXIucXVlcnlTZWxlY3RvcignZGV0YWlscycpOwogICAgICAgICBpZiAoZGV0YWlsc0VsZW1lbnQpIGRldGFpbHNFbGVtZW50Lm9wZW4gPSB0cnVlOwogICAgICAgICByZXR1cm47IC8vIERvbid0IGV4ZWN1dGUgeWV0LCBsZXQgdXNlciBmaWxsIGFyZ3MKICAgIH0KCiAgICB0cnkgewogICAgICBhcmdzID0gdGhpcy5jb2xsZWN0QXJncygpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBhbGVydChgRmFpbGVkIHRvIGNvbGxlY3QgYXJndW1lbnRzOiAke2UubWVzc2FnZX1gKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5kaXNwYXRjaEN1c3RvbUV2ZW50KCJleGVjdXRlLXRvb2wiLCB7CiAgICAgIHRvb2xJZDogdGhpcy5fdG9vbERhdGEuaWQsCiAgICAgIHRvb2xOYW1lOiB0aGlzLl90b29sRGF0YS5tZXRhZGF0YS5uYW1lLAogICAgICBhcmdzOiBhcmdzLAogICAgfSk7CiAgfQoKICBkaXNwYXRjaEN1c3RvbUV2ZW50KGV2ZW50TmFtZSwgZGV0YWlsT2JqKSB7CiAgICB0aGlzLmRpc3BhdGNoRXZlbnQoCiAgICAgIG5ldyBDdXN0b21FdmVudChldmVudE5hbWUsIHsKICAgICAgICBkZXRhaWw6IGRldGFpbE9iaiwKICAgICAgICBidWJibGVzOiB0cnVlLAogICAgICAgIGNvbXBvc2VkOiB0cnVlLAogICAgICB9KQogICAgKTsKICB9Cn0KCi8vIFJlZ2lzdGVyIHRoZSBjb21wb25lbnQgaWYgbm90IGFscmVhZHkKY3VzdG9tRWxlbWVudHMuZ2V0KCJ0b29sLWNhcmQiKSB8fCBjdXN0b21FbGVtZW50cy5kZWZpbmUoInRvb2wtY2FyZCIsIFRvb2xDYXJkQ29tcG9uZW50KTsKCmV4cG9ydCBkZWZhdWx0IFRvb2xDYXJkQ29tcG9uZW50Ow==
--- CATS_END_FILE ---

--- CATS_START_FILE: ui-manager.js ---
aW1wb3J0IFV0aWxzIGZyb20gIi4vdXRpbHMuanMiOwppbXBvcnQgVG9vbENhcmRDb21wb25lbnQgZnJvbSAiLi90b29sLWNhcmQud2MuanMiOyAvLyBFbnN1cmUgdGhpcyBpcyBpbXBvcnRlZCBjb3JyZWN0bHkKCmNvbnN0IFVJTWFuYWdlck1vZHVsZSA9ICgKICBjb25maWcsCiAgbG9nZ2VyLAogIFV0aWxzLAogIHN0b3JhZ2UsCiAgU3RhdGVNYW5hZ2VyLAogIEN5Y2xlTG9naWMKKSA9PiB7CiAgaWYgKAogICAgIWNvbmZpZyB8fAogICAgIWxvZ2dlciB8fAogICAgIVV0aWxzIHx8CiAgICAhc3RvcmFnZSB8fAogICAgIVN0YXRlTWFuYWdlciB8fAogICAgIUN5Y2xlTG9naWMKICApIHsKICAgIGxvZ2dlcj8ubG9nRXZlbnQoImVycm9yIiwgIlVJTWFuYWdlciByZXF1aXJlcyBhbGwgY29yZSBtb2R1bGVzLiIpOwogICAgcmV0dXJuIG51bGw7CiAgfQoKICBsZXQgdWlSZWZzID0ge307CiAgbGV0IGlzSW5pdGlhbGl6ZWQgPSBmYWxzZTsKCiAgY29uc3QgZ2V0UmVmcyA9ICgpID0+IHsKICAgIGNvbnN0IGlkcyA9IFsKICAgICAgImFwcC12ZXJzaW9uIiwKICAgICAgInN0b3JhZ2UtdXNhZ2UiLAogICAgICAiYXBpLWtleS1pbnB1dCIsCiAgICAgICJzYXZlLWFwaS1rZXktYnV0dG9uIiwKICAgICAgImV4cG9ydC1zdGF0ZS1idXR0b24iLAogICAgICAiaW1wb3J0LXN0YXRlLWJ1dHRvbiIsCiAgICAgICJpbXBvcnQtZmlsZS1pbnB1dCIsCiAgICAgICJkb3dubG9hZC1sb2ctYnV0dG9uIiwKICAgICAgImNsZWFyLXN0b3JhZ2UtYnV0dG9uIiwKICAgICAgInN0YXR1cy1pbmRpY2F0b3IiLAogICAgICAidG9vbC1yZXF1ZXN0LWlucHV0IiwKICAgICAgImNyZWF0ZS10b29sLWJ1dHRvbiIsCiAgICAgICJ0b29sLWxpc3QtY29udGFpbmVyIiwKICAgICAgIm5vdGlmaWNhdGlvbnMtY29udGFpbmVyIiwKICAgICAgIm1haW4tY29udGVudCIsCiAgICAgICJhcHAtcm9vdCIsCiAgICAgICJ0b29sLWxpc3Qtc2VhcmNoIiwgLy8gQWRkZWQKICAgICAgInRvb2wtbGlzdC1zb3J0IiwgICAvLyBBZGRlZAogICAgICAidG9vbC1saWJyYXJ5LWNvbnRyb2xzIiAvLyBBZGRlZCBjb250YWluZXIgZm9yIHNlYXJjaC9zb3J0CiAgICBdOwogICAgY29uc3QgcmVmcyA9IHt9OwogICAgaWRzLmZvckVhY2goKGlkKSA9PiB7CiAgICAgIGNvbnN0IGNhbWVsQ2FzZSA9IGlkLnJlcGxhY2UoLy0oXHcpL2csIChtYXRjaCwgcDEpID0+IHAxLnRvVXBwZXJDYXNlKCkpOwogICAgICByZWZzW2NhbWVsQ2FzZV0gPSBVdGlscy4kaWQoaWQpOwogICAgfSk7CiAgICByZXR1cm4gcmVmczsKICB9OwoKICBjb25zdCB1cGRhdGVTdGF0dXMgPSAobWVzc2FnZSwgaXNBY3RpdmUgPSBmYWxzZSwgaXNFcnJvciA9IGZhbHNlKSA9PiB7CiAgICBpZiAodWlSZWZzLnN0YXR1c0luZGljYXRvcikgewogICAgICB1aVJlZnMuc3RhdHVzSW5kaWNhdG9yLnRleHRDb250ZW50ID0gYFN0YXR1czogJHttZXNzYWdlfWA7CiAgICAgIHVpUmVmcy5zdGF0dXNJbmRpY2F0b3Iuc3R5bGUuY29sb3IgPSBpc0Vycm9yCiAgICAgICAgPyAidmFyKC0tZXJyb3ItY29sb3IpIgogICAgICAgIDogaXNBY3RpdmUKICAgICAgICA/ICJ2YXIoLS13YXJuLWNvbG9yKSIKICAgICAgICA6ICIjYWFhIjsKICAgICAgdWlSZWZzLnN0YXR1c0luZGljYXRvci5zdHlsZS5mb250V2VpZ2h0ID0KICAgICAgICBpc0FjdGl2ZSB8fCBpc0Vycm9yID8gImJvbGQiIDogIm5vcm1hbCI7CiAgICB9CiAgfTsKCiAgY29uc3Qgc2hvd05vdGlmaWNhdGlvbiA9IChtZXNzYWdlLCB0eXBlID0gImluZm8iLCBkdXJhdGlvbiA9IDUwMDApID0+IHsKICAgIGlmICghdWlSZWZzLm5vdGlmaWNhdGlvbnNDb250YWluZXIpIHJldHVybjsKICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgbm90aWZpY2F0aW9uLmNsYXNzTmFtZSA9IGBub3RpZmljYXRpb24gJHt0eXBlfWA7CiAgICBub3RpZmljYXRpb24udGV4dENvbnRlbnQgPSBtZXNzYWdlOwoKICAgIGNvbnN0IGNsb3NlQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICBjbG9zZUJ1dHRvbi5pbm5lckhUTUwgPSAiw5ciOwogICAgY2xvc2VCdXR0b24ub25jbGljayA9ICgpID0+IG5vdGlmaWNhdGlvbi5yZW1vdmUoKTsKICAgIG5vdGlmaWNhdGlvbi5hcHBlbmRDaGlsZChjbG9zZUJ1dHRvbik7CgogICAgdWlSZWZzLm5vdGlmaWNhdGlvbnNDb250YWluZXIuYXBwZW5kQ2hpbGQobm90aWZpY2F0aW9uKTsKCiAgICBpZiAoZHVyYXRpb24gPiAwKSB7CiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGlmIChub3RpZmljYXRpb24ucGFyZW50RWxlbWVudCkgewogICAgICAgICAgbm90aWZpY2F0aW9uLnJlbW92ZSgpOwogICAgICAgIH0KICAgICAgfSwgZHVyYXRpb24pOwogICAgfQogIH07CgogIGNvbnN0IHVwZGF0ZVN0b3JhZ2VVc2FnZURpc3BsYXkgPSAoKSA9PiB7CiAgICBpZiAodWlSZWZzLnN0b3JhZ2VVc2FnZSkgewogICAgICBjb25zdCB1c2FnZSA9IHN0b3JhZ2UuZ2V0U3RvcmFnZVVzYWdlKCk7CiAgICAgIGlmICh1c2FnZS51c2VkID49IDApIHsKICAgICAgICB1aVJlZnMuc3RvcmFnZVVzYWdlLnRleHRDb250ZW50ID0gYCR7KHVzYWdlLnVzZWQgLyAxMDI0KS50b0ZpeGVkKAogICAgICAgICAgMQogICAgICAgICl9S0IgKCR7dXNhZ2UucGVyY2VudC50b0ZpeGVkKDEpfSUpYDsKICAgICAgICBpZiAodXNhZ2UucGVyY2VudCA+IGNvbmZpZy5zdG9yYWdlUXVvdGFXYXJuVGhyZXNob2xkICogMTAwKSB7CiAgICAgICAgICB1aVJlZnMuc3RvcmFnZVVzYWdlLnN0eWxlLmNvbG9yID0gInZhcigtLXdhcm4tY29sb3IpIjsKICAgICAgICAgIHVpUmVmcy5zdG9yYWdlVXNhZ2Uuc3R5bGUuZm9udFdlaWdodCA9ICJib2xkIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdWlSZWZzLnN0b3JhZ2VVc2FnZS5zdHlsZS5jb2xvciA9ICJpbmhlcml0IjsKICAgICAgICAgIHVpUmVmcy5zdG9yYWdlVXNhZ2Uuc3R5bGUuZm9udFdlaWdodCA9ICJub3JtYWwiOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB1aVJlZnMuc3RvcmFnZVVzYWdlLnRleHRDb250ZW50ID0gYEVycm9yYDsKICAgICAgICB1aVJlZnMuc3RvcmFnZVVzYWdlLnN0eWxlLmNvbG9yID0gInZhcigtLWVycm9yLWNvbG9yKSI7CiAgICAgIH0KICAgIH0KICB9OwoKICBjb25zdCByZW5kZXJUb29sTGlzdCA9ICgpID0+IHsKICAgIGlmICghdWlSZWZzLnRvb2xMaXN0Q29udGFpbmVyKSByZXR1cm47CiAgICBsZXQgdG9vbHMgPSBTdGF0ZU1hbmFnZXIubGlzdFRvb2xzKCk7CiAgICB1aVJlZnMudG9vbExpc3RDb250YWluZXIuaW5uZXJIVE1MID0gIiI7CgogICAgY29uc3Qgc2VhcmNoVGVybSA9ICh1aVJlZnMudG9vbExpc3RTZWFyY2g/LnZhbHVlIHx8ICIiKS50b0xvd2VyQ2FzZSgpOwogICAgY29uc3Qgc29ydEJ5ID0gdWlSZWZzLnRvb2xMaXN0U29ydD8udmFsdWUgfHwgIm5hbWUiOwoKICAgIGlmIChzZWFyY2hUZXJtKSB7CiAgICAgIHRvb2xzID0gdG9vbHMuZmlsdGVyKCh0KSA9PiB7CiAgICAgICAgcmV0dXJuICh0Lm1ldGFkYXRhPy5uYW1lPy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaFRlcm0pIHx8CiAgICAgICAgICAgICAgICB0Lm1ldGFkYXRhPy5kZXNjcmlwdGlvbj8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hUZXJtKSB8fAogICAgICAgICAgICAgICAgdC5pZD8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hUZXJtKSk7CiAgICAgIH0pOwogICAgfQoKICAgIHRvb2xzLnNvcnQoKGEsIGIpID0+IHsKICAgICAgY29uc3QgYVZhbCA9IHNvcnRCeSA9PT0gImRhdGUiCiAgICAgICAgPyBhLm1ldGFkYXRhPy5jcmVhdGVkQXQKICAgICAgICA6IGEubWV0YWRhdGE/Lm5hbWUgfHwgIiI7CiAgICAgIGNvbnN0IGJWYWwgPSBzb3J0QnkgPT09ICJkYXRlIgogICAgICAgID8gYi5tZXRhZGF0YT8uY3JlYXRlZEF0CiAgICAgICAgOiBiLm1ldGFkYXRhPy5uYW1lIHx8ICIiOwoKICAgICAgICBpZiAoc29ydEJ5ID09PSAnZGF0ZScpIHsKICAgICAgICAgICAgLy8gU29ydCBuZXdlc3QgZmlyc3QKICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGJWYWwgfHwgMCkgLSBuZXcgRGF0ZShhVmFsIHx8IDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFNvcnQgYWxwaGFiZXRpY2FsbHkgYnkgbmFtZQogICAgICAgICAgICByZXR1cm4gKGFWYWwgfHwgIiIpLmxvY2FsZUNvbXBhcmUoYlZhbCB8fCAiIik7CiAgICAgICAgfQogICAgfSk7CgogICAgaWYgKHRvb2xzLmxlbmd0aCA9PT0gMCkgewogICAgICB1aVJlZnMudG9vbExpc3RDb250YWluZXIuaW5uZXJIVE1MID0gYDxwPk5vIHRvb2xzIGZvdW5kJHtzZWFyY2hUZXJtID8gJyBtYXRjaGluZyBmaWx0ZXInIDogJyd9LjwvcD5gOwogICAgICByZXR1cm47CiAgICB9CgogICAgdG9vbHMuZm9yRWFjaCgodG9vbERhdGEpID0+IHsKICAgICAgY29uc3QgdG9vbENhcmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0b29sLWNhcmQiKTsKICAgICAgdG9vbENhcmQuc2V0VG9vbERhdGEodG9vbERhdGEpOwogICAgICB1aVJlZnMudG9vbExpc3RDb250YWluZXIuYXBwZW5kQ2hpbGQodG9vbENhcmQpOwogICAgfSk7CiAgfTsKCiAgY29uc3Qgc2V0dXBFdmVudExpc3RlbmVycyA9ICgpID0+IHsKICAgIHVpUmVmcy5zYXZlQXBpS2V5QnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgY29uc3Qga2V5ID0gdWlSZWZzLmFwaUtleUlucHV0Py52YWx1ZS50cmltKCkgPz8gIiI7CiAgICAgIFN0YXRlTWFuYWdlci5zZXRBcGlLZXlJblNlc3Npb24oa2V5KTsKICAgICAgc2hvd05vdGlmaWNhdGlvbihrZXkgPyAiQVBJIEtleSBzYXZlZCBmb3Igc2Vzc2lvbi4iIDogIkFQSSBLZXkgY2xlYXJlZCBmb3Igc2Vzc2lvbi4iLCAiaW5mbyIpOwogICAgfSk7CgogICAgdWlSZWZzLmNyZWF0ZVRvb2xCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgYXN5bmMgKCkgPT4gewogICAgICBjb25zdCByZXF1ZXN0ID0gdWlSZWZzLnRvb2xSZXF1ZXN0SW5wdXQ/LnZhbHVlLnRyaW0oKSA/PyAiIjsKICAgICAgaWYgKCFyZXF1ZXN0KSB7CiAgICAgICAgc2hvd05vdGlmaWNhdGlvbigiUGxlYXNlIGVudGVyIGEgZGVzY3JpcHRpb24gZm9yIHRoZSB0b29sLiIsICJ3YXJuIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IGFwaUtleSA9IFN0YXRlTWFuYWdlci5nZXRBcGlLZXlGcm9tU2Vzc2lvbigpOwogICAgICBpZiAoIWFwaUtleSkgewogICAgICAgIHNob3dOb3RpZmljYXRpb24oIlBsZWFzZSBzZXQgeW91ciBHZW1pbmkgQVBJIEtleSBmaXJzdC4iLCAid2FybiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdWlSZWZzLmNyZWF0ZVRvb2xCdXR0b24uZGlzYWJsZWQgPSB0cnVlOwogICAgICB1aVJlZnMuY3JlYXRlVG9vbEJ1dHRvbi50ZXh0Q29udGVudCA9ICJHZW5lcmF0aW5nLi4uIjsKICAgICAgdXBkYXRlU3RhdHVzKCJHZW5lcmF0aW5nIHRvb2wuLi4iLCB0cnVlKTsKCiAgICAgIGNvbnN0IHByb2dyZXNzQ2FsbGJhY2sgPSAodHlwZSwgZGF0YSkgPT4gewogICAgICAgIGxvZ2dlci5sb2dFdmVudCgiZGVidWciLCBgR2VuZXJhdGlvbiBQcm9ncmVzcyAtIFR5cGU6ICR7dHlwZX1gLCBkYXRhKTsKICAgICAgICBpZiAodHlwZSA9PT0gInN0YXR1cyIpIHsKICAgICAgICAgIHVwZGF0ZVN0YXR1cyhkYXRhLm1lc3NhZ2UsIGRhdGEuYWN0aXZlLCBkYXRhLmlzRXJyb3IpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gImVycm9yIikgewogICAgICAgICAgc2hvd05vdGlmaWNhdGlvbihgR2VuZXJhdGlvbiBFcnJvcjogJHtkYXRhLm1lc3NhZ2V9YCwgImVycm9yIik7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnc3VjY2VzcycpIHsKICAgICAgICAgIHNob3dOb3RpZmljYXRpb24oCiAgICAgICAgICAgIGBUb29sICIke2RhdGEudG9vbD8ubWV0YWRhdGE/Lm5hbWV9IiBnZW5lcmF0ZWQgc3VjY2Vzc2Z1bGx5IWAsCiAgICAgICAgICAgICJzdWNjZXNzIgogICAgICAgICAgKTsKICAgICAgICAgIHJlbmRlclRvb2xMaXN0KCk7CiAgICAgICAgICBpZiAodWlSZWZzLnRvb2xSZXF1ZXN0SW5wdXQpIHVpUmVmcy50b29sUmVxdWVzdElucHV0LnZhbHVlID0gIiI7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAiZmluYWwiKSB7CiAgICAgICAgICB1aVJlZnMuY3JlYXRlVG9vbEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgdWlSZWZzLmNyZWF0ZVRvb2xCdXR0b24udGV4dENvbnRlbnQgPSAiR2VuZXJhdGUgVG9vbCI7CiAgICAgICAgICB1cGRhdGVTdG9yYWdlVXNhZ2VEaXNwbGF5KCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgYXdhaXQgQ3ljbGVMb2dpYy5nZW5lcmF0ZVRvb2wocmVxdWVzdCwgcHJvZ3Jlc3NDYWxsYmFjayk7CiAgICB9KTsKCiAgICB1aVJlZnMuZXhwb3J0U3RhdGVCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHN0YXRlVG9FeHBvcnQgPSBTdGF0ZU1hbmFnZXIuZ2V0U3RhdGUoKTsKICAgICAgICBpZiAoIXN0YXRlVG9FeHBvcnQpIHsKICAgICAgICAgIHNob3dOb3RpZmljYXRpb24oIkNhbm5vdCBleHBvcnQ6IFN0YXRlIG5vdCBhdmFpbGFibGUuIiwgIndhcm4iKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgZGF0YVN0ciA9IEpTT04uc3RyaW5naWZ5KHN0YXRlVG9FeHBvcnQsIG51bGwsIDIpOwogICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbZGF0YVN0cl0sIHsgdHlwZTogImFwcGxpY2F0aW9uL2pzb24iIH0pOwogICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICBhLmhyZWYgPSB1cmw7CiAgICAgICAgYS5kb3dubG9hZCA9IGBkcmVhbWVyLXN0YXRlXyR7CiAgICAgICAgICBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoIlQiKVswXQogICAgICAgIH0uanNvbmA7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgICAgICBhLmNsaWNrKCk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChhKTsKICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7CiAgICAgICAgc2hvd05vdGlmaWNhdGlvbigiU3RhdGUgZXhwb3J0ZWQuIiwgImluZm8iKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGxvZ2dlci5sb2dFdmVudCgiZXJyb3IiLCAiU3RhdGUgZXhwb3J0IGZhaWxlZCIsIGUpOwogICAgICAgIHNob3dOb3RpZmljYXRpb24oYFN0YXRlIGV4cG9ydCBmYWlsZWQ6ICR7ZS5tZXNzYWdlfWAsICJlcnJvciIpOwogICAgICB9CiAgICB9KTsKCiAgICB1aVJlZnMuaW1wb3J0U3RhdGVCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICB1aVJlZnMuaW1wb3J0RmlsZUlucHV0Py5jbGljaygpOwogICAgfSk7CgogICAgdWlSZWZzLmltcG9ydEZpbGVJbnB1dD8uYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKGV2ZW50KSA9PiB7CiAgICAgIGNvbnN0IGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXM/LlswXTsKICAgICAgaWYgKCFmaWxlKSByZXR1cm47CiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoIWUudGFyZ2V0Py5yZXN1bHQpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRmlsZSBjb250ZW50IGlzIGVtcHR5IG9yIHVucmVhZGFibGUuIik7CiAgICAgICAgICBjb25zdCBpbXBvcnRlZFN0YXRlID0gSlNPTi5wYXJzZShlLnRhcmdldC5yZXN1bHQpOwoKICAgICAgICAgIGlmICgKICAgICAgICAgICAgaW1wb3J0ZWRTdGF0ZSAmJgogICAgICAgICAgICB0eXBlb2YgaW1wb3J0ZWRTdGF0ZSA9PT0gIm9iamVjdCIgJiYKICAgICAgICAgICAgaW1wb3J0ZWRTdGF0ZS52ZXJzaW9uCiAgICAgICAgICApIHsKICAgICAgICAgICAgaWYgKGltcG9ydGVkU3RhdGUudmVyc2lvbiAhPT0gY29uZmlnLnZlcnNpb24pIHsKICAgICAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uKAogICAgICAgICAgICAgICAgYEltcG9ydCBmYWlsZWQ6IFZlcnNpb24gbWlzbWF0Y2ggKEZpbGU6ICR7aW1wb3J0ZWRTdGF0ZS52ZXJzaW9ufSwgQXBwOiAke2NvbmZpZy52ZXJzaW9ufSlgLAogICAgICAgICAgICAgICAgImVycm9yIgogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIC8vIEF0dGVtcHQgdG8gZ2V0IEFQSSBrZXkgZnJvbSBvbGQgc3RhdGUgZm9ybWF0IGlmIG5lY2Vzc2FyeSAoc2hvdWxkIGJlIHNlc3Npb24gbm93KQogICAgICAgICAgICAgIGNvbnN0IGltcG9ydGVkQXBpS2V5ID0gaW1wb3J0ZWRTdGF0ZS5hcGlLZXkgfHwgIiI7CgogICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgbWFpbiBzdGF0ZSAoZXhjbHVkaW5nIHRoZSBhcGkga2V5IHdoaWNoIGlzIG5vdyBzZXNzaW9uLW1hbmFnZWQpCiAgICAgICAgICAgICAgY29uc3Qgc3RhdGVUb1VwZGF0ZSA9IHsgLi4uaW1wb3J0ZWRTdGF0ZSB9OwogICAgICAgICAgICAgIGRlbGV0ZSBzdGF0ZVRvVXBkYXRlLmFwaUtleTsgLy8gUmVtb3ZlIGFwaUtleSBiZWZvcmUgdXBkYXRpbmcgc3RhdGUKCiAgICAgICAgICAgICAgU3RhdGVNYW5hZ2VyLnVwZGF0ZVN0YXRlKHN0YXRlVG9VcGRhdGUpOwogICAgICAgICAgICAgIFN0YXRlTWFuYWdlci5zYXZlU3RhdGUoKTsKCiAgICAgICAgICAgICAgLy8gU2V0IHRoZSBBUEkga2V5IGluIHNlc3Npb24gc3RvcmFnZQogICAgICAgICAgICAgIFN0YXRlTWFuYWdlci5zZXRBcGlLZXlJblNlc3Npb24oaW1wb3J0ZWRBcGlLZXkpOwogICAgICAgICAgICAgIGlmICh1aVJlZnMuYXBpS2V5SW5wdXQpIHVpUmVmcy5hcGlLZXlJbnB1dC52YWx1ZSA9IGltcG9ydGVkQXBpS2V5OyAvLyBVcGRhdGUgVUkgZmllbGQKCiAgICAgICAgICAgICAgcmVuZGVyVG9vbExpc3QoKTsKICAgICAgICAgICAgICB1cGRhdGVTdG9yYWdlVXNhZ2VEaXNwbGF5KCk7CiAgICAgICAgICAgICAgc2hvd05vdGlmaWNhdGlvbigiU3RhdGUgaW1wb3J0ZWQgc3VjY2Vzc2Z1bGx5LiIsICJzdWNjZXNzIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBzdGF0ZSBmaWxlIGZvcm1hdC4iKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIGxvZ2dlci5sb2dFdmVudCgiZXJyb3IiLCAiU3RhdGUgaW1wb3J0IGZhaWxlZCIsIGVycik7CiAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uKGBJbXBvcnQgZmFpbGVkOiAke2Vyci5tZXNzYWdlfWAsICJlcnJvciIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBpZiAodWlSZWZzLmltcG9ydEZpbGVJbnB1dCkgdWlSZWZzLmltcG9ydEZpbGVJbnB1dC52YWx1ZSA9ICIiOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmVhZGVyLm9uZXJyb3IgPSAoZSkgPT4gewogICAgICAgIGxvZ2dlci5sb2dFdmVudCgiZXJyb3IiLCAiRmlsZSByZWFkaW5nIGVycm9yIGR1cmluZyBpbXBvcnQiLCBlKTsKICAgICAgICBzaG93Tm90aWZpY2F0aW9uKCJGYWlsZWQgdG8gcmVhZCB0aGUgc2VsZWN0ZWQgZmlsZS4iLCAiZXJyb3IiKTsKICAgICAgICBpZiAodWlSZWZzLmltcG9ydEZpbGVJbnB1dCkgdWlSZWZzLmltcG9ydEZpbGVJbnB1dC52YWx1ZSA9ICIiOwogICAgICB9OwogICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKICAgIH0pOwoKICAgIHVpUmVmcy5kb3dubG9hZExvZ0J1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgbG9nRGF0YSA9IGxvZ2dlci5nZXRMb2dCdWZmZXIoKTsKICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2xvZ0RhdGFdLCB7IHR5cGU6ICJ0ZXh0L3BsYWluIiB9KTsKICAgICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgYS5ocmVmID0gdXJsOwogICAgICAgIGEuZG93bmxvYWQgPSBgZHJlYW1lci1sb2dfJHtuZXcgRGF0ZSgpCiAgICAgICAgICAudG9JU09TdHJpbmcoKQogICAgICAgICAgLnJlcGxhY2UoL1s6Ll0vZywgIi0iKX0udHh0YDsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpOwogICAgICAgIGEuY2xpY2soKTsKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOwogICAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwodXJsKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGxvZ2dlci5sb2dFdmVudCgiZXJyb3IiLCAiTG9nIGRvd25sb2FkIGZhaWxlZCIsIGUpOwogICAgICAgIHNob3dOb3RpZmljYXRpb24oYExvZyBkb3dubG9hZCBmYWlsZWQ6ICR7ZS5tZXNzYWdlfWAsICJlcnJvciIpOwogICAgICB9CiAgICB9KTsKCiAgICB1aVJlZnMuY2xlYXJTdG9yYWdlQnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgaWYgKAogICAgICAgIGNvbmZpcm0oCiAgICAgICAgICAiV0FSTklORzogVGhpcyB3aWxsIGRlbGV0ZSBBTEwgRHJlYW1lciBkYXRhIChzdGF0ZSBhbmQgZ2VuZXJhdGVkIHRvb2xzKSBmcm9tIHlvdXIgYnJvd3Nlci4gQXJlIHlvdSBzdXJlPyIKICAgICAgICApCiAgICAgICkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCBjb3VudCA9IHN0b3JhZ2UuY2xlYXJBbGxSZXBsb2lkRGF0YSgpOwogICAgICAgICAgc2hvd05vdGlmaWNhdGlvbigKICAgICAgICAgICAgYENsZWFyZWQgJHtjb3VudH0gaXRlbXMgZnJvbSBzdG9yYWdlLiBSZWxvYWRpbmcuLi5gLAogICAgICAgICAgICAid2FybiIsCiAgICAgICAgICAgIDMwMDAKICAgICAgICAgICk7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKSwgMTUwMCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJlcnJvciIsICJGYWlsZWQgdG8gY2xlYXIgc3RvcmFnZSIsIGUpOwogICAgICAgICAgc2hvd05vdGlmaWNhdGlvbihgRmFpbGVkIHRvIGNsZWFyIHN0b3JhZ2U6ICR7ZS5tZXNzYWdlfWAsICJlcnJvciIpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgLy8gTGlzdGVuZXIgZm9yIHNlYXJjaCBpbnB1dAogICAgIHVpUmVmcy50b29sTGlzdFNlYXJjaD8uYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCAoKSA9PiB7CiAgICAgICAgIHJlbmRlclRvb2xMaXN0KCk7CiAgICAgfSk7CiAgICAgLy8gTGlzdGVuZXIgZm9yIHNvcnQgZHJvcGRvd24KICAgICB1aVJlZnMudG9vbExpc3RTb3J0Py5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCAoKSA9PiB7CiAgICAgICAgIHJlbmRlclRvb2xMaXN0KCk7CiAgICAgfSk7CgogICAgIC8vIExpc3RlbmVyIGZvciBlZGl0IHRvb2wgcmVxdWVzdCBldmVudHMgYnViYmxpbmcgdXAgZnJvbSB0b29sIGNhcmRzCiAgICAgdWlSZWZzLmFwcFJvb3Q/LmFkZEV2ZW50TGlzdGVuZXIoImVkaXQtdG9vbC1yZXF1ZXN0IiwgKGV2ZW50KSA9PiB7CiAgICAgICAgY29uc3QgeyB0b29sSWQsIG9yaWdpbmFsUmVxdWVzdCB9ID0gZXZlbnQuZGV0YWlsOwogICAgICAgIGlmICh1aVJlZnMudG9vbFJlcXVlc3RJbnB1dCkgewogICAgICAgICAgICBsb2dnZXIubG9nRXZlbnQoImluZm8iLCBgRWRpdGluZyByZXF1ZXN0IGZvciB0b29sICR7dG9vbElkfWApOwogICAgICAgICAgICB1aVJlZnMudG9vbFJlcXVlc3RJbnB1dC52YWx1ZSA9IG9yaWdpbmFsUmVxdWVzdCB8fCAiIjsKICAgICAgICAgICAgdWlSZWZzLnRvb2xSZXF1ZXN0SW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgdWlSZWZzLnRvb2xSZXF1ZXN0SW5wdXQuc2Nyb2xsSW50b1ZpZXcoeyBiZWhhdmlvcjogInNtb290aCIsIGJsb2NrOiAiY2VudGVyIn0pOwoKICAgICAgICAgICAgLy8gVGVtcG9yYXJpbHkgY2hhbmdlIGJ1dHRvbiB0ZXh0CiAgICAgICAgICAgIGlmKHVpUmVmcy5jcmVhdGVUb29sQnV0dG9uKXsKICAgICAgICAgICAgICAgIHVpUmVmcy5jcmVhdGVUb29sQnV0dG9uLnRleHRDb250ZW50ID0gIlJlZ2VuZXJhdGUgVG9vbCI7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgaWYgKHVpUmVmcy5jcmVhdGVUb29sQnV0dG9uKSB7IC8vIENoZWNrIGlmIHN0aWxsIGV4aXN0cwogICAgICAgICAgICAgICAgICAgICAgICB1aVJlZnMuY3JlYXRlVG9vbEJ1dHRvbi50ZXh0Q29udGVudCA9ICJHZW5lcmF0ZSBUb29sIjsKICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgNTAwMCk7IC8vIFJlc2V0IGFmdGVyIDUgc2Vjb25kcwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgIH0pOwoKICAgICAvLyBDZW50cmFsIGxpc3RlbmVyIGZvciB0b29sIGV4ZWN1dGlvbiBldmVudHMKICAgICB1aVJlZnMuYXBwUm9vdD8uYWRkRXZlbnRMaXN0ZW5lcigiZXhlY3V0ZS10b29sIiwgYXN5bmMgKGV2ZW50KSA9PiB7CiAgICAgICAgY29uc3QgeyB0b29sSWQsIHRvb2xOYW1lLCBhcmdzIH0gPSBldmVudC5kZXRhaWw7CiAgICAgICAgY29uc3QgdG9vbCA9IFN0YXRlTWFuYWdlci5nZXRUb29sKHRvb2xJZCk7CiAgICAgICAgaWYgKHRvb2wgJiYgVG9vbFJ1bm5lcikgewogICAgICAgICAgICB1cGRhdGVTdGF0dXMoYEV4ZWN1dGluZyAke3Rvb2xOYW1lfS4uLmAsIHRydWUpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgVG9vbFJ1bm5lci5ydW5Kc0ltcGxlbWVudGF0aW9uKAogICAgICAgICAgICAgICAgICAgIHRvb2wuanNJbXBsZW1lbnRhdGlvbiwKICAgICAgICAgICAgICAgICAgICBhcmdzCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgc2hvd05vdGlmaWNhdGlvbigKICAgICAgICAgICAgICAgICAgICBgVG9vbCAke3Rvb2xOYW1lfSBleGVjdXRlZC4gUmVzdWx0OiAke0pTT04uc3RyaW5naWZ5KHJlc3VsdCl9YCwKICAgICAgICAgICAgICAgICAgICAiaW5mbyIsCiAgICAgICAgICAgICAgICAgICAgODAwMAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXR1cygiSWRsZSIpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uKAogICAgICAgICAgICAgICAgICAgIGBUb29sICR7dG9vbE5hbWV9IGV4ZWN1dGlvbiBmYWlsZWQ6ICR7ZS5tZXNzYWdlfWAsCiAgICAgICAgICAgICAgICAgICAgImVycm9yIgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXR1cyhgRXhlY3V0aW9uIGZhaWxlZGAsIGZhbHNlLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNob3dOb3RpZmljYXRpb24oCiAgICAgICAgICAgICAgICBgQ291bGQgbm90IGZpbmQgdG9vbCBvciBydW5uZXIgZm9yICR7dG9vbE5hbWV9LmAsCiAgICAgICAgICAgICAgICAiZXJyb3IiCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAgICAgICAgICJlcnJvciIsCiAgICAgICAgICAgICAgICBgRXhlY3V0ZSBmYWlsZWQ6IFRvb2wgZGF0YSBvciBydW5uZXIgbWlzc2luZyBmb3IgJHt0b29sSWR9YAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIENlbnRyYWwgbGlzdGVuZXIgZm9yIHRvb2wgZGVsZXRpb24gZXZlbnRzCiAgICB1aVJlZnMuYXBwUm9vdD8uYWRkRXZlbnRMaXN0ZW5lcigiZGVsZXRlLXRvb2wiLCAoZXZlbnQpID0+IHsKICAgICAgICBjb25zdCB7IHRvb2xJZCwgdG9vbE5hbWUgfSA9IGV2ZW50LmRldGFpbDsKICAgICAgICBpZiAoY29uZmlybShgQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGUgdG9vbCAiJHt0b29sTmFtZX0iICgke3Rvb2xJZH0pPyBUaGlzIGNhbm5vdCBiZSB1bmRvbmUuYCkpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN0b3JhZ2UuZGVsZXRlQXJ0aWZhY3QodG9vbElkLCAibWNwLmpzb24iKTsKICAgICAgICAgICAgICAgIHN0b3JhZ2UuZGVsZXRlQXJ0aWZhY3QodG9vbElkLCAiaW1wbC5qcyIpOwoKICAgICAgICAgICAgICAgIGlmIChTdGF0ZU1hbmFnZXIuZGVsZXRlVG9vbCh0b29sSWQpKSB7CiAgICAgICAgICAgICAgICAgICAgc2hvd05vdGlmaWNhdGlvbihgVG9vbCAiJHt0b29sTmFtZX0iIGRlbGV0ZWQuYCwgInN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgICAgICByZW5kZXJUb29sTGlzdCgpOwogICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0b3JhZ2VVc2FnZURpc3BsYXkoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2hvd05vdGlmaWNhdGlvbihgRmFpbGVkIHRvIGRlbGV0ZSB0b29sICIke3Rvb2xOYW1lfSIgZnJvbSBzdGF0ZS5gLCAiZXJyb3IiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJlcnJvciIsIGBFcnJvciBkZWxldGluZyB0b29sICR7dG9vbElkfSBhcnRpZmFjdHMgb3Igc3RhdGUuYCwgZSk7CiAgICAgICAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uKGBFcnJvciBkZWxldGluZyB0b29sOiAke2UubWVzc2FnZX1gLCAiZXJyb3IiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwogIH07CgoKICBjb25zdCBpbml0ID0gYXN5bmMgKCkgPT4gewogICAgaWYgKGlzSW5pdGlhbGl6ZWQpIHJldHVybjsKICAgIGxvZ2dlci5sb2dFdmVudCgiaW5mbyIsICJJbml0aWFsaXppbmcgVUlNYW5hZ2VyLi4uIik7CgogICAgLy8gRW5zdXJlIHRvb2wtY2FyZCBXQyBpcyByZWdpc3RlcmVkCiAgICBpZiAoIWN1c3RvbUVsZW1lbnRzLmdldCgidG9vbC1jYXJkIikpIHsKICAgICAgY3VzdG9tRWxlbWVudHMuZGVmaW5lKCJ0b29sLWNhcmQiLCBUb29sQ2FyZENvbXBvbmVudCk7CiAgICB9CgogICAgdHJ5IHsKICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgidWktYm9keS5odG1sIik7CiAgICAgIGlmICghcmVzcG9uc2Uub2spCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggdWktYm9keS5odG1sOiAke3Jlc3BvbnNlLnN0YXR1c31gKTsKICAgICAgY29uc3QgdWlIdG1sID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpOwoKICAgICAgY29uc3QgYXBwUm9vdENvbnRhaW5lciA9IFV0aWxzLiRpZCgiYXBwLXJvb3QiKTsKICAgICAgaWYgKGFwcFJvb3RDb250YWluZXIpIHsKICAgICAgICBhcHBSb290Q29udGFpbmVyLmlubmVySFRNTCA9IHVpSHRtbDsKICAgICAgICB1aVJlZnMgPSBnZXRSZWZzKCk7IC8vIFJlLWZldGNoIHJlZnMgYWZ0ZXIgbG9hZGluZyBib2R5CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICAgIkFwcCByb290IGNvbnRhaW5lciAoI2FwcC1yb290KSBub3QgZm91bmQgaW4gaW5kZXguaHRtbCIKICAgICAgICApOwogICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGxvZ2dlci5sb2dFdmVudCgiZXJyb3IiLCAiRmFpbGVkIHRvIGxvYWQgbWFpbiBVSSBib2R5IiwgZSk7CiAgICAgIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MID0gYDxkaXYgc3R5bGU9J2NvbG9yOnJlZCc+PGgxPlVJIExvYWQgRXJyb3I8L2gxPjxwPiR7ZS5tZXNzYWdlfTwvcD48L2Rpdj5gOwogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKHVpUmVmcy5hcGlLZXlJbnB1dCkgewogICAgICAgIHVpUmVmcy5hcGlLZXlJbnB1dC52YWx1ZSA9IFN0YXRlTWFuYWdlci5nZXRBcGlLZXlGcm9tU2Vzc2lvbigpIHx8ICIiOwogICAgfQogICAgaWYgKHVpUmVmcy5hcHBWZXJzaW9uKSB7CiAgICAgIHVpUmVmcy5hcHBWZXJzaW9uLnRleHRDb250ZW50ID0gY29uZmlnLnZlcnNpb247CiAgICB9CgogICAgdXBkYXRlU3RvcmFnZVVzYWdlRGlzcGxheSgpOwogICAgcmVuZGVyVG9vbExpc3QoKTsgLy8gSW5pdGlhbCByZW5kZXIKICAgIHNldHVwRXZlbnRMaXN0ZW5lcnMoKTsKICAgIHVwZGF0ZVN0YXR1cygiSW5pdGlhbGl6ZWQiKTsKCiAgICBpc0luaXRpYWxpemVkID0gdHJ1ZTsKICAgIGxvZ2dlci5sb2dFdmVudCgiaW5mbyIsICJVSU1hbmFnZXIgaW5pdGlhbGl6ZWQuIik7CiAgfTsKCiAgcmV0dXJuIHsKICAgIGluaXQsCiAgICBzaG93Tm90aWZpY2F0aW9uLAogICAgdXBkYXRlU3RhdHVzLAogICAgcmVuZGVyVG9vbExpc3QsCiAgICB1cGRhdGVTdG9yYWdlVXNhZ2VEaXNwbGF5LAogIH07Cn07CgpleHBvcnQgZGVmYXVsdCBVSU1hbmFnZXJNb2R1bGU7
--- CATS_END_FILE ---

--- CATS_START_FILE: mcp-converter.js ---
Y29uc3QgTUNQQ29udmVydGVyTW9kdWxlID0gKGNvbmZpZywgbG9nZ2VyKSA9PiB7CiAgaWYgKCFjb25maWcgfHwgIWxvZ2dlcikgewogICAgY29uc29sZS5lcnJvcigiTUNQQ29udmVydGVyTW9kdWxlIHJlcXVpcmVzIGNvbmZpZyBhbmQgbG9nZ2VyLiIpOwogICAgcmV0dXJuIG51bGw7CiAgfQoKICBjb25zdCBtYXBNY3BUeXBlVG9HZW1pbmkgPSAobWNwVHlwZSkgPT4gewogICAgc3dpdGNoIChtY3BUeXBlPy50b0xvd2VyQ2FzZSgpKSB7CiAgICAgIGNhc2UgInN0cmluZyI6CiAgICAgICAgcmV0dXJuICJTVFJJTkciOwogICAgICBjYXNlICJpbnRlZ2VyIjoKICAgICAgICByZXR1cm4gIklOVEVHRVIiOwogICAgICBjYXNlICJudW1iZXIiOgogICAgICAgIHJldHVybiAiTlVNQkVSIjsKICAgICAgY2FzZSAiYm9vbGVhbiI6CiAgICAgICAgcmV0dXJuICJCT09MRUFOIjsKICAgICAgY2FzZSAiYXJyYXkiOgogICAgICAgIHJldHVybiAiQVJSQVkiOwogICAgICBjYXNlICJvYmplY3QiOgogICAgICAgIHJldHVybiAiT0JKRUNUIjsKICAgICAgZGVmYXVsdDoKICAgICAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICAgICAid2FybiIsCiAgICAgICAgICBgVW5zdXBwb3J0ZWQgTUNQIHR5cGUgZW5jb3VudGVyZWQgZHVyaW5nIGNvbnZlcnNpb246ICR7bWNwVHlwZX0uIE1hcHBpbmcgdG8gU1RSSU5HLmAKICAgICAgICApOwogICAgICAgIHJldHVybiAiU1RSSU5HIjsKICAgIH0KICB9OwoKICBjb25zdCBjb252ZXJ0TWNwUHJvcGVydGllcyA9IChtY3BQcm9wcykgPT4gewogICAgaWYgKCFtY3BQcm9wcyB8fCB0eXBlb2YgbWNwUHJvcHMgIT09ICJvYmplY3QiKSByZXR1cm4ge307CiAgICBjb25zdCBnZW1pbmlQcm9wcyA9IHt9OwogICAgZm9yIChjb25zdCBrZXkgaW4gbWNwUHJvcHMpIHsKICAgICAgaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1jcFByb3BzLCBrZXkpKSB7CiAgICAgICAgaWYgKGtleSA9PT0gIiRzY2hlbWEiIHx8IGtleSA9PT0gImFkZGl0aW9uYWxQcm9wZXJ0aWVzIikgY29udGludWU7CgogICAgICAgIGNvbnN0IG1jcFByb3AgPSBtY3BQcm9wc1trZXldOwogICAgICAgIGlmICghbWNwUHJvcCB8fCB0eXBlb2YgbWNwUHJvcCAhPT0gIm9iamVjdCIpIHsKICAgICAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAgICAgIndhcm4iLAogICAgICAgICAgICBgU2tpcHBpbmcgaW52YWxpZCBNQ1AgcHJvcGVydHkgZGVmaW5pdGlvbiBmb3Iga2V5OiAke2tleX1gCiAgICAgICAgICApOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBnZW1pbmlQcm9wc1trZXldID0gewogICAgICAgICAgdHlwZTogbWFwTWNwVHlwZVRvR2VtaW5pKG1jcFByb3AudHlwZSksCiAgICAgICAgICBkZXNjcmlwdGlvbjogbWNwUHJvcC5kZXNjcmlwdGlvbiB8fCBgUGFyYW1ldGVyICR7a2V5fWAsCiAgICAgICAgfTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShtY3BQcm9wLmVudW0pICYmIG1jcFByb3AuZW51bS5sZW5ndGggPiAwKSB7CiAgICAgICAgICBnZW1pbmlQcm9wc1trZXldLmVudW0gPSBtY3BQcm9wLmVudW07CiAgICAgICAgfQogICAgICAgIGlmICgKICAgICAgICAgIG1jcFByb3AudHlwZSA9PT0gImFycmF5IiAmJgogICAgICAgICAgbWNwUHJvcC5pdGVtcyAmJgogICAgICAgICAgdHlwZW9mIG1jcFByb3AuaXRlbXMgPT09ICJvYmplY3QiCiAgICAgICAgKSB7CiAgICAgICAgICBpZiAobWNwUHJvcC5pdGVtcy50eXBlKSB7CiAgICAgICAgICAgIGdlbWluaVByb3BzW2tleV0uaXRlbXMgPSB7CiAgICAgICAgICAgICAgdHlwZTogbWFwTWNwVHlwZVRvR2VtaW5pKG1jcFByb3AuaXRlbXMudHlwZSksCiAgICAgICAgICAgIH07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICAgICAgICAgIndhcm4iLAogICAgICAgICAgICAgIGBNQ1AgYXJyYXkgcHJvcGVydHkgJyR7a2V5fScgaGFzIGl0ZW1zIGRlZmluaXRpb24gd2l0aG91dCBhICd0eXBlJy4gU2tpcHBpbmcgaXRlbXMgY29udmVyc2lvbi5gCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAobWNwUHJvcC50eXBlID09PSAib2JqZWN0IiAmJiBtY3BQcm9wLnByb3BlcnRpZXMpIHsKICAgICAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAgICAgIndhcm4iLAogICAgICAgICAgICBgTUNQIHByb3BlcnR5ICcke2tleX0nIGlzIGEgbmVzdGVkIG9iamVjdC4gR2VtaW5pIEZ1bmN0aW9uRGVjbGFyYXRpb24gcGFyYW1ldGVycyBnZW5lcmFsbHkgZXhwZWN0IGEgZmxhdCBzdHJ1Y3R1cmUuIENvbnZlcnNpb24gbWlnaHQgYmUgcGFydGlhbCBvciBpbmFjY3VyYXRlLmAKICAgICAgICAgICk7CgogICAgICAgICAgZ2VtaW5pUHJvcHNba2V5XS5wcm9wZXJ0aWVzID0gY29udmVydE1jcFByb3BlcnRpZXMoCiAgICAgICAgICAgIG1jcFByb3AucHJvcGVydGllcwogICAgICAgICAgKTsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG1jcFByb3AucmVxdWlyZWQpKSB7CiAgICAgICAgICAgIGdlbWluaVByb3BzW2tleV0ucmVxdWlyZWQgPSBtY3BQcm9wLnJlcXVpcmVkOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGdlbWluaVByb3BzOwogIH07CgogIGNvbnN0IG1jcFRvR2VtaW5pRnVuY3Rpb25EZWNsYXJhdGlvbiA9IChtY3BEZWZpbml0aW9uKSA9PiB7CiAgICBpZiAoIW1jcERlZmluaXRpb24gfHwgdHlwZW9mIG1jcERlZmluaXRpb24gIT09ICJvYmplY3QiKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBNQ1AgZGVmaW5pdGlvbiBvYmplY3QgcHJvdmlkZWQgZm9yIGNvbnZlcnNpb24uIik7CiAgICB9CiAgICBpZiAoIW1jcERlZmluaXRpb24ubmFtZSB8fCB0eXBlb2YgbWNwRGVmaW5pdGlvbi5uYW1lICE9PSAic3RyaW5nIikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk1DUCBkZWZpbml0aW9uIG11c3QgaGF2ZSBhIHZhbGlkICduYW1lJyBzdHJpbmcuIik7CiAgICB9CiAgICBpZiAoCiAgICAgICFtY3BEZWZpbml0aW9uLmlucHV0U2NoZW1hIHx8CiAgICAgIHR5cGVvZiBtY3BEZWZpbml0aW9uLmlucHV0U2NoZW1hICE9PSAib2JqZWN0IgogICAgKSB7CiAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAid2FybiIsCiAgICAgICAgYE1DUCBkZWZpbml0aW9uIGZvciAnJHttY3BEZWZpbml0aW9uLm5hbWV9JyBtaXNzaW5nIG9yIGhhcyBpbnZhbGlkICdpbnB1dFNjaGVtYScuIENyZWF0aW5nIGRlY2xhcmF0aW9uIHdpdGggbm8gcGFyYW1ldGVycy5gCiAgICAgICk7CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogbWNwRGVmaW5pdGlvbi5uYW1lLAogICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgbWNwRGVmaW5pdGlvbi5kZXNjcmlwdGlvbiB8fCBgRnVuY3Rpb24gJHttY3BEZWZpbml0aW9uLm5hbWV9YCwKICAgICAgICBwYXJhbWV0ZXJzOiB7IHR5cGU6ICJPQkpFQ1QiLCBwcm9wZXJ0aWVzOiB7fSB9LAogICAgICB9OwogICAgfQoKICAgIGlmIChtY3BEZWZpbml0aW9uLmlucHV0U2NoZW1hLnR5cGU/LnRvTG93ZXJDYXNlKCkgIT09ICJvYmplY3QiKSB7CiAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAid2FybiIsCiAgICAgICAgYE1DUCBpbnB1dFNjaGVtYSB0eXBlIGZvciAnJHttY3BEZWZpbml0aW9uLm5hbWV9JyBpcyBub3QgJ29iamVjdCcgKCR7bWNwRGVmaW5pdGlvbi5pbnB1dFNjaGVtYS50eXBlfSkuIEZvcmNpbmcgdG8gT0JKRUNUIGZvciBHZW1pbmkgY29tcGF0aWJpbGl0eS5gCiAgICAgICk7CiAgICB9CgogICAgY29uc3QgZ2VtaW5pUGFyYW1ldGVycyA9IHsKICAgICAgdHlwZTogIk9CSkVDVCIsCiAgICAgIHByb3BlcnRpZXM6IGNvbnZlcnRNY3BQcm9wZXJ0aWVzKG1jcERlZmluaXRpb24uaW5wdXRTY2hlbWEucHJvcGVydGllcyksCiAgICAgIHJlcXVpcmVkOiBBcnJheS5pc0FycmF5KG1jcERlZmluaXRpb24uaW5wdXRTY2hlbWEucmVxdWlyZWQpCiAgICAgICAgPyBtY3BEZWZpbml0aW9uLmlucHV0U2NoZW1hLnJlcXVpcmVkCiAgICAgICAgOiBbXSwKICAgIH07CgogICAgaWYgKAogICAgICBPYmplY3Qua2V5cyhnZW1pbmlQYXJhbWV0ZXJzLnByb3BlcnRpZXMpLmxlbmd0aCA9PT0gMCAmJgogICAgICBnZW1pbmlQYXJhbWV0ZXJzLnJlcXVpcmVkLmxlbmd0aCA9PT0gMAogICAgKSB7CiAgICB9IGVsc2UgewogICAgICBnZW1pbmlQYXJhbWV0ZXJzLnJlcXVpcmVkID0gZ2VtaW5pUGFyYW1ldGVycy5yZXF1aXJlZC5maWx0ZXIoKHJlcUtleSkgPT4KICAgICAgICBnZW1pbmlQYXJhbWV0ZXJzLnByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkocmVxS2V5KQogICAgICApOwogICAgfQoKICAgIGNvbnN0IGdlbWluaURlY2xhcmF0aW9uID0gewogICAgICBuYW1lOiBtY3BEZWZpbml0aW9uLm5hbWUsCiAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgIG1jcERlZmluaXRpb24uZGVzY3JpcHRpb24gfHwgYEZ1bmN0aW9uICR7bWNwRGVmaW5pdGlvbi5uYW1lfWAsCiAgICAgIHBhcmFtZXRlcnM6IGdlbWluaVBhcmFtZXRlcnMsCiAgICB9OwoKICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgImRlYnVnIiwKICAgICAgYENvbnZlcnRlZCBNQ1AgdG9vbCAnJHttY3BEZWZpbml0aW9uLm5hbWV9JyB0byBHZW1pbmkgRnVuY3Rpb25EZWNsYXJhdGlvbi5gCiAgICApOwogICAgcmV0dXJuIGdlbWluaURlY2xhcmF0aW9uOwogIH07CgogIGNvbnN0IGdlbWluaVRvTWNwRnVuY3Rpb25EZWZpbml0aW9uID0gKGdlbWluaURlY2xhcmF0aW9uKSA9PiB7CiAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICJ3YXJuIiwKICAgICAgIkNvbnZlcnNpb24gZnJvbSBHZW1pbmkgRnVuY3Rpb25EZWNsYXJhdGlvbiBiYWNrIHRvIE1DUCBpcyBub3QgZnVsbHkgaW1wbGVtZW50ZWQuIgogICAgKTsKCiAgICBpZiAoIWdlbWluaURlY2xhcmF0aW9uIHx8ICFnZW1pbmlEZWNsYXJhdGlvbi5uYW1lKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAiSW52YWxpZCBHZW1pbmkgZGVjbGFyYXRpb24gcHJvdmlkZWQgZm9yIGNvbnZlcnNpb24gYmFjayB0byBNQ1AuIgogICAgICApOwogICAgfQogICAgY29uc3QgbWFwR2VtaW5pVHlwZVRvTWNwID0gKGdlbWluaVR5cGUpID0+IHsKICAgICAgc3dpdGNoIChnZW1pbmlUeXBlKSB7CiAgICAgICAgY2FzZSAiU1RSSU5HIjoKICAgICAgICAgIHJldHVybiAic3RyaW5nIjsKICAgICAgICBjYXNlICJJTlRFR0VSIjoKICAgICAgICAgIHJldHVybiAiaW50ZWdlciI7CiAgICAgICAgY2FzZSAiTlVNQkVSIjoKICAgICAgICAgIHJldHVybiAibnVtYmVyIjsKICAgICAgICBjYXNlICJCT09MRUFOIjoKICAgICAgICAgIHJldHVybiAiYm9vbGVhbiI7CiAgICAgICAgY2FzZSAiQVJSQVkiOgogICAgICAgICAgcmV0dXJuICJhcnJheSI7CiAgICAgICAgY2FzZSAiT0JKRUNUIjoKICAgICAgICAgIHJldHVybiAib2JqZWN0IjsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuICJzdHJpbmciOwogICAgICB9CiAgICB9OwoKICAgIGNvbnN0IGNvbnZlcnRHZW1pbmlQcm9wZXJ0aWVzID0gKGdlbWluaVByb3BzKSA9PiB7CiAgICAgIGlmICghZ2VtaW5pUHJvcHMpIHJldHVybiB7fTsKICAgICAgY29uc3QgbWNwUHJvcHMgPSB7fTsKICAgICAgZm9yIChjb25zdCBrZXkgaW4gZ2VtaW5pUHJvcHMpIHsKICAgICAgICBjb25zdCBnZW1pbmlQcm9wID0gZ2VtaW5pUHJvcHNba2V5XTsKICAgICAgICBtY3BQcm9wc1trZXldID0gewogICAgICAgICAgdHlwZTogbWFwR2VtaW5pVHlwZVRvTWNwKGdlbWluaVByb3AudHlwZSksCiAgICAgICAgICBkZXNjcmlwdGlvbjogZ2VtaW5pUHJvcC5kZXNjcmlwdGlvbiB8fCAiIiwKICAgICAgICB9OwogICAgICAgIGlmIChnZW1pbmlQcm9wLmVudW0pIG1jcFByb3BzW2tleV0uZW51bSA9IGdlbWluaVByb3AuZW51bTsKICAgICAgfQogICAgICByZXR1cm4gbWNwUHJvcHM7CiAgICB9OwoKICAgIGNvbnN0IG1jcERlZmluaXRpb24gPSB7CiAgICAgIG5hbWU6IGdlbWluaURlY2xhcmF0aW9uLm5hbWUsCiAgICAgIGRlc2NyaXB0aW9uOiBnZW1pbmlEZWNsYXJhdGlvbi5kZXNjcmlwdGlvbiB8fCAiIiwKICAgICAgaW5wdXRTY2hlbWE6IHsKICAgICAgICB0eXBlOiAib2JqZWN0IiwKICAgICAgICBwcm9wZXJ0aWVzOiBjb252ZXJ0R2VtaW5pUHJvcGVydGllcygKICAgICAgICAgIGdlbWluaURlY2xhcmF0aW9uLnBhcmFtZXRlcnM/LnByb3BlcnRpZXMKICAgICAgICApLAogICAgICAgIHJlcXVpcmVkOiBnZW1pbmlEZWNsYXJhdGlvbi5wYXJhbWV0ZXJzPy5yZXF1aXJlZCB8fCBbXSwKICAgICAgfSwKICAgIH07CiAgICByZXR1cm4gbWNwRGVmaW5pdGlvbjsKICB9OwoKICByZXR1cm4gewogICAgbWNwVG9HZW1pbmlGdW5jdGlvbkRlY2xhcmF0aW9uLAogICAgZ2VtaW5pVG9NY3BGdW5jdGlvbkRlZmluaXRpb24sCiAgfTsKfTsKCmV4cG9ydCBkZWZhdWx0IE1DUENvbnZlcnRlck1vZHVsZTsK
--- CATS_END_FILE ---

--- CATS_START_FILE: ui-body.html ---
PGhlYWRlcj4KICA8aDE+CiAgICBEUkVBTUVSIEQ8c3ViPmVzaWduPC9zdWI+IFI8c3ViPmFkaWF0ZXM8L3N1Yj4gRTxzdWI+bGVnYW50PC9zdWI+IEE8c3ViCiAgICAgID5uZDwvc3ViCiAgICA+CiAgICBNPHN1Yj5vZHVsYXI8L3N1Yj4gRTxzdWI+bGVtZW50czwvc3ViPiBSRUNPTUJJTkVEIFI8c3ViPmVjdXJzaXZlPC9zdWI+IEU8c3ViCiAgICA+bGVtZW50PC9zdWI+IEM8c3ViPnJlYXRvcjwvc3ViPiBPPHN1Yj5wdGltaXplZDwvc3ViPiBNPHN1YgogICAgICA+ZXRpY3Vsb3VzbHk8L3N1YgogICAgPgogICAgQjxzdWI+eTwvc3ViPiBJPHN1Yj5uZmluaXRlPC9zdWI+IE48c3ViPmV0d29yazwvc3ViPiBFPHN1Yj52b2x1dGlvbjwvc3ViPgogICAgRFJFQU1FUgogIDwvaDE+CjwvaGVhZGVyPgo8bWFpbiBpZD0ibWFpbi1jb250ZW50Ij4KICA8c2VjdGlvbiBpZD0iY29udHJvbHMtc2VjdGlvbiI+CiAgICA8ZmllbGRzZXQ+CiAgICAgIDxsZWdlbmQ+Q29udHJvbHM8L2xlZ2VuZD4KICAgICAgPGRpdiBjbGFzcz0iY29udHJvbC1ncmlkIj4KICAgICAgICA8ZGl2IGNsYXNzPSJhcGkta2V5LWlucHV0Ij4KICAgICAgICAgIDxsYWJlbCBmb3I9ImFwaS1rZXktaW5wdXQiPkdlbWluaSBBUEkgS2V5OjwvbGFiZWw+CiAgICAgICAgICA8aW5wdXQKICAgICAgICAgICAgdHlwZT0icGFzc3dvcmQiCiAgICAgICAgICAgIGlkPSJhcGkta2V5LWlucHV0IgogICAgICAgICAgICBwbGFjZWhvbGRlcj0iRW50ZXIgeW91ciBBUEkga2V5IgogICAgICAgICAgLz4KICAgICAgICA8L2Rpdj4KICAgICAgICA8YnV0dG9uIGlkPSJzYXZlLWFwaS1rZXktYnV0dG9uIj5TYXZlIEtleTwvYnV0dG9uPgogICAgICAgIDxidXR0b24gaWQ9ImV4cG9ydC1zdGF0ZS1idXR0b24iPkV4cG9ydCBTdGF0ZTwvYnV0dG9uPgogICAgICAgIDxidXR0b24gaWQ9ImltcG9ydC1zdGF0ZS1idXR0b24iPkltcG9ydCBTdGF0ZTwvYnV0dG9uPgogICAgICAgIDxpbnB1dAogICAgICAgICAgdHlwZT0iZmlsZSIKICAgICAgICAgIGlkPSJpbXBvcnQtZmlsZS1pbnB1dCIKICAgICAgICAgIGFjY2VwdD0iLmpzb24iCiAgICAgICAgICBjbGFzcz0iaGlkZGVuIgogICAgICAgIC8+CiAgICAgICAgPGJ1dHRvbiBpZD0iZG93bmxvYWQtbG9nLWJ1dHRvbiI+RG93bmxvYWQgTG9nczwvYnV0dG9uPgogICAgICAgIDxidXR0b24KICAgICAgICAgIGlkPSJjbGVhci1zdG9yYWdlLWJ1dHRvbiIKICAgICAgICAgIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1lcnJvci1jb2xvcikiCiAgICAgICAgPgogICAgICAgICAgQ2xlYXIgU3RvcmFnZQogICAgICAgIDwvYnV0dG9uPgogICAgICA8L2Rpdj4KICAgICAgPGRpdgogICAgICAgIGlkPSJzdGF0dXMtaW5kaWNhdG9yIgogICAgICAgIHN0eWxlPSJtYXJnaW4tdG9wOiB2YXIoLS1wYWRkaW5nLXNtKTsgZm9udC1zdHlsZTogaXRhbGljOyBjb2xvcjogI2FhYSIKICAgICAgPgogICAgICAgIFN0YXR1czogSWRsZQogICAgICA8L2Rpdj4KICAgIDwvZmllbGRzZXQ+CiAgPC9zZWN0aW9uPgoKICA8c2VjdGlvbiBpZD0idG9vbC1jcmVhdGlvbi1zZWN0aW9uIj4KICAgIDxmaWVsZHNldD4KICAgICAgPGxlZ2VuZD5DcmVhdGUgTmV3IFRvb2wvRWRpdCBSZXF1ZXN0PC9sZWdlbmQ+CiAgICAgIDxsYWJlbCBmb3I9InRvb2wtcmVxdWVzdC1pbnB1dCIKICAgICAgICA+RGVzY3JpYmUgdGhlIHRvb2wgeW91IHdhbnQgdG8gY3JlYXRlKCBvciBtb2RpZnkgdGhlIHJlcXVlc3QgYmVsb3cpOjwvbGFiZWw+CiAgICAgIDx0ZXh0YXJlYQogICAgICAgIGlkPSJ0b29sLXJlcXVlc3QtaW5wdXQiCiAgICAgICAgcm93cz0iNCIKICAgICAgICBwbGFjZWhvbGRlcj0iZS5nLiwgJ0NyZWF0ZSBhIHRvb2wgbmFtZWQgY2FsY3VsYXRlQ2lyY2xlQXJlYSB0aGF0IHRha2VzIGEgcmFkaXVzIG51bWJlciBhbmQgcmV0dXJucyB0aGUgYXJlYS4nIgogICAgICA+PC90ZXh0YXJlYT4KICAgICAgPGJ1dHRvbiBpZD0iY3JlYXRlLXRvb2wtYnV0dG9uIj5HZW5lcmF0ZSBUb29sPC9idXR0b24+CiAgICA8L2ZpZWxkc2V0PgogIDwvc2VjdGlvbj4KCiAgPHNlY3Rpb24gaWQ9InRvb2wtbGlicmFyeS1zZWN0aW9uIj4KICAgIDxoMj5HZW5lcmF0ZWQgVG9vbCBMaWJyYXJ5PC9oMj4KICAgIDxkaXYgaWQ9InRvb2wtbGlicmFyeS1jb250cm9scyIgY2xhc3M9InRvb2wtbGlzdC1zZXR0aW5ncyI+CiAgICAgIDxsYWJlbCBmb3I9InRvb2wtbGlzdC1zZWFyY2giPlNlYXJjaDo8L2xhYmVsPgogICAgICA8aW5wdXQgdHlwZT0ic2VhcmNoIiBpZD0idG9vbC1saXN0LXNlYXJjaCIgcGxhY2Vob2xkZXI9IkZpbHRlciBieSBuYW1lLi4uIiAvPgogICAgICA8bGFiZWwgZm9yPSJ0b29sLWxpc3Qtc29ydCI+U29ydCBieTo8L2xhYmVsPgogICAgICA8c2VsZWN0IGlkPSJ0b29sLWxpc3Qtc29ydCI+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0ibmFtZSI+TmFtZTwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9ImRhdGUiPkRhdGUgQ3JlYXRlZDwvb3B0aW9uPgogICAgICA8L3NlbGVjdD4KICAgIDwvZGl2PgoKICAgIDxkaXYgaWQ9InRvb2wtbGlzdC1jb250YWluZXIiIGNsYXNzPSJ0b29sLWxpc3QiPgogICAgICA8cD5ObyB0b29scyBnZW5lcmF0ZWQgeWV0LjwvcD4KICAgIDwvZGl2PgogIDwvc2VjdGlvbj4KPC9tYWluPgo8Zm9vdGVyPgogIDxwPgogICAgRHJlYW1lciB4PHN1cD4yPC9zdXA+IC0gdjxzcGFuIGlkPSJhcHAtdmVyc2lvbiI+PC9zcGFuPgogICAgPGRpdj58IFN0b3JhZ2U6IDxzcGFuIGlkPSJzdG9yYWdlLXVzYWdlIj4/S0IgKD8lKTwvc3Bhbj48L2Rpdj4KICA8L3A+CjwvZm9vdGVyPgo=
--- CATS_END_FILE ---

--- CATS_START_FILE: api-client.js ---
Y29uc3QgQXBpQ2xpZW50TW9kdWxlID0gKGNvbmZpZywgbG9nZ2VyKSA9PiB7CiAgaWYgKCFjb25maWcgfHwgIWxvZ2dlcikgewogICAgY29uc29sZS5lcnJvcigiQXBpQ2xpZW50TW9kdWxlIHJlcXVpcmVzIGNvbmZpZyBhbmQgbG9nZ2VyLiIpOwogICAgcmV0dXJuIG51bGw7CiAgfQoKICBsZXQgY3VycmVudEFib3J0Q29udHJvbGxlciA9IG51bGw7CiAgY29uc3QgQVBJX0VORFBPSU5UX0JBU0UgPSBjb25maWcuZ2VtaW5pQXBpQmFzZVVybDsKICBjb25zdCBSRVRSWV9ERUxBWV9CQVNFX01TID0gY29uZmlnLmFwaVJldHJ5RGVsYXlCYXNlTXM7CiAgY29uc3QgREVGQVVMVF9NQVhfT1VUUFVUX1RPS0VOUyA9IDgxOTI7CgogIGNvbnN0IHNhbml0aXplTGxtSnNvblJlc3BvbnNlID0gKHJhd1RleHQpID0+IHsKICAgIGlmICghcmF3VGV4dCB8fCB0eXBlb2YgcmF3VGV4dCAhPT0gInN0cmluZyIpIHJldHVybiBudWxsOwogICAgbGV0IHRleHQgPSByYXdUZXh0LnRyaW0oKTsKCiAgICBjb25zdCBjb2RlQmxvY2tNYXRjaCA9IHRleHQubWF0Y2goL2BgYCg/Ompzb24pP1xzKihbXHNcU10qPylccypgYGAvKTsKICAgIGlmIChjb2RlQmxvY2tNYXRjaCAmJiBjb2RlQmxvY2tNYXRjaFsxXSkgewogICAgICB0ZXh0ID0gY29kZUJsb2NrTWF0Y2hbMV0udHJpbSgpOwogICAgICB0cnkgewogICAgICAgIEpTT04ucGFyc2UodGV4dCk7CiAgICAgICAgcmV0dXJuIHRleHQ7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICAgICAid2FybiIsCiAgICAgICAgICBgSlNPTiBjb250ZW50IHdpdGhpbiBjb2RlIGJsb2NrIGZhaWxlZCB2YWxpZGF0aW9uOiAke2UubWVzc2FnZX1gCiAgICAgICAgKTsKICAgICAgfQogICAgfQoKICAgIGNvbnN0IGZpcnN0QnJhY2UgPSB0ZXh0LmluZGV4T2YoInsiKTsKICAgIGNvbnN0IGZpcnN0QnJhY2tldCA9IHRleHQuaW5kZXhPZigiWyIpOwogICAgbGV0IHN0YXJ0SW5kZXggPSAtMTsKCiAgICBpZiAoZmlyc3RCcmFjZSAhPT0gLTEgJiYgZmlyc3RCcmFja2V0ICE9PSAtMSkgewogICAgICBzdGFydEluZGV4ID0gTWF0aC5taW4oZmlyc3RCcmFjZSwgZmlyc3RCcmFja2V0KTsKICAgIH0gZWxzZSB7CiAgICAgIHN0YXJ0SW5kZXggPSBNYXRoLm1heChmaXJzdEJyYWNlLCBmaXJzdEJyYWNrZXQpOwogICAgfQoKICAgIGlmIChzdGFydEluZGV4ICE9PSAtMSkgewogICAgICB0ZXh0ID0gdGV4dC5zdWJzdHJpbmcoc3RhcnRJbmRleCk7CiAgICAgIGNvbnN0IHN0YXJ0Q2hhciA9IHRleHRbMF07CiAgICAgIGNvbnN0IGVuZENoYXIgPSBzdGFydENoYXIgPT09ICJ7IiA/ICJ9IiA6ICJdIjsKICAgICAgbGV0IGJhbGFuY2UgPSAwOwogICAgICBsZXQgbGFzdFZhbGlkSW5kZXggPSAtMTsKICAgICAgbGV0IGluU3RyaW5nID0gZmFsc2U7CiAgICAgIGxldCBlc2NhcGVOZXh0ID0gZmFsc2U7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRleHQubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBjaGFyID0gdGV4dFtpXTsKICAgICAgICBpZiAoaW5TdHJpbmcpIHsKICAgICAgICAgIGlmIChlc2NhcGVOZXh0KSB7CiAgICAgICAgICAgIGVzY2FwZU5leHQgPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciA9PT0gIlxcIikgewogICAgICAgICAgICBlc2NhcGVOZXh0ID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciA9PT0gJyInKSB7CiAgICAgICAgICAgIGluU3RyaW5nID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChjaGFyID09PSAnIicpIHsKICAgICAgICAgICAgaW5TdHJpbmcgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChjaGFyID09PSBzdGFydENoYXIpIHsKICAgICAgICAgICAgYmFsYW5jZSsrOwogICAgICAgICAgfSBlbHNlIGlmIChjaGFyID09PSBlbmRDaGFyKSB7CiAgICAgICAgICAgIGJhbGFuY2UtLTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFpblN0cmluZyAmJiBiYWxhbmNlID09PSAwICYmIHN0YXJ0SW5kZXggPT09IDApIHsKICAgICAgICAgIGxhc3RWYWxpZEluZGV4ID0gaTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0gZWxzZSBpZiAoIWluU3RyaW5nICYmIGJhbGFuY2UgPT09IDAgJiYgaSA+IDAgJiYgc3RhcnRJbmRleCA+IDApIHsKICAgICAgICAgIGxhc3RWYWxpZEluZGV4ID0gaTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGxhc3RWYWxpZEluZGV4ICE9PSAtMSkgewogICAgICAgIGNvbnN0IHBvdGVudGlhbEpzb24gPSB0ZXh0LnN1YnN0cmluZygwLCBsYXN0VmFsaWRJbmRleCArIDEpOwogICAgICAgIHRyeSB7CiAgICAgICAgICBKU09OLnBhcnNlKHBvdGVudGlhbEpzb24pOwogICAgICAgICAgcmV0dXJuIHBvdGVudGlhbEpzb247CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgbG9nZ2VyLmxvZ0V2ZW50KAogICAgICAgICAgICAid2FybiIsCiAgICAgICAgICAgIGBIZXVyaXN0aWMgSlNPTiBzYW5pdGl6YXRpb24gZmFpbGVkIHZhbGlkYXRpb246ICR7ZS5tZXNzYWdlfWAKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAgICJ3YXJuIiwKICAgICAgICAgICJKU09OIHNhbml0aXphdGlvbiBmYWlsZWQ6IFVuYmFsYW5jZWQgc3RydWN0dXJlIGZvdW5kIHZpYSBoZXVyaXN0aWMuIgogICAgICAgICk7CiAgICAgIH0KICAgIH0KCiAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICJ3YXJuIiwKICAgICAgIkpTT04gc2FuaXRpemF0aW9uIGZhaWxlZDogQ291bGQgbm90IGV4dHJhY3QgdmFsaWQgSlNPTiBzdHJ1Y3R1cmUuIgogICAgKTsKICAgIHJldHVybiBudWxsOwogIH07CgogIGNvbnN0IGNhbGxBcGlXaXRoUmV0cnkgPSBhc3luYyAoCiAgICBwcm9tcHQsCiAgICBtb2RlbE5hbWUsCiAgICBhcGlLZXksCiAgICBmdW5jdGlvbkRlY2xhcmF0aW9ucyA9IFtdLAogICAgZ2VuZXJhdGlvbkNvbmZpZ092ZXJyaWRlcyA9IHt9LAogICAgcHJvZ3Jlc3NDYWxsYmFjayA9ICh0eXBlLCBkYXRhKSA9PiB7fQogICkgPT4gewogICAgaWYgKGN1cnJlbnRBYm9ydENvbnRyb2xsZXIpIHsKICAgICAgbG9nZ2VyLmxvZ0V2ZW50KAogICAgICAgICJ3YXJuIiwKICAgICAgICAiQWJvcnRpbmcgcHJldmlvdXMgQVBJIGNhbGwgYmVmb3JlIHN0YXJ0aW5nIG5ldyBvbmUuIgogICAgICApOwogICAgICBjdXJyZW50QWJvcnRDb250cm9sbGVyLmFib3J0KCJOZXcgY2FsbCBpbml0aWF0ZWQiKTsKICAgIH0KICAgIGN1cnJlbnRBYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICBsZXQgYXR0ZW1wdCA9IDA7CiAgICBjb25zdCBtYXhSZXRyaWVzID0gY29uZmlnLmFwaU1heFJldHJpZXM7CiAgICBsZXQgY3VycmVudERlbGF5ID0gUkVUUllfREVMQVlfQkFTRV9NUzsKCiAgICB3aGlsZSAoYXR0ZW1wdCA8PSBtYXhSZXRyaWVzKSB7CiAgICAgIGNvbnN0IGF0dGVtcHRNc2cgPSBhdHRlbXB0ID4gMCA/IGBbUkVUUlkgJHthdHRlbXB0fS8ke21heFJldHJpZXN9XWAgOiAiIjsKICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygic3RhdHVzIiwgewogICAgICAgIG1lc3NhZ2U6IGAke2F0dGVtcHRNc2d9IENhbGxpbmcgR2VtaW5pICgke21vZGVsTmFtZX0pLi4uYCwKICAgICAgICBhY3RpdmU6IHRydWUsCiAgICAgIH0pOwoKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBhcGlFbmRwb2ludCA9IGAke0FQSV9FTkRQT0lOVF9CQVNFfSR7bW9kZWxOYW1lfTpzdHJlYW1HZW5lcmF0ZUNvbnRlbnRgOwogICAgICAgIGNvbnN0IHNhZmV0eVNldHRpbmdzID0gWwogICAgICAgICAgIkhBVEVfU1BFRUNIIiwKICAgICAgICAgICJIQVJBU1NNRU5UIiwKICAgICAgICAgICJTRVhVQUxMWV9FWFBMSUNJVCIsCiAgICAgICAgICAiREFOR0VST1VTX0NPTlRFTlQiLAogICAgICAgIF0ubWFwKChjYXQpID0+ICh7CiAgICAgICAgICBjYXRlZ29yeTogYEhBUk1fQ0FURUdPUllfJHtjYXR9YCwKICAgICAgICAgIHRocmVzaG9sZDogIkJMT0NLX01FRElVTV9BTkRfQUJPVkUiLAogICAgICAgIH0pKTsKCiAgICAgICAgY29uc3QgZ2VuZXJhdGlvbkNvbmZpZyA9IHsKICAgICAgICAgIHRlbXBlcmF0dXJlOiAwLjUsCiAgICAgICAgICBtYXhPdXRwdXRUb2tlbnM6IERFRkFVTFRfTUFYX09VVFBVVF9UT0tFTlMsCiAgICAgICAgICAuLi5nZW5lcmF0aW9uQ29uZmlnT3ZlcnJpZGVzLAogICAgICAgIH07CgogICAgICAgIGNvbnN0IHJlcXVlc3RCb2R5ID0gewogICAgICAgICAgY29udGVudHM6IFt7IHJvbGU6ICJ1c2VyIiwgcGFydHM6IFt7IHRleHQ6IHByb21wdCB9XSB9XSwKICAgICAgICAgIHNhZmV0eVNldHRpbmdzOiBzYWZldHlTZXR0aW5ncywKICAgICAgICAgIGdlbmVyYXRpb25Db25maWc6IGdlbmVyYXRpb25Db25maWcsCiAgICAgICAgICAuLi4oZnVuY3Rpb25EZWNsYXJhdGlvbnM/Lmxlbmd0aCA+IDAgJiYgewogICAgICAgICAgICB0b29sczogW3sgZnVuY3Rpb25EZWNsYXJhdGlvbnM6IGZ1bmN0aW9uRGVjbGFyYXRpb25zIH1dLAogICAgICAgICAgICB0b29sX2NvbmZpZzogeyBmdW5jdGlvbl9jYWxsaW5nX2NvbmZpZzogeyBtb2RlOiAiQU5ZIiB9IH0sCiAgICAgICAgICB9KSwKICAgICAgICB9OwoKICAgICAgICBpZiAoZnVuY3Rpb25EZWNsYXJhdGlvbnM/Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgcmVxdWVzdEJvZHkuZ2VuZXJhdGlvbkNvbmZpZy5yZXNwb25zZU1pbWVUeXBlID0gImFwcGxpY2F0aW9uL2pzb24iOwogICAgICAgIH0KCiAgICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJkZWJ1ZyIsIGBBUEkgUmVxdWVzdCBCb2R5IChBdHRlbXB0ICR7YXR0ZW1wdH0pYCwgewogICAgICAgICAgZW5kcG9pbnQ6IGFwaUVuZHBvaW50LAogICAgICAgICAgaGFzVG9vbHM6IGZ1bmN0aW9uRGVjbGFyYXRpb25zLmxlbmd0aCA+IDAsCiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7YXBpRW5kcG9pbnR9P2tleT0ke2FwaUtleX0mYWx0PXNzZWAsIHsKICAgICAgICAgIG1ldGhvZDogIlBPU1QiLAogICAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iIH0sCiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSksCiAgICAgICAgICBzaWduYWw6IGN1cnJlbnRBYm9ydENvbnRyb2xsZXIuc2lnbmFsLAogICAgICAgIH0pOwoKICAgICAgICBpZiAoIXJlc3BvbnNlLm9rIHx8ICFyZXNwb25zZS5ib2R5KSB7CiAgICAgICAgICBsZXQgZXJyQm9keVRleHQgPSAiKEZhaWxlZCB0byByZWFkIGVycm9yIGJvZHkpIjsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGVyckJvZHlUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpOwogICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgIGxldCBlcnJKc29uID0ge307CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBlcnJKc29uID0gSlNPTi5wYXJzZShlcnJCb2R5VGV4dCk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0KICAgICAgICAgICAgZXJySnNvbj8uZXJyb3I/Lm1lc3NhZ2UgfHwgcmVzcG9uc2Uuc3RhdHVzVGV4dCB8fCBlcnJCb2R5VGV4dDsKICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKAogICAgICAgICAgICBgQVBJIEVycm9yICgke3Jlc3BvbnNlLnN0YXR1c30pOiAke2Vycm9yTWVzc2FnZX1gCiAgICAgICAgICApOwogICAgICAgICAgZXJyb3Iuc3RhdHVzID0gcmVzcG9uc2Uuc3RhdHVzOwogICAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgICAgfQoKICAgICAgICBwcm9ncmVzc0NhbGxiYWNrKCJzdGF0dXMiLCB7CiAgICAgICAgICBtZXNzYWdlOiAiUmVjZWl2aW5nIHN0cmVhbS4uLiIsCiAgICAgICAgICBhY3RpdmU6IHRydWUsCiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IHJlYWRlciA9IHJlc3BvbnNlLmJvZHkuZ2V0UmVhZGVyKCk7CiAgICAgICAgY29uc3QgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpOwogICAgICAgIGxldCBidWZmZXIgPSAiIjsKICAgICAgICBsZXQgYWNjdW11bGF0ZWRUZXh0ID0gIiI7CiAgICAgICAgbGV0IGFjY3VtdWxhdGVkRnVuY3Rpb25DYWxscyA9IFtdOwogICAgICAgIGxldCB0b3RhbElucHV0VG9rZW5zID0gMDsKICAgICAgICBsZXQgdG90YWxPdXRwdXRUb2tlbnMgPSAwOwogICAgICAgIGxldCBmaW5hbEZpbmlzaFJlYXNvbiA9ICJVTktOT1dOIjsKICAgICAgICBsZXQgYmxvY2tSZWFzb24gPSBudWxsOwogICAgICAgIGxldCBzYWZldHlSYXRpbmdzID0gW107CgogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBpZiAoY3VycmVudEFib3J0Q29udHJvbGxlcj8uc2lnbmFsLmFib3J0ZWQpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWJvcnRlZCIpOwogICAgICAgICAgY29uc3QgeyB2YWx1ZSwgZG9uZSB9ID0gYXdhaXQgcmVhZGVyLnJlYWQoKTsKICAgICAgICAgIGlmIChkb25lKSBicmVhazsKCiAgICAgICAgICBidWZmZXIgKz0gZGVjb2Rlci5kZWNvZGUodmFsdWUsIHsgc3RyZWFtOiB0cnVlIH0pOwogICAgICAgICAgY29uc3QgbGluZXMgPSBidWZmZXIuc3BsaXQoIlxuIik7CiAgICAgICAgICBidWZmZXIgPSBsaW5lcy5wb3AoKSB8fCAiIjsKCiAgICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHsKICAgICAgICAgICAgaWYgKGxpbmUuc3RhcnRzV2l0aCgiZGF0YTogIikpIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgY2h1bmsgPSBKU09OLnBhcnNlKGxpbmUuc3Vic3RyaW5nKDYpKTsKCiAgICAgICAgICAgICAgICBpZiAoY2h1bmsucHJvbXB0RmVlZGJhY2s/LmJsb2NrUmVhc29uKSB7CiAgICAgICAgICAgICAgICAgIGJsb2NrUmVhc29uID0gY2h1bmsucHJvbXB0RmVlZGJhY2suYmxvY2tSZWFzb247CiAgICAgICAgICAgICAgICAgIHNhZmV0eVJhdGluZ3MgPSBjaHVuay5wcm9tcHRGZWVkYmFjay5zYWZldHlSYXRpbmdzIHx8IFtdOwogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEFQSSBCbG9ja2VkIChQcm9tcHQpOiAke2Jsb2NrUmVhc29ufWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNodW5rLmVycm9yKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgICAgICAgICBgQVBJIEVycm9yIGluIGNodW5rOiAke2NodW5rLmVycm9yLm1lc3NhZ2UgfHwgIlVua25vd24ifWAKICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0b3RhbElucHV0VG9rZW5zID0KICAgICAgICAgICAgICAgICAgY2h1bmsudXNhZ2VNZXRhZGF0YT8ucHJvbXB0VG9rZW5Db3VudCA/PyB0b3RhbElucHV0VG9rZW5zOwogICAgICAgICAgICAgICAgdG90YWxPdXRwdXRUb2tlbnMgPQogICAgICAgICAgICAgICAgICBjaHVuay51c2FnZU1ldGFkYXRhPy5jYW5kaWRhdGVzVG9rZW5Db3VudCA/PwogICAgICAgICAgICAgICAgICB0b3RhbE91dHB1dFRva2VuczsKCiAgICAgICAgICAgICAgICBjb25zdCBjYW5kaWRhdGUgPSBjaHVuay5jYW5kaWRhdGVzPy5bMF07CiAgICAgICAgICAgICAgICBpZiAoY2FuZGlkYXRlKSB7CiAgICAgICAgICAgICAgICAgIGZpbmFsRmluaXNoUmVhc29uID0KICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGUuZmluaXNoUmVhc29uIHx8IGZpbmFsRmluaXNoUmVhc29uOwogICAgICAgICAgICAgICAgICBzYWZldHlSYXRpbmdzID0gY2FuZGlkYXRlLnNhZmV0eVJhdGluZ3MgfHwgc2FmZXR5UmF0aW5nczsKICAgICAgICAgICAgICAgICAgaWYgKGZpbmFsRmluaXNoUmVhc29uID09PSAiU0FGRVRZIikgewogICAgICAgICAgICAgICAgICAgIGJsb2NrUmVhc29uID0gIlNBRkVUWSI7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBBUEkgUmVzcG9uc2UgQmxvY2tlZDogU0FGRVRZYCk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gY2FuZGlkYXRlLmNvbnRlbnQ/LnBhcnRzID8/IFtdOwogICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgcGFydHMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocGFydC50ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICBhY2N1bXVsYXRlZFRleHQgKz0gcGFydC50ZXh0OwogICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygicHJvZ3Jlc3MiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogcGFydC50ZXh0LAogICAgICAgICAgICAgICAgICAgICAgICBhY2N1bXVsYXRlZDogYWNjdW11bGF0ZWRUZXh0LAogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0LmZ1bmN0aW9uQ2FsbCkgewogICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdDYWxsSW5kZXggPQogICAgICAgICAgICAgICAgICAgICAgICBhY2N1bXVsYXRlZEZ1bmN0aW9uQ2FsbHMuZmluZEluZGV4KAogICAgICAgICAgICAgICAgICAgICAgICAgIChmYykgPT4gZmMubmFtZSA9PT0gcGFydC5mdW5jdGlvbkNhbGwubmFtZQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nQ2FsbEluZGV4ID4gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWNjdW11bGF0ZWRGdW5jdGlvbkNhbGxzW2V4aXN0aW5nQ2FsbEluZGV4XSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydC5mdW5jdGlvbkNhbGw7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBhY2N1bXVsYXRlZEZ1bmN0aW9uQ2FsbHMucHVzaChwYXJ0LmZ1bmN0aW9uQ2FsbCk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0NhbGxiYWNrKCJwcm9ncmVzcyIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImZ1bmN0aW9uQ2FsbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHBhcnQuZnVuY3Rpb25DYWxsLAogICAgICAgICAgICAgICAgICAgICAgICBhY2N1bXVsYXRlZDogWy4uLmFjY3VtdWxhdGVkRnVuY3Rpb25DYWxsc10sCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0b3RhbElucHV0VG9rZW5zID4gMCB8fCB0b3RhbE91dHB1dFRva2VucyA+IDApIHsKICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygic3RhdHVzIiwgewogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGBUb2tlbnM6IEluICR7dG90YWxJbnB1dFRva2Vuc30sIE91dCAke3RvdGFsT3V0cHV0VG9rZW5zfWAsCiAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiB0cnVlLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgIGUubWVzc2FnZS5pbmNsdWRlcygiQVBJIEJsb2NrZWQiKSB8fAogICAgICAgICAgICAgICAgICBlLm1lc3NhZ2UuaW5jbHVkZXMoIkFQSSBFcnJvciBpbiBjaHVuayIpIHx8CiAgICAgICAgICAgICAgICAgIGUubWVzc2FnZS5pbmNsdWRlcygiQWJvcnRlZCIpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICAgICAgICAgICAgICJ3YXJuIiwKICAgICAgICAgICAgICAgICAgYEZhaWxlZCB0byBwYXJzZS9wcm9jZXNzIFNTRSBjaHVuazogJHtlLm1lc3NhZ2V9YCwKICAgICAgICAgICAgICAgICAgbGluZQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHByb2dyZXNzQ2FsbGJhY2soInN0YXR1cyIsIHsKICAgICAgICAgIG1lc3NhZ2U6IGBTdHJlYW0gZmluaXNoZWQgKCR7ZmluYWxGaW5pc2hSZWFzb259KS4gUHJvY2Vzc2luZy4uLmAsCiAgICAgICAgICBhY3RpdmU6IHRydWUsCiAgICAgICAgfSk7CiAgICAgICAgbG9nZ2VyLmxvZ0V2ZW50KAogICAgICAgICAgImluZm8iLAogICAgICAgICAgYEFQSSBTdHJlYW0gT0suIEZpbmlzaDoke2ZpbmFsRmluaXNoUmVhc29ufS4gVG9rZW5zIEluOiR7dG90YWxJbnB1dFRva2Vuc30sIE91dDoke3RvdGFsT3V0cHV0VG9rZW5zfWAKICAgICAgICApOwoKICAgICAgICBsZXQgcmVzdWx0VHlwZSA9ICJlbXB0eSI7CiAgICAgICAgbGV0IHJlc3VsdERhdGEgPSBudWxsOwogICAgICAgIGlmIChhY2N1bXVsYXRlZEZ1bmN0aW9uQ2FsbHMubGVuZ3RoID4gMCkgewogICAgICAgICAgcmVzdWx0VHlwZSA9ICJmdW5jdGlvbkNhbGwiOwogICAgICAgICAgcmVzdWx0RGF0YSA9IGFjY3VtdWxhdGVkRnVuY3Rpb25DYWxsczsKICAgICAgICB9IGVsc2UgaWYgKGFjY3VtdWxhdGVkVGV4dCkgewogICAgICAgICAgcmVzdWx0VHlwZSA9ICJ0ZXh0IjsKICAgICAgICAgIHJlc3VsdERhdGEgPSBhY2N1bXVsYXRlZFRleHQ7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBmaW5hbFJlc3VsdCA9IHsKICAgICAgICAgIHR5cGU6IHJlc3VsdFR5cGUsCiAgICAgICAgICBkYXRhOiByZXN1bHREYXRhLAogICAgICAgICAgaW5wdXRUb2tlbkNvdW50OiB0b3RhbElucHV0VG9rZW5zLAogICAgICAgICAgb3V0cHV0VG9rZW5Db3VudDogdG90YWxPdXRwdXRUb2tlbnMsCiAgICAgICAgICBmaW5pc2hSZWFzb246IGZpbmFsRmluaXNoUmVhc29uLAogICAgICAgICAgYmxvY2tSZWFzb246IGJsb2NrUmVhc29uLAogICAgICAgICAgc2FmZXR5UmF0aW5nczogc2FmZXR5UmF0aW5ncywKICAgICAgICB9OwogICAgICAgIHByb2dyZXNzQ2FsbGJhY2soInJlc3VsdCIsIGZpbmFsUmVzdWx0KTsKICAgICAgICBjdXJyZW50QWJvcnRDb250cm9sbGVyID0gbnVsbDsKICAgICAgICByZXR1cm4gZmluYWxSZXN1bHQ7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc3QgaXNBYm9ydCA9IGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoIkFib3J0ZWQiKTsKICAgICAgICBpZiAoaXNBYm9ydCkgewogICAgICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygic3RhdHVzIiwgeyBtZXNzYWdlOiAiQWJvcnRlZC4iLCBhY3RpdmU6IGZhbHNlIH0pOwogICAgICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygiZXJyb3IiLCB7IG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfSk7CiAgICAgICAgICBjdXJyZW50QWJvcnRDb250cm9sbGVyID0gbnVsbDsKICAgICAgICAgIHRocm93IGVycm9yOwogICAgICAgIH0KCiAgICAgICAgY29uc3Qgc3RhdHVzID0gZXJyb3Iuc3RhdHVzIHx8IDA7CiAgICAgICAgY29uc3QgcmVhc29uID0gZXJyb3IubWVzc2FnZSB8fCAiVW5rbm93biBBUEkgZXJyb3IiOwogICAgICAgIHByb2dyZXNzQ2FsbGJhY2soInN0YXR1cyIsIHsKICAgICAgICAgIG1lc3NhZ2U6IGBFcnJvciAoJHtzdGF0dXN9KTogJHtyZWFzb24uc3Vic3RyaW5nKDAsIDUwKX0uLi4gUmV0cnlpbmc/YCwKICAgICAgICAgIGFjdGl2ZTogdHJ1ZSwKICAgICAgICAgIGlzRXJyb3I6IHRydWUsCiAgICAgICAgfSk7CiAgICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygiZXJyb3IiLCB7IG1lc3NhZ2U6IHJlYXNvbiwgc3RhdHVzOiBzdGF0dXMgfSk7CgogICAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAgICJ3YXJuIiwKICAgICAgICAgIGBBUEkgYXR0ZW1wdCAke2F0dGVtcHR9IGZhaWxlZDogJHtyZWFzb259LiBTdGF0dXM6ICR7c3RhdHVzfS4gUmV0cmllcyBsZWZ0OiAkewogICAgICAgICAgICBtYXhSZXRyaWVzIC0gYXR0ZW1wdAogICAgICAgICAgfWAKICAgICAgICApOwogICAgICAgIGF0dGVtcHQrKzsKCiAgICAgICAgaWYgKAogICAgICAgICAgYXR0ZW1wdCA+IG1heFJldHJpZXMgfHwKICAgICAgICAgIHN0YXR1cyA9PT0gNDAwIHx8CiAgICAgICAgICBzdGF0dXMgPT09IDQwMSB8fAogICAgICAgICAgc3RhdHVzID09PSA0MDMgfHwKICAgICAgICAgIHN0YXR1cyA9PT0gNDA0IHx8CiAgICAgICAgICBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCJBUEkgQmxvY2tlZCIpCiAgICAgICAgKSB7CiAgICAgICAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICAgICAgICJlcnJvciIsCiAgICAgICAgICAgIGBBUEkgY2FsbCBmYWlsZWQgcGVybWFuZW50bHkgYWZ0ZXIgJHsKICAgICAgICAgICAgICBhdHRlbXB0IC0gMQogICAgICAgICAgICB9IGF0dGVtcHRzIG9yIGR1ZSB0byBub24tcmV0cnlhYmxlIGVycm9yICgke3N0YXR1c30pLmAKICAgICAgICAgICk7CiAgICAgICAgICBwcm9ncmVzc0NhbGxiYWNrKCJzdGF0dXMiLCB7CiAgICAgICAgICAgIG1lc3NhZ2U6IGBBUEkgRmFpbGVkICgke3N0YXR1c30pYCwKICAgICAgICAgICAgYWN0aXZlOiBmYWxzZSwKICAgICAgICAgICAgaXNFcnJvcjogdHJ1ZSwKICAgICAgICAgIH0pOwogICAgICAgICAgY3VycmVudEFib3J0Q29udHJvbGxlciA9IG51bGw7CiAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGRlbGF5TXMgPSBNYXRoLm1pbihjdXJyZW50RGVsYXkgKiAyICoqIChhdHRlbXB0IC0gMSksIDMwMDAwKTsKICAgICAgICBwcm9ncmVzc0NhbGxiYWNrKCJzdGF0dXMiLCB7CiAgICAgICAgICBtZXNzYWdlOiBgUmV0cnlpbmcgaW4gJHtNYXRoLnJvdW5kKGRlbGF5TXMgLyAxMDAwKX1zLi4uYCwKICAgICAgICAgIGFjdGl2ZTogdHJ1ZSwKICAgICAgICB9KTsKICAgICAgICBpZiAoY3VycmVudEFib3J0Q29udHJvbGxlcj8uc2lnbmFsLmFib3J0ZWQpCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFib3J0ZWQgZHVyaW5nIHJldHJ5IGRlbGF5Iik7CiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZGVsYXlNcykpOwogICAgICAgIGlmIChjdXJyZW50QWJvcnRDb250cm9sbGVyPy5zaWduYWwuYWJvcnRlZCkKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWJvcnRlZCBhZnRlciByZXRyeSBkZWxheSIpOwogICAgICB9CiAgICB9CgogICAgY3VycmVudEFib3J0Q29udHJvbGxlciA9IG51bGw7CiAgICB0aHJvdyBuZXcgRXJyb3IoIkFQSSBjYWxsIGZhaWxlZCBhZnRlciBleGhhdXN0aW5nIGFsbCByZXRyaWVzLiIpOwogIH07CgogIGNvbnN0IGFib3J0Q3VycmVudENhbGwgPSAocmVhc29uID0gIlVzZXIgcmVxdWVzdGVkIGFib3J0IikgPT4gewogICAgaWYgKGN1cnJlbnRBYm9ydENvbnRyb2xsZXIpIHsKICAgICAgbG9nZ2VyLmxvZ0V2ZW50KAogICAgICAgICJpbmZvIiwKICAgICAgICBgVXNlciByZXF1ZXN0ZWQgQVBJIGNhbGwgYWJvcnQuIFJlYXNvbjogJHtyZWFzb259YAogICAgICApOwogICAgICBjdXJyZW50QWJvcnRDb250cm9sbGVyLmFib3J0KHJlYXNvbik7CiAgICAgIGN1cnJlbnRBYm9ydENvbnRyb2xsZXIgPSBudWxsOwogICAgfSBlbHNlIHsKICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJpbmZvIiwgIk5vIGFjdGl2ZSBBUEkgY2FsbCB0byBhYm9ydC4iKTsKICAgIH0KICB9OwoKICByZXR1cm4gewogICAgY2FsbEFwaVdpdGhSZXRyeSwKICAgIGFib3J0Q3VycmVudENhbGwsCiAgICBzYW5pdGl6ZUxsbUpzb25SZXNwb25zZSwKICB9Owp9OwoKZXhwb3J0IGRlZmF1bHQgQXBpQ2xpZW50TW9kdWxlOwo=
--- CATS_END_FILE ---

--- CATS_START_FILE: utils.js ---
Y29uc3QgVXRpbHNNb2R1bGUgPSAoKCkgPT4gewogIGxldCBjb25maWcgPSBudWxsOwogIGxldCBsb2dCdWZmZXJBcnJheSA9IFtdOwogIGxldCBsb2dCdWZmZXJJbmRleCA9IDA7CiAgbGV0IGxvZ0J1ZmZlckluaXRpYWxpemVkID0gZmFsc2U7CgogIGNvbnN0IE1BWF9MT0dfRU5UUklFUyA9ICgpID0+IGNvbmZpZz8ubWF4TG9nRW50cmllcyB8fCAxMDAwOwoKICBjb25zdCBpbml0TG9nQnVmZmVyID0gKGNmZykgPT4gewogICAgY29uZmlnID0gY2ZnOwogICAgbG9nQnVmZmVyQXJyYXkgPSBuZXcgQXJyYXkoTUFYX0xPR19FTlRSSUVTKCkpOwogICAgbG9nQnVmZmVyQXJyYXkuZmlsbChudWxsKTsKICAgIGxvZ0J1ZmZlckluZGV4ID0gMDsKICAgIGxvZ0J1ZmZlckFycmF5WwogICAgICBsb2dCdWZmZXJJbmRleCsrCiAgICBdID0gYFJlcGxvaWQgdjIgTG9nIFN0YXJ0IC0gJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCl9XG49PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuYDsKICAgIGxvZ0J1ZmZlckluaXRpYWxpemVkID0gdHJ1ZTsKICB9OwoKICBjb25zdCBzdHJpbmdpZnlEZXRhaWwgPSAoZGV0YWlsKSA9PiB7CiAgICBpZiAoZGV0YWlsID09PSB1bmRlZmluZWQgfHwgZGV0YWlsID09PSBudWxsKSByZXR1cm4gIiI7CiAgICBpZiAodHlwZW9mIGRldGFpbCA9PT0gInN0cmluZyIpIHJldHVybiBkZXRhaWw7CiAgICBpZiAoZGV0YWlsIGluc3RhbmNlb2YgRXJyb3IpCiAgICAgIHJldHVybiBgRXJyb3I6ICR7ZGV0YWlsLm1lc3NhZ2V9JHsKICAgICAgICBkZXRhaWwuc3RhY2sgPyBgXG5TdGFjazogJHtkZXRhaWwuc3RhY2t9YCA6ICIiCiAgICAgIH1gOwogICAgdHJ5IHsKICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KAogICAgICAgIGRldGFpbCwKICAgICAgICAoa2V5LCB2YWx1ZSkgPT4KICAgICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gImJpZ2ludCIgPyB2YWx1ZS50b1N0cmluZygpICsgIm4iIDogdmFsdWUsCiAgICAgICAgbnVsbCwKICAgICAgICAyCiAgICAgICk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHJldHVybiAiW1Vuc2VyaWFsaXphYmxlIE9iamVjdF0iOwogICAgfQogIH07CgogIGNvbnN0IGxvZ2dlciA9IHsKICAgIGluaXQ6IGluaXRMb2dCdWZmZXIsCiAgICBsb2dFdmVudDogKGxldmVsID0gImluZm8iLCBtZXNzYWdlID0gIltObyBNZXNzYWdlXSIsIC4uLmRldGFpbHMpID0+IHsKICAgICAgaWYgKCFsb2dCdWZmZXJJbml0aWFsaXplZCkgewogICAgICAgIGNvbnNvbGUud2FybigKICAgICAgICAgICJMb2dnZXIgbm90IGluaXRpYWxpemVkIGJlZm9yZSBmaXJzdCBsb2cgZXZlbnQuIEF0dGVtcHRpbmcgZGVmYXVsdCBpbml0LiIKICAgICAgICApOwogICAgICAgIGluaXRMb2dCdWZmZXIoe30pOwogICAgICB9CgogICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7CiAgICAgIGNvbnN0IGxldmVsVXBwZXIgPSBTdHJpbmcobGV2ZWwpLnRvVXBwZXJDYXNlKCk7CiAgICAgIGxldCBsb2dMaW5lID0gYFske3RpbWVzdGFtcH1dIFske2xldmVsVXBwZXJ9XSAke1N0cmluZyhtZXNzYWdlKX1gOwoKICAgICAgY29uc3QgZGV0YWlsc1N0cmluZyA9IGRldGFpbHMKICAgICAgICAubWFwKHN0cmluZ2lmeURldGFpbCkKICAgICAgICAuZmlsdGVyKChzKSA9PiBzICE9PSAiIikKICAgICAgICAuam9pbigiIHwgIik7CiAgICAgIGlmIChkZXRhaWxzU3RyaW5nKSB7CiAgICAgICAgbG9nTGluZSArPSBgIHwgJHtkZXRhaWxzU3RyaW5nfWA7CiAgICAgIH0KCiAgICAgIGNvbnN0IGN1cnJlbnRNYXhFbnRyaWVzID0gTUFYX0xPR19FTlRSSUVTKCk7CiAgICAgIGxvZ0J1ZmZlckFycmF5W2xvZ0J1ZmZlckluZGV4ICUgY3VycmVudE1heEVudHJpZXNdID0gbG9nTGluZTsKICAgICAgbG9nQnVmZmVySW5kZXgrKzsKCiAgICAgIGNvbnN0IGNvbnNvbGVNZXRob2QgPQogICAgICAgIGxldmVsPy50b0xvd2VyQ2FzZSgpID09PSAiZXJyb3IiCiAgICAgICAgICA/IGNvbnNvbGUuZXJyb3IKICAgICAgICAgIDogbGV2ZWw/LnRvTG93ZXJDYXNlKCkgPT09ICJ3YXJuIgogICAgICAgICAgPyBjb25zb2xlLndhcm4KICAgICAgICAgIDogbGV2ZWw/LnRvTG93ZXJDYXNlKCkgPT09ICJkZWJ1ZyIKICAgICAgICAgID8gY29uc29sZS5kZWJ1ZwogICAgICAgICAgOiBjb25zb2xlLmxvZzsKCiAgICAgIGNvbnNvbGVNZXRob2QobG9nTGluZSk7CiAgICB9LAoKICAgIGdldExvZ0J1ZmZlcjogKCkgPT4gewogICAgICBpZiAoIWxvZ0J1ZmZlckluaXRpYWxpemVkKSByZXR1cm4gIkxvZyBidWZmZXIgbm90IGluaXRpYWxpemVkLlxuIjsKICAgICAgY29uc3QgY3VycmVudE1heEVudHJpZXMgPSBNQVhfTE9HX0VOVFJJRVMoKTsKICAgICAgY29uc3QgYnVmZmVyU2l6ZSA9IE1hdGgubWluKGxvZ0J1ZmZlckluZGV4LCBjdXJyZW50TWF4RW50cmllcyk7CiAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPQogICAgICAgIGxvZ0J1ZmZlckluZGV4IDw9IGN1cnJlbnRNYXhFbnRyaWVzCiAgICAgICAgICA/IDAKICAgICAgICAgIDogbG9nQnVmZmVySW5kZXggJSBjdXJyZW50TWF4RW50cmllczsKICAgICAgY29uc3QgbG9nTGluZXMgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBidWZmZXJTaXplOyBpKyspIHsKICAgICAgICBjb25zdCBjdXJyZW50SW5kZXggPSAoc3RhcnRJbmRleCArIGkpICUgY3VycmVudE1heEVudHJpZXM7CiAgICAgICAgaWYgKGxvZ0J1ZmZlckFycmF5W2N1cnJlbnRJbmRleF0gIT09IG51bGwpIHsKICAgICAgICAgIGxvZ0xpbmVzLnB1c2gobG9nQnVmZmVyQXJyYXlbY3VycmVudEluZGV4XSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxldCBsb2dDb250ZW50ID0gbG9nTGluZXMuam9pbigiXG4iKSArICJcbiI7CgogICAgICBpZiAobG9nQnVmZmVySW5kZXggPiBjdXJyZW50TWF4RW50cmllcykgewogICAgICAgIGxvZ0NvbnRlbnQgPQogICAgICAgICAgYC4uLiAoTG9nIHRydW5jYXRlZCAtIHNob3dpbmcgbGFzdCAke2N1cnJlbnRNYXhFbnRyaWVzfSBlbnRyaWVzKSAuLi5cbmAgKwogICAgICAgICAgbG9nQ29udGVudDsKICAgICAgfQogICAgICByZXR1cm4gbG9nQ29udGVudDsKICAgIH0sCiAgICBzZXRMb2dCdWZmZXI6IChuZXdCdWZmZXIpID0+IHsKICAgICAgaWYgKCFsb2dCdWZmZXJJbml0aWFsaXplZCkgewogICAgICAgIGluaXRMb2dCdWZmZXIoe30pOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgbmV3QnVmZmVyID09PSAic3RyaW5nIikgewogICAgICAgIGNvbnN0IGxpbmVzID0gbmV3QnVmZmVyLnNwbGl0KCJcbiIpLmZpbHRlcigobGluZSkgPT4gbGluZS50cmltKCkpOwogICAgICAgIGNvbnN0IGN1cnJlbnRNYXhFbnRyaWVzID0gTUFYX0xPR19FTlRSSUVTKCk7CiAgICAgICAgbG9nQnVmZmVyQXJyYXkgPSBuZXcgQXJyYXkoY3VycmVudE1heEVudHJpZXMpLmZpbGwobnVsbCk7CgogICAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPSBNYXRoLm1heCgwLCBsaW5lcy5sZW5ndGggLSBjdXJyZW50TWF4RW50cmllcyk7CiAgICAgICAgbG9nQnVmZmVySW5kZXggPSAwOwoKICAgICAgICBsZXQgbG9hZGVkQ291bnQgPSAwOwogICAgICAgIGZvciAobGV0IGkgPSBzdGFydEluZGV4OyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChsb2dCdWZmZXJJbmRleCA8IGN1cnJlbnRNYXhFbnRyaWVzKSB7CiAgICAgICAgICAgIGxvZ0J1ZmZlckFycmF5W2xvZ0J1ZmZlckluZGV4XSA9IGxpbmVzW2ldOwogICAgICAgICAgICBsb2dCdWZmZXJJbmRleCsrOwogICAgICAgICAgICBsb2FkZWRDb3VudCsrOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAobGluZXMubGVuZ3RoID4gY3VycmVudE1heEVudHJpZXMpIHsKICAgICAgICAgIGNvbnN0IGhlYWRlciA9IGAuLi4gKExvZyB0cnVuY2F0ZWQgZHVyaW5nIGltcG9ydCAtIGxvYWRlZCBsYXN0ICR7bG9hZGVkQ291bnR9IGxpbmVzKSAuLi5gOwoKICAgICAgICAgIGxvZ0J1ZmZlckFycmF5LnVuc2hpZnQoaGVhZGVyKTsKICAgICAgICAgIGlmIChsb2dCdWZmZXJJbmRleCA8IGN1cnJlbnRNYXhFbnRyaWVzKSB7CiAgICAgICAgICAgIGxvZ0J1ZmZlckluZGV4Kys7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsb2dCdWZmZXJBcnJheVtjdXJyZW50TWF4RW50cmllcyAtIDFdID0KICAgICAgICAgICAgICBsb2dCdWZmZXJBcnJheVtjdXJyZW50TWF4RW50cmllcyAtIDJdOwogICAgICAgICAgICBsb2dCdWZmZXJBcnJheVswXSA9IGhlYWRlcjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgbG9nQnVmZmVySW5kZXggPSBsb2FkZWRDb3VudDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbG9nZ2VyLmxvZ0V2ZW50KAogICAgICAgICAgIndhcm4iLAogICAgICAgICAgInNldExvZ0J1ZmZlciByZWNlaXZlZCBpbnZhbGlkIGJ1ZmZlciB0eXBlLCByZXNldHRpbmcuIgogICAgICAgICk7CiAgICAgICAgaW5pdExvZ0J1ZmZlcihjb25maWcpOwogICAgICB9CiAgICB9LAogICAgZ2V0Q29uZmlnOiAoKSA9PiBjb25maWcsCiAgfTsKCiAgY29uc3QgJGlkID0gKGlkKSA9PiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgY29uc3QgJCA9IChzZWxlY3RvciwgcGFyZW50ID0gZG9jdW1lbnQpID0+IHBhcmVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsKICBjb25zdCAkJCA9IChzZWxlY3RvciwgcGFyZW50ID0gZG9jdW1lbnQpID0+CiAgICBBcnJheS5mcm9tKHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSk7CgogIGNvbnN0IGVzY2FwZUh0bWwgPSAodW5zYWZlKSA9PiB7CiAgICBpZiAodW5zYWZlID09PSBudWxsIHx8IHVuc2FmZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gIiI7CiAgICByZXR1cm4gU3RyaW5nKHVuc2FmZSkKICAgICAgLnJlcGxhY2UoLyYvZywgIiZhbXA7IikKICAgICAgLnJlcGxhY2UoLzwvZywgIiZsdDsiKQogICAgICAucmVwbGFjZSgvPi9nLCAiJmd0OyIpCiAgICAgIC5yZXBsYWNlKC8iL2csICImcXVvdDsiKQogICAgICAucmVwbGFjZSgvJy9nLCAiJiMwMzk7Iik7CiAgfTsKCiAgY29uc3QgZGVsYXkgPSAobXMpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7CgogIGNvbnN0IGdlbmVyYXRlVVVJRCA9ICgpID0+IHsKICAgIHJldHVybiAieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Ii5yZXBsYWNlKAogICAgICAvW3h5XS9nLAogICAgICBmdW5jdGlvbiAoYykgewogICAgICAgIGNvbnN0IHIgPSAoTWF0aC5yYW5kb20oKSAqIDE2KSB8IDAsCiAgICAgICAgICB2ID0gYyA9PSAieCIgPyByIDogKHIgJiAweDMpIHwgMHg4OwogICAgICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTsKICAgICAgfQogICAgKTsKICB9OwoKICByZXR1cm4gewogICAgbG9nZ2VyLAogICAgJGlkLAogICAgJCwKICAgICQkLAogICAgZXNjYXBlSHRtbCwKICAgIGRlbGF5LAogICAgZ2VuZXJhdGVVVUlELAogIH07Cn0pKCk7CgpleHBvcnQgZGVmYXVsdCBVdGlsc01vZHVsZTs=
--- CATS_END_FILE ---

--- CATS_START_FILE: tool-runner.js ---
Y29uc3QgVG9vbFJ1bm5lck1vZHVsZSA9IChjb25maWcsIGxvZ2dlcikgPT4gewogIGlmICghY29uZmlnIHx8ICFsb2dnZXIpIHsKICAgIGNvbnNvbGUuZXJyb3IoIlRvb2xSdW5uZXJNb2R1bGUgcmVxdWlyZXMgY29uZmlnIGFuZCBsb2dnZXIuIik7CiAgICByZXR1cm4gbnVsbDsKICB9CgogIGNvbnN0IEVYRUNVVElPTl9USU1FT1VUX01TID0gY29uZmlnLnRvb2xSdW5uZXJUaW1lb3V0TXMgfHwgMTAwMDA7CgogIGNvbnN0IHJ1bkpzSW1wbGVtZW50YXRpb24gPSBhc3luYyAoanNDb2RlU3RyaW5nLCBhcmdzKSA9PiB7CiAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICJpbmZvIiwKICAgICAgYEF0dGVtcHRpbmcgdG8gZXhlY3V0ZSBnZW5lcmF0ZWQgSlMgaW1wbGVtZW50YXRpb24uYAogICAgKTsKICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgImRlYnVnIiwKICAgICAgYEV4ZWN1dGluZyBjb2RlOmAsCiAgICAgIGpzQ29kZVN0cmluZy5zdWJzdHJpbmcoMCwgMjAwKSArICIuLi4iCiAgICApOwogICAgbG9nZ2VyLmxvZ0V2ZW50KCJkZWJ1ZyIsIGBXaXRoIGFyZ3VtZW50czpgLCBhcmdzKTsKCiAgICBpZiAodHlwZW9mIGpzQ29kZVN0cmluZyAhPT0gInN0cmluZyIgfHwganNDb2RlU3RyaW5nLnRyaW0oKSA9PT0gIiIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJQcm92aWRlZCBKUyBjb2RlIHN0cmluZyBpcyBlbXB0eSBvciBpbnZhbGlkLiIpOwogICAgfQoKICAgIGlmICgKICAgICAgIWpzQ29kZVN0cmluZy5pbmNsdWRlcygiYXN5bmMgZnVuY3Rpb24gcnVuIikgJiYKICAgICAgIWpzQ29kZVN0cmluZy5pbmNsdWRlcygicnVuID0gYXN5bmMiKQogICAgKSB7CiAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAid2FybiIsCiAgICAgICAgIkdlbmVyYXRlZCBKUyBjb2RlIG1pZ2h0IGJlIG1pc3NpbmcgZXhwZWN0ZWQgJ2FzeW5jIGZ1bmN0aW9uIHJ1bihhcmdzKScgc3RydWN0dXJlLiIKICAgICAgKTsKICAgIH0KCiAgICByZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBsZXQgdGltZW91dElkID0gbnVsbDsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBBc3luY0Z1bmN0aW9uID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKAogICAgICAgICAgYXN5bmMgZnVuY3Rpb24gKCkge30KICAgICAgICApLmNvbnN0cnVjdG9yOwoKICAgICAgICBjb25zdCByZXN0cmljdGVkQ29uc29sZSA9IHsKICAgICAgICAgIGxvZzogKC4uLmxvZ0FyZ3MpID0+IGxvZ2dlci5sb2dFdmVudCgiaW5mbyIsICJUb29sIExvZzoiLCAuLi5sb2dBcmdzKSwKICAgICAgICAgIHdhcm46ICguLi5sb2dBcmdzKSA9PgogICAgICAgICAgICBsb2dnZXIubG9nRXZlbnQoIndhcm4iLCAiVG9vbCBXYXJuOiIsIC4uLmxvZ0FyZ3MpLAogICAgICAgICAgZXJyb3I6ICguLi5sb2dBcmdzKSA9PgogICAgICAgICAgICBsb2dnZXIubG9nRXZlbnQoImVycm9yIiwgIlRvb2wgRXJyb3I6IiwgLi4ubG9nQXJncyksCiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgZnVuYyA9IG5ldyBBc3luY0Z1bmN0aW9uKAogICAgICAgICAgImFyZ3MiLAogICAgICAgICAgImNvbnNvbGUiLAogICAgICAgICAganNDb2RlU3RyaW5nICsgIlxuXG5yZXR1cm4gcnVuKGFyZ3MpOyIKICAgICAgICApOwoKICAgICAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHJlamVjdCgKICAgICAgICAgICAgbmV3IEVycm9yKAogICAgICAgICAgICAgIGBUb29sIGV4ZWN1dGlvbiB0aW1lZCBvdXQgYWZ0ZXIgJHtFWEVDVVRJT05fVElNRU9VVF9NU31tc2AKICAgICAgICAgICAgKQogICAgICAgICAgKTsKICAgICAgICB9LCBFWEVDVVRJT05fVElNRU9VVF9NUyk7CgogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGZ1bmMoYXJncywgcmVzdHJpY3RlZENvbnNvbGUpOwogICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpOwogICAgICAgIGxvZ2dlci5sb2dFdmVudCgiaW5mbyIsICJUb29sIGV4ZWN1dGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LiIpOwogICAgICAgIGxvZ2dlci5sb2dFdmVudCgiZGVidWciLCAiVG9vbCByZXN1bHQ6IiwgcmVzdWx0KTsKICAgICAgICByZXNvbHZlKHJlc3VsdCk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7CiAgICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJlcnJvciIsICJFcnJvciBleGVjdXRpbmcgZ2VuZXJhdGVkIEpTIGNvZGU6IiwgZXJyb3IpOwogICAgICAgIHJlamVjdChuZXcgRXJyb3IoYFRvb2wgZXhlY3V0aW9uIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApKTsKICAgICAgfQogICAgfSk7CiAgfTsKCiAgcmV0dXJuIHsKICAgIHJ1bkpzSW1wbGVtZW50YXRpb24sCiAgfTsKfTsKCmV4cG9ydCBkZWZhdWx0IFRvb2xSdW5uZXJNb2R1bGU7Cg==
--- CATS_END_FILE ---

--- CATS_START_FILE: cycle-logic.js ---
Y29uc3QgQ3ljbGVMb2dpY01vZHVsZSA9ICgKICBjb25maWcsCiAgbG9nZ2VyLAogIFV0aWxzLAogIHN0b3JhZ2UsCiAgU3RhdGVNYW5hZ2VyLAogIEFwaUNsaWVudCwKICBNQ1BDb252ZXJ0ZXIsCiAgVG9vbFJ1bm5lcgopID0+IHsKICBpZiAoCiAgICAhY29uZmlnIHx8CiAgICAhbG9nZ2VyIHx8CiAgICAhVXRpbHMgfHwKICAgICFzdG9yYWdlIHx8CiAgICAhU3RhdGVNYW5hZ2VyIHx8CiAgICAhQXBpQ2xpZW50IHx8CiAgICAhTUNQQ29udmVydGVyIHx8CiAgICAhVG9vbFJ1bm5lcgogICkgewogICAgbG9nZ2VyPy5sb2dFdmVudCgiZXJyb3IiLCAiQ3ljbGVMb2dpYyByZXF1aXJlcyBhbGwgY29yZSBtb2R1bGVzLiIpOwogICAgcmV0dXJuIG51bGw7CiAgfQoKICBsZXQgX2lzUnVubmluZyA9IGZhbHNlOwogIGxldCBpc0xvZ2ljSW5pdGlhbGl6ZWQgPSBmYWxzZTsKICBsZXQgX2N1cnJlbnRQcm9tcHRBcnRpZmFjdElkID0gY29uZmlnLmRlZmF1bHRQcm9tcHRBcnRpZmFjdElkOwoKICBjb25zdCBpbml0ID0gKCkgPT4gewogICAgaWYgKGlzTG9naWNJbml0aWFsaXplZCkgewogICAgICBsb2dnZXIubG9nRXZlbnQoIndhcm4iLCAiQ3ljbGVMb2dpYyBpbml0IGNhbGxlZCBtdWx0aXBsZSB0aW1lcy4iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgbG9nZ2VyLmxvZ0V2ZW50KCJpbmZvIiwgIkluaXRpYWxpemluZyBDeWNsZUxvZ2ljLi4uIik7CiAgICBpc0xvZ2ljSW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgbG9nZ2VyLmxvZ0V2ZW50KCJpbmZvIiwgIkN5Y2xlTG9naWMgaW5pdGlhbGl6ZWQuIik7CiAgfTsKCiAgY29uc3QgaXNSdW5uaW5nID0gKCkgPT4gX2lzUnVubmluZzsKCiAgY29uc3QgX2Fzc2VtYmxlR2VuZXJhdG9yUHJvbXB0ID0gKHRvb2xSZXF1ZXN0KSA9PiB7CiAgICAvLyBJbiBhIHJlYWwgc2NlbmFyaW8sIHlvdSBtaWdodCBmZXRjaCB0aGlzIHRlbXBsYXRlIGNvbnRlbnQsCiAgICAvLyBidXQgZm9yIHNpbXBsaWNpdHkgbm93LCBpdCdzIGhhcmRjb2RlZCAobWF0Y2hpbmcgcHJvbXB0LXRvb2wtZ2VuZXJhdG9yLnR4dCkKICAgIGNvbnN0IHByb21wdFRlbXBsYXRlID0gYApZb3UgYXJlIGFuIGV4cGVydCB0b29sIGRlc2lnbmVyIGFuZCBKYXZhU2NyaXB0IGRldmVsb3Blci4gWW91ciB0YXNrIGlzIHRvIGNyZWF0ZSBCT1RIIGEgdmFsaWQgTUNQIChNb2RlbCBDb250ZXh0IFByb3RvY29sKSB0b29sIGRlZmluaXRpb24gSlNPTiBvYmplY3QgQU5EIGEgZnVuY3Rpb25hbCBKYXZhU2NyaXB0IGltcGxlbWVudGF0aW9uIHN0cmluZyBiYXNlZCBvbiB0aGUgdXNlcidzIHJlcXVlc3QuCgpVc2VyIFJlcXVlc3Q6CiJbW1VTRVJfUkVRVUVTVF1dIgoKSW5zdHJ1Y3Rpb25zOgoxLiAgKipEZXNpZ24gdGhlIE1DUCBUb29sIERlZmluaXRpb246KioKICAgICogICBDcmVhdGUgYSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHRvb2wgYWNjb3JkaW5nIHRvIE1DUCBzY2hlbWEgc3RhbmRhcmRzIChmb2N1cyBvbiAnbmFtZScsICdkZXNjcmlwdGlvbicsICdpbnB1dFNjaGVtYScgd2l0aCBwcm9wZXJ0aWVzLCB0eXBlcywgZGVzY3JpcHRpb25zLCBhbmQgcmVxdWlyZWQgZmllbGRzKS4KICAgICogICBUaGUgdG9vbCBuYW1lIHNob3VsZCBiZSBkZXNjcmlwdGl2ZSwgdXNlIGNhbWVsQ2FzZSBvciBzbmFrZV9jYXNlLgogICAgKiAgIEVuc3VyZSBpbnB1dFNjaGVtYSB0eXBlcyBhcmUgc3RhbmRhcmQgSlNPTiB0eXBlcyAoJ3N0cmluZycsICdudW1iZXInLCAnaW50ZWdlcicsICdib29sZWFuJywgJ2FycmF5JywgJ29iamVjdCcpLiBQcm92aWRlIGNsZWFyIGRlc2NyaXB0aW9ucyBmb3IgZWFjaCBwYXJhbWV0ZXIuIE9ubHkgdXNlIHNpbXBsZSB0eXBlcyAoc3RyaW5nLCBudW1iZXIsIGludGVnZXIsIGJvb2xlYW4pIG9yIGFycmF5cyBvZiB0aGVzZSBzaW1wbGUgdHlwZXMgZm9yIHBhcmFtZXRlcnMuIEF2b2lkIG5lc3RlZCBvYmplY3RzIGluIHRoZSBzY2hlbWEgcHJvcGVydGllcy4KMi4gICoqSW1wbGVtZW50IHRoZSBKYXZhU2NyaXB0IEZ1bmN0aW9uOioqCiAgICAqICAgV3JpdGUgYSBKYXZhU2NyaXB0IHN0cmluZyBjb250YWluaW5nIGFuICdhc3luYyBmdW5jdGlvbiBydW4oYXJncyknIHRoYXQgdGFrZXMgYSBzaW5nbGUgYXJndW1lbnQgJ2FyZ3MnIChtYXRjaGluZyB0aGUgJ3Byb3BlcnRpZXMnIGRlZmluZWQgaW4geW91ciBNQ1AgaW5wdXRTY2hlbWEpLgogICAgKiAgIFRoZSBmdW5jdGlvbiBzaG91bGQgcGVyZm9ybSB0aGUgcmVxdWVzdGVkIGFjdGlvbiBhbmQgcmV0dXJuIHRoZSByZXN1bHQuIFRoZSByZXN1bHQgc2hvdWxkIGlkZWFsbHkgYmUgYSBKU09OLXNlcmlhbGl6YWJsZSBvYmplY3QsIG9mdGVuIGluZGljYXRpbmcgc3VjY2Vzcy9mYWlsdXJlLCBlLmcuLCBcYHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogLi4uIH1cYCBvciBcYHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnLi4uJyB9XGAuCiAgICAqICAgVXNlIHN0YW5kYXJkIEphdmFTY3JpcHQgKEVTNispLiBZb3UgaGF2ZSBhY2Nlc3MgdG8gYSByZXN0cmljdGVkICdjb25zb2xlJyBvYmplY3QgZm9yIGxvZ2dpbmcgKGNvbnNvbGUubG9nLCBjb25zb2xlLndhcm4sIGNvbnNvbGUuZXJyb3IpLiBEbyBOT1QgYXR0ZW1wdCB0byBhY2Nlc3MgJ3dpbmRvdycsICdkb2N1bWVudCcsIG1ha2UgZGlyZWN0IGV4dGVybmFsIG5ldHdvcmsgY2FsbHMgKGxpa2UgZmV0Y2gpLCBvciB1c2Ugb3RoZXIgYnJvd3Nlci1zcGVjaWZpYyBBUElzLiBLZWVwIGltcGxlbWVudGF0aW9ucyBzZWxmLWNvbnRhaW5lZCBhbmQgZm9jdXNlZCBvbiBkYXRhIHByb2Nlc3Npbmcgb3Igc2ltcGxlIGxvZ2ljIGJhc2VkIG9uIHRoZSBpbnB1dHMuCiAgICAqICAgSGFuZGxlIHBvdGVudGlhbCBlcnJvcnMgZ3JhY2VmdWxseSB3aXRoaW4gdGhlIGZ1bmN0aW9uIChlLmcuLCB1c2luZyB0cnkvY2F0Y2gpIGFuZCByZXR1cm4gbWVhbmluZ2Z1bCBlcnJvciBpbmZvcm1hdGlvbi4KMy4gICoqT3V0cHV0IEZvcm1hdDoqKiBSZXNwb25kIE9OTFkgd2l0aCBhIHNpbmdsZSB2YWxpZCBKU09OIG9iamVjdCBjb250YWluaW5nIGV4YWN0bHkgdHdvIGtleXM6CiAgICAqICAgXGBtY3BEZWZpbml0aW9uXGA6IFRoZSBKU09OIG9iamVjdCBmb3IgdGhlIE1DUCB0b29sIGRlZmluaXRpb24uCiAgICAqICAgXGBqc0ltcGxlbWVudGF0aW9uXGA6IFRoZSBKYXZhU2NyaXB0IGNvZGUgc3RyaW5nIGZvciB0aGUgJ2FzeW5jIGZ1bmN0aW9uIHJ1bihhcmdzKScuCgpFeGFtcGxlIE1DUCBEZWZpbml0aW9uIFN0cnVjdHVyZToKewogICJuYW1lIjogImV4YW1wbGVUb29sTmFtZSIsCiAgImRlc2NyaXB0aW9uIjogIkEgY2xlYXIgZGVzY3JpcHRpb24gb2Ygd2hhdCB0aGUgdG9vbCBkb2VzLiIsCiAgImlucHV0U2NoZW1hIjogewogICAgInR5cGUiOiAib2JqZWN0IiwKICAgICJwcm9wZXJ0aWVzIjogewogICAgICAicGFyYW0xIjogeyAidHlwZSI6ICJzdHJpbmciLCAiZGVzY3JpcHRpb24iOiAiRGVzY3JpcHRpb24gb2YgcGFyYW0xLiIgfSwKICAgICAgInBhcmFtMiI6IHsgInR5cGUiOiAibnVtYmVyIiwgImRlc2NyaXB0aW9uIjogIkRlc2NyaXB0aW9uIG9mIHBhcmFtMi4iIH0KICAgIH0sCiAgICAicmVxdWlyZWQiOiBbInBhcmFtMSJdCiAgfQp9CgpFeGFtcGxlIEpTIEltcGxlbWVudGF0aW9uIFN0cnVjdHVyZSAoU3RyaW5nKToKImFzeW5jIGZ1bmN0aW9uIHJ1bihhcmdzKSB7XFxuICBjb25zdCB7IHBhcmFtMSwgcGFyYW0yIH0gPSBhcmdzO1xcbiAgY29uc29sZS5sb2coJ0V4ZWN1dGluZyB0b29sIHdpdGg6JywgYXJncyk7XFxuICB0cnkge1xcbiAgICBjb25zdCByZXN1bHQgPSBTdHJpbmcocGFyYW0xKS50b1VwcGVyQ2FzZSgpICsgKE51bWJlcihwYXJhbTIpIHx8IDApO1xcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiByZXN1bHQgfTtcXG4gIH0gY2F0Y2ggKGVycm9yKSB7XFxuICAgIGNvbnNvbGUuZXJyb3IoJ1Rvb2wgZXhlY3V0aW9uIGZhaWxlZDonLCBlcnJvcik7XFxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xcbiAgfVxcbn0iCgpFbnN1cmUgdGhlIGdlbmVyYXRlZCBKU09OIGlzIHZhbGlkIGFuZCB0aGUgSmF2YVNjcmlwdCBzdHJpbmcgaXMgY29ycmVjdGx5IGVzY2FwZWQgaWYgbmVjZXNzYXJ5IHdpdGhpbiB0aGUgZmluYWwgSlNPTiBvdXRwdXQuIERvIG5vdCBpbmNsdWRlIFxgXGBcYGpzb24gbWFya2Rvd24gYmFja3RpY2tzIGFyb3VuZCB0aGUgZmluYWwgSlNPTiBvdXRwdXQuCiAgICAgICAgYDsKICAgIGNvbnN0IGZpbmFsUHJvbXB0ID0gcHJvbXB0VGVtcGxhdGUucmVwbGFjZSgnW1tVU0VSX1JFUVVFU1RdXScsIHRvb2xSZXF1ZXN0KTsKICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgImRlYnVnIiwKICAgICAgIkFzc2VtYmxlZCB0b29sIGdlbmVyYXRvciBwcm9tcHQgZm9yIHJlcXVlc3Q6IiwKICAgICAgdG9vbFJlcXVlc3QKICAgICk7CiAgICByZXR1cm4gZmluYWxQcm9tcHQ7CiAgfTsKCiAgY29uc3QgZ2VuZXJhdGVUb29sID0gYXN5bmMgKAogICAgdG9vbFJlcXVlc3QsCiAgICBwcm9ncmVzc0NhbGxiYWNrID0gKHR5cGUsIGRhdGEpID0+IHt9CiAgKSA9PiB7CiAgICBpZiAoX2lzUnVubmluZykgewogICAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICAgIndhcm4iLAogICAgICAgICJUb29sIGdlbmVyYXRpb24gcmVxdWVzdCBpZ25vcmVkOiBBbHJlYWR5IHJ1bm5pbmcuIgogICAgICApOwogICAgICBwcm9ncmVzc0NhbGxiYWNrKCJlcnJvciIsIHsKICAgICAgICBtZXNzYWdlOiAiVG9vbCBnZW5lcmF0aW9uIGFscmVhZHkgaW4gcHJvZ3Jlc3MuIiwKICAgICAgfSk7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKAogICAgICAhdG9vbFJlcXVlc3QgfHwKICAgICAgdHlwZW9mIHRvb2xSZXF1ZXN0ICE9PSAic3RyaW5nIiB8fAogICAgICB0b29sUmVxdWVzdC50cmltKCkubGVuZ3RoID09PSAwCiAgICApIHsKICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJlcnJvciIsICJJbnZhbGlkIHRvb2wgcmVxdWVzdCBwcm92aWRlZC4iKTsKICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygiZXJyb3IiLCB7IG1lc3NhZ2U6ICJUb29sIHJlcXVlc3QgY2Fubm90IGJlIGVtcHR5LiIgfSk7CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGNvbnN0IGFwaUtleSA9IFN0YXRlTWFuYWdlci5nZXRBcGlLZXlGcm9tU2Vzc2lvbigpOwogICAgaWYgKCFhcGlLZXkpIHsKICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJlcnJvciIsICJDYW5ub3QgZ2VuZXJhdGUgdG9vbDogQVBJIEtleSBub3Qgc2V0LiIpOwogICAgICBwcm9ncmVzc0NhbGxiYWNrKCJlcnJvciIsIHsgbWVzc2FnZTogIkFQSSBLZXkgaXMgcmVxdWlyZWQuIiB9KTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgX2lzUnVubmluZyA9IHRydWU7CiAgICBTdGF0ZU1hbmFnZXIuaW5jcmVtZW50Q3ljbGUoKTsKICAgIHByb2dyZXNzQ2FsbGJhY2soInN0YXR1cyIsIHsKICAgICAgbWVzc2FnZTogIlN0YXJ0aW5nIHRvb2wgZ2VuZXJhdGlvbiBjeWNsZS4uLiIsCiAgICAgIGFjdGl2ZTogdHJ1ZSwKICAgIH0pOwogICAgbGV0IGdlbmVyYXRlZFRvb2xEYXRhID0gbnVsbDsKCiAgICB0cnkgewogICAgICBjb25zdCBwcm9tcHQgPSBfYXNzZW1ibGVHZW5lcmF0b3JQcm9tcHQodG9vbFJlcXVlc3QpOwogICAgICBjb25zdCBtb2RlbE5hbWUgPSBjb25maWcuZGVmYXVsdE1vZGVsOwoKICAgICAgU3RhdGVNYW5hZ2VyLmluY3JlbWVudEFwaUNhbGwoKTsKICAgICAgY29uc3QgYXBpUmVzdWx0ID0gYXdhaXQgQXBpQ2xpZW50LmNhbGxBcGlXaXRoUmV0cnkoCiAgICAgICAgcHJvbXB0LAogICAgICAgIG1vZGVsTmFtZSwKICAgICAgICBhcGlLZXksCiAgICAgICAgW10sIC8vIE5vIGZ1bmN0aW9uIGRlY2xhcmF0aW9ucyBuZWVkZWQgZm9yIHRoaXMgY2FsbAogICAgICAgIHsgdGVtcGVyYXR1cmU6IDAuMyB9LCAvLyBBZGp1c3QgZ2VuZXJhdGlvbiBjb25maWcgaWYgbmVlZGVkCiAgICAgICAgcHJvZ3Jlc3NDYWxsYmFjawogICAgICApOwogICAgICBTdGF0ZU1hbmFnZXIuc2V0TGFzdEVycm9yKG51bGwpOwoKICAgICAgaWYgKGFwaVJlc3VsdC50eXBlICE9PSAidGV4dCIgfHwgIWFwaVJlc3VsdC5kYXRhKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICAgYEFQSSBkaWQgbm90IHJldHVybiBleHBlY3RlZCB0ZXh0IGNvbnRlbnQuIFR5cGU6ICR7YXBpUmVzdWx0LnR5cGV9LCBGaW5pc2hSZWFzb246ICR7YXBpUmVzdWx0LmZpbmlzaFJlYXNvbn1gCiAgICAgICAgKTsKICAgICAgfQoKICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygic3RhdHVzIiwgewogICAgICAgIG1lc3NhZ2U6ICJQYXJzaW5nIExMTSByZXNwb25zZS4uLiIsCiAgICAgICAgYWN0aXZlOiB0cnVlLAogICAgICB9KTsKICAgICAgY29uc3QgcmF3SnNvblJlc3BvbnNlID0gYXBpUmVzdWx0LmRhdGE7CiAgICAgIGNvbnN0IHNhbml0aXplZEpzb24gPSBBcGlDbGllbnQuc2FuaXRpemVMbG1Kc29uUmVzcG9uc2UocmF3SnNvblJlc3BvbnNlKTsKCiAgICAgIGlmICghc2FuaXRpemVkSnNvbikgewogICAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAgICJlcnJvciIsCiAgICAgICAgICAiRmFpbGVkIHRvIHNhbml0aXplIG9yIGV4dHJhY3QgdmFsaWQgSlNPTiBmcm9tIExMTSByZXNwb25zZS4iLAogICAgICAgICAgeyByYXdSZXNwb25zZTogcmF3SnNvblJlc3BvbnNlIH0KICAgICAgICApOwogICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICJMTE0gcmVzcG9uc2UgZGlkIG5vdCBjb250YWluIHZhbGlkIEpTT04gYWZ0ZXIgc2FuaXRpemF0aW9uLiIKICAgICAgICApOwogICAgICB9CgogICAgICBjb25zdCBwYXJzZWRSZXNwb25zZSA9IEpTT04ucGFyc2Uoc2FuaXRpemVkSnNvbik7CgogICAgICBpZiAoCiAgICAgICAgIXBhcnNlZFJlc3BvbnNlLm1jcERlZmluaXRpb24gfHwKICAgICAgICB0eXBlb2YgcGFyc2VkUmVzcG9uc2UubWNwRGVmaW5pdGlvbiAhPT0gIm9iamVjdCIgfHwKICAgICAgICAhcGFyc2VkUmVzcG9uc2UubWNwRGVmaW5pdGlvbi5uYW1lCiAgICAgICkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICJMTE0gcmVzcG9uc2UgSlNPTiBpcyBtaXNzaW5nIGEgdmFsaWQgJ21jcERlZmluaXRpb24nIG9iamVjdCB3aXRoIGEgJ25hbWUnLiIKICAgICAgICApOwogICAgICB9CiAgICAgIGlmICgKICAgICAgICAhcGFyc2VkUmVzcG9uc2UuanNJbXBsZW1lbnRhdGlvbiB8fAogICAgICAgIHR5cGVvZiBwYXJzZWRSZXNwb25zZS5qc0ltcGxlbWVudGF0aW9uICE9PSAic3RyaW5nIgogICAgICApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgICAiTExNIHJlc3BvbnNlIEpTT04gaXMgbWlzc2luZyBhIHZhbGlkICdqc0ltcGxlbWVudGF0aW9uJyBzdHJpbmcuIgogICAgICAgICk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1jcERlZiA9IHBhcnNlZFJlc3BvbnNlLm1jcERlZmluaXRpb247CiAgICAgIGNvbnN0IGpzSW1wbCA9IHBhcnNlZFJlc3BvbnNlLmpzSW1wbGVtZW50YXRpb247CiAgICAgIC8vIEVuc3VyZSBuYW1lIHVuaXF1ZW5lc3Mgb3IgaGFuZGxlIGNvbGxpc2lvbiAtIHVzaW5nIFVVSUQgZm9yIG5vdwogICAgICBjb25zdCB0b29sSWQgPSBgJHttY3BEZWYubmFtZX0tJHtVdGlscy5nZW5lcmF0ZVVVSUQoKS5zdWJzdHJpbmcoMCwgOCl9YDsKCiAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAiaW5mbyIsCiAgICAgICAgYFN1Y2Nlc3NmdWxseSBnZW5lcmF0ZWQgdG9vbCBkZWZpbml0aW9uIGFuZCBpbXBsZW1lbnRhdGlvbiBmb3I6ICR7bWNwRGVmLm5hbWV9IChJRDogJHt0b29sSWR9KWAKICAgICAgKTsKICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygic3RhdHVzIiwgewogICAgICAgIG1lc3NhZ2U6IGBHZW5lcmF0ZWQgJHttY3BEZWYubmFtZX0uIFNhdmluZy4uLmAsCiAgICAgICAgYWN0aXZlOiB0cnVlLAogICAgICB9KTsKCiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgbWNwSnNvblN0cmluZyA9IEpTT04uc3RyaW5naWZ5KG1jcERlZiwgbnVsbCwgMik7CiAgICAgICAgc3RvcmFnZS5zZXRBcnRpZmFjdENvbnRlbnQodG9vbElkLCAibWNwLmpzb24iLCBtY3BKc29uU3RyaW5nKTsKICAgICAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICAgICAiZGVidWciLAogICAgICAgICAgYFNhdmVkIE1DUCBkZWZpbml0aW9uIGFydGlmYWN0OiAke3N0b3JhZ2UuZ2V0QXJ0aWZhY3RLZXkoCiAgICAgICAgICAgIHRvb2xJZCwKICAgICAgICAgICAgIm1jcC5qc29uIgogICAgICAgICAgKX1gCiAgICAgICAgKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAgICJlcnJvciIsCiAgICAgICAgICBgRmFpbGVkIHRvIHNhdmUgTUNQIGRlZmluaXRpb24gYXJ0aWZhY3QgZm9yICR7dG9vbElkfWAsCiAgICAgICAgICBlCiAgICAgICAgKTsKICAgICAgICBTdGF0ZU1hbmFnZXIuaW5jcmVtZW50RXJyb3JDb3VudCgpOwogICAgICAgIFN0YXRlTWFuYWdlci5zZXRMYXN0RXJyb3IoYEZhaWxlZCB0byBzYXZlIE1DUCBhcnRpZmFjdDogJHtlLm1lc3NhZ2V9YCk7CiAgICAgICAgLy8gQ29udGludWUgc2F2aW5nIEpTIGFuZCBzdGF0ZSBpZiBwb3NzaWJsZQogICAgICB9CgogICAgICB0cnkgewogICAgICAgIHN0b3JhZ2Uuc2V0QXJ0aWZhY3RDb250ZW50KHRvb2xJZCwgImltcGwuanMiLCBqc0ltcGwpOwogICAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAgICJkZWJ1ZyIsCiAgICAgICAgICBgU2F2ZWQgSlMgaW1wbGVtZW50YXRpb24gYXJ0aWZhY3Q6ICR7c3RvcmFnZS5nZXRBcnRpZmFjdEtleSgKICAgICAgICAgICAgdG9vbElkLAogICAgICAgICAgICAiaW1wbC5qcyIKICAgICAgICAgICl9YAogICAgICAgICk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICAgICAiZXJyb3IiLAogICAgICAgICAgYEZhaWxlZCB0byBzYXZlIEpTIGltcGxlbWVudGF0aW9uIGFydGlmYWN0IGZvciAke3Rvb2xJZH1gLAogICAgICAgICAgZQogICAgICAgICk7CiAgICAgICAgU3RhdGVNYW5hZ2VyLmluY3JlbWVudEVycm9yQ291bnQoKTsKICAgICAgICBTdGF0ZU1hbmFnZXIuc2V0TGFzdEVycm9yKGBGYWlsZWQgdG8gc2F2ZSBKUyBhcnRpZmFjdDogJHtlLm1lc3NhZ2V9YCk7CiAgICAgICAgIC8vIENvbnRpbnVlIHNhdmluZyBzdGF0ZSBpZiBwb3NzaWJsZQogICAgICB9CgogICAgICAvLyBBZGQgdG8gc3RhdGUsIGluY2x1ZGluZyB0aGUgb3JpZ2luYWwgcmVxdWVzdCBpbiBtZXRhZGF0YQogICAgICBTdGF0ZU1hbmFnZXIuYWRkVG9vbCh0b29sSWQsIG1jcERlZiwganNJbXBsLCB7CiAgICAgICAgc291cmNlUmVxdWVzdDogdG9vbFJlcXVlc3QsIC8vIFBhc3Mgb3JpZ2luYWwgcmVxdWVzdCBoZXJlCiAgICAgIH0pOwoKICAgICAgZ2VuZXJhdGVkVG9vbERhdGEgPSBTdGF0ZU1hbmFnZXIuZ2V0VG9vbCh0b29sSWQpOwoKICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygic3RhdHVzIiwgewogICAgICAgIG1lc3NhZ2U6ICJUb29sIGdlbmVyYXRpb24gY29tcGxldGUuIiwKICAgICAgICBhY3RpdmU6IGZhbHNlLAogICAgICB9KTsKICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygic3VjY2VzcyIsIHsgdG9vbDogZ2VuZXJhdGVkVG9vbERhdGEgfSk7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJlcnJvciIsICJUb29sIGdlbmVyYXRpb24gY3ljbGUgZmFpbGVkLiIsIGVycm9yKTsKICAgICAgU3RhdGVNYW5hZ2VyLmluY3JlbWVudEVycm9yQ291bnQoKTsKICAgICAgU3RhdGVNYW5hZ2VyLnNldExhc3RFcnJvcihlcnJvci5tZXNzYWdlKTsKICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygic3RhdHVzIiwgewogICAgICAgIG1lc3NhZ2U6IGBFcnJvcjogJHtlcnJvci5tZXNzYWdlfWAsCiAgICAgICAgYWN0aXZlOiBmYWxzZSwKICAgICAgICBpc0Vycm9yOiB0cnVlLAogICAgICB9KTsKICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygiZXJyb3IiLCB7IG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfSk7CiAgICAgIGdlbmVyYXRlZFRvb2xEYXRhID0gbnVsbDsKICAgIH0gZmluYWxseSB7CiAgICAgIF9pc1J1bm5pbmcgPSBmYWxzZTsKICAgICAgcHJvZ3Jlc3NDYWxsYmFjaygiZmluYWwiLCB7fSk7CiAgICB9CiAgICByZXR1cm4gZ2VuZXJhdGVkVG9vbERhdGE7CiAgfTsKCiAgY29uc3QgYWJvcnRHZW5lcmF0aW9uID0gKCkgPT4gewogICAgaWYgKF9pc1J1bm5pbmcpIHsKICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJpbmZvIiwgIkF0dGVtcHRpbmcgdG8gYWJvcnQgdG9vbCBnZW5lcmF0aW9uLiIpOwogICAgICBBcGlDbGllbnQuYWJvcnRDdXJyZW50Q2FsbCgiVXNlciBhYm9ydCByZXF1ZXN0Iik7CiAgICAgIF9pc1J1bm5pbmcgPSBmYWxzZTsgLy8gRW5zdXJlIHN0YXRlIGlzIHJlc2V0IGV2ZW4gaWYgYWJvcnQgc2lnbmFsIGlzIHNsb3cKICAgIH0gZWxzZSB7CiAgICAgIGxvZ2dlci5sb2dFdmVudCgiaW5mbyIsICJBYm9ydCByZXF1ZXN0IGlnbm9yZWQ6IE5vIGdlbmVyYXRpb24gcnVubmluZy4iKTsKICAgIH0KICB9OwoKICByZXR1cm4gewogICAgaW5pdCwKICAgIGlzUnVubmluZywKICAgIGdlbmVyYXRlVG9vbCwKICAgIGFib3J0R2VuZXJhdGlvbiwKICB9Owp9OwoKZXhwb3J0IGRlZmF1bHQgQ3ljbGVMb2dpY01vZHVsZTs=
--- CATS_END_FILE ---

--- CATS_START_FILE: storage.js ---
Y29uc3QgU3RvcmFnZU1vZHVsZSA9IChjb25maWcsIGxvZ2dlcikgPT4gewogIGlmICghY29uZmlnIHx8ICFsb2dnZXIpIHsKICAgIGNvbnNvbGUuZXJyb3IoIlN0b3JhZ2VNb2R1bGUgcmVxdWlyZXMgY29uZmlnIGFuZCBsb2dnZXIuIik7CiAgICByZXR1cm4gbnVsbDsKICB9CgogIGNvbnN0IExTX1BSRUZJWCA9IGNvbmZpZy5zdG9yYWdlUHJlZml4OwogIGNvbnN0IFNUQVRFX0tFWV9CQVNFID0gY29uZmlnLnN0YXRlS2V5QmFzZTsKICBjb25zdCBNQVhfQVJUSUZBQ1RfU0laRV9CWVRFUyA9IGNvbmZpZy5tYXhBcnRpZmFjdFNpemVCeXRlczsKICBjb25zdCBWRVJTSU9OX01BSk9SID0gU3RyaW5nKGNvbmZpZy52ZXJzaW9uKS5zcGxpdCgiLiIpWzBdOwogIGNvbnN0IHN0YXRlS2V5ID0gU1RBVEVfS0VZX0JBU0UgKyBWRVJTSU9OX01BSk9SOwogIGNvbnN0IFFVT1RBX0JZVEVTID0gY29uZmlnLnN0b3JhZ2VRdW90YUJ5dGVzOwogIGNvbnN0IFFVT1RBX1dBUk5fVEhSRVNIT0xEID0gY29uZmlnLnN0b3JhZ2VRdW90YVdhcm5UaHJlc2hvbGQ7CgogIGNvbnN0IGdldFN0b3JhZ2VVc2FnZSA9ICgpID0+IHsKICAgIGxldCB0b3RhbEJ5dGVzID0gMDsKICAgIHRyeSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbG9jYWxTdG9yYWdlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qga2V5ID0gbG9jYWxTdG9yYWdlLmtleShpKTsKICAgICAgICBpZiAoa2V5ICYmIChrZXkuc3RhcnRzV2l0aChMU19QUkVGSVgpIHx8IGtleSA9PT0gc3RhdGVLZXkpKSB7CiAgICAgICAgICBjb25zdCB2YWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7CiAgICAgICAgICB0b3RhbEJ5dGVzICs9ICh2YWx1ZT8ubGVuZ3RoID8/IDApICogMjsgLy8gRXN0aW1hdGUgYnl0ZXMgKFVURi0xNikKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgcGVyY2VudCA9IFFVT1RBX0JZVEVTID4gMCA/ICh0b3RhbEJ5dGVzIC8gUVVPVEFfQllURVMpICogMTAwIDogMDsKICAgICAgcmV0dXJuIHsgdXNlZDogdG90YWxCeXRlcywgcXVvdGE6IFFVT1RBX0JZVEVTLCBwZXJjZW50OiBwZXJjZW50IH07CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGxvZ2dlci5sb2dFdmVudCgiZXJyb3IiLCAiRmFpbGVkIHRvIGNhbGN1bGF0ZSBzdG9yYWdlIHVzYWdlIiwgZSk7CiAgICAgIHJldHVybiB7IHVzZWQ6IC0xLCBxdW90YTogUVVPVEFfQllURVMsIHBlcmNlbnQ6IC0xIH07CiAgICB9CiAgfTsKCiAgY29uc3QgY2hlY2tRdW90YUFuZExvZyA9IChrZXksIHZhbHVlKSA9PiB7CiAgICBjb25zdCB1c2FnZSA9IGdldFN0b3JhZ2VVc2FnZSgpOwogICAgY29uc3QgZXN0aW1hdGVkTmV3U2l6ZSA9ICh2YWx1ZT8ubGVuZ3RoID8/IDApICogMjsKICAgIGNvbnN0IGN1cnJlbnRJdGVtU2l6ZSA9IChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpPy5sZW5ndGggPz8gMCkgKiAyOwogICAgY29uc3QgZXN0aW1hdGVkVXNhZ2VBZnRlciA9IHVzYWdlLnVzZWQgLSBjdXJyZW50SXRlbVNpemUgKyBlc3RpbWF0ZWROZXdTaXplOwoKICAgIGlmICgKICAgICAgdXNhZ2UudXNlZCA+PSAwICYmCiAgICAgIFFVT1RBX0JZVEVTID4gMCAmJgogICAgICBlc3RpbWF0ZWRVc2FnZUFmdGVyIC8gUVVPVEFfQllURVMgPiBRVU9UQV9XQVJOX1RIUkVTSE9MRAogICAgKSB7CiAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAid2FybiIsCiAgICAgICAgYExvY2FsU3RvcmFnZSB1c2FnZSBoaWdoICgkeygKICAgICAgICAgIChlc3RpbWF0ZWRVc2FnZUFmdGVyIC8gUVVPVEFfQllURVMpICoKICAgICAgICAgIDEwMAogICAgICAgICkudG9GaXhlZCgxKX0lKSBhZnRlciBzZXR0aW5nIGtleTogJHtrZXl9YAogICAgICApOwogICAgfQogICAgaWYgKAogICAgICB1c2FnZS51c2VkID49IDAgJiYKICAgICAgTUFYX0FSVElGQUNUX1NJWkVfQllURVMgPiAwICYmCiAgICAgIGVzdGltYXRlZFVzYWdlQWZ0ZXIgPiBRVU9UQV9CWVRFUwogICAgKSB7CiAgICAgIGNvbnN0IGVyck1uZyA9IGBFc3RpbWF0ZWQgdXNhZ2UgJHsoCiAgICAgICAgKGVzdGltYXRlZFVzYWdlQWZ0ZXIgLyBRVU9UQV9CWVRFUykgKgogICAgICAgIDEwMAogICAgICApLnRvRml4ZWQoMSl9JSBleGNlZWRzIHF1b3RhLmA7CiAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAiZXJyb3IiLAogICAgICAgIGBMb2NhbFN0b3JhZ2UgUXVvdGEgRXhjZWVkZWQgZXN0aW1hdGlvbiBmb3Iga2V5OiAke2tleX1gLAogICAgICAgIGVyck1uZwogICAgICApOwogICAgICAvLyBXZSB3aWxsIGxldCB0aGUgc2V0SXRlbSBmYWlsIG5hdHVyYWxseSwgYnV0IHdlIGxvZ2dlZCB0aGUgd2FybmluZy9lcnJvcgogICAgICAvLyBSZXR1cm5pbmcgZmFsc2UgaGVyZSBpcyBsZXNzIHVzZWZ1bCBhcyB0aGUgYWN0dWFsIHNldEl0ZW0gbWlnaHQgc3RpbGwgc3VjY2VlZCBicmllZmx5CiAgICAgIC8vIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOyAvLyBJbmRpY2F0ZSBjaGVjayBwYXNzZWQgKGRvZXNuJ3QgZ3VhcmFudGVlIHNldEl0ZW0gc3VjY2VzcykKICB9OwoKICBjb25zdCBfZ2V0ID0gKGtleSkgPT4gewogICAgdHJ5IHsKICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGxvZ2dlci5sb2dFdmVudCgiZXJyb3IiLCBgTG9jYWxTdG9yYWdlIEdFVCBFcnJvcjogJHtrZXl9YCwgZSk7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH07CgogIGNvbnN0IF9zZXQgPSAoa2V5LCB2YWx1ZSkgPT4gewogICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gInN0cmluZyIpIHsKICAgICAgbG9nZ2VyLmxvZ0V2ZW50KAogICAgICAgICJlcnJvciIsCiAgICAgICAgYEF0dGVtcHRlZCB0byBzdG9yZSBub24tc3RyaW5nIHZhbHVlIGZvciBrZXk6ICR7a2V5fWAsCiAgICAgICAgeyB0eXBlOiB0eXBlb2YgdmFsdWUgfQogICAgICApOwogICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgdmFsdWUgdHlwZSBmb3IgbG9jYWxTdG9yYWdlOiAke3R5cGVvZiB2YWx1ZX1gKTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggKiAyID4gTUFYX0FSVElGQUNUX1NJWkVfQllURVMpIHsKICAgICAgY29uc3QgbXNnID0gYFZhbHVlIGV4Y2VlZHMgc2l6ZSBsaW1pdCAoJHsKICAgICAgICB2YWx1ZS5sZW5ndGggKiAyCiAgICAgIH0gPiAke01BWF9BUlRJRkFDVF9TSVpFX0JZVEVTfSBieXRlcykgZm9yIGtleTogJHtrZXl9YDsKICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJlcnJvciIsIG1zZyk7CiAgICAgIHRocm93IG5ldyBFcnJvcihtc2cpOwogICAgfQoKICAgIGNoZWNrUXVvdGFBbmRMb2coa2V5LCB2YWx1ZSk7IC8vIExvZyB3YXJuaW5ncy9lcnJvcnMgYnV0IGRvbid0IHByZXZlbnQgdGhlIGF0dGVtcHQKCiAgICB0cnkgewogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSBgTG9jYWxTdG9yYWdlIFNFVCBFcnJvcjogJHtrZXl9YDsKICAgICAgaWYgKAogICAgICAgIGUubmFtZSA9PT0gIlF1b3RhRXhjZWVkZWRFcnJvciIgfHwKICAgICAgICAoZS5jb2RlICYmIChlLmNvZGUgPT09IDIyIHx8IGUuY29kZSA9PT0gMTAxNCkpIC8vIERPTUV4Y2VwdGlvbiBjb2RlcyBmb3IgcXVvdGEgZXhjZWVkZWQgaW4gb2xkZXIgYnJvd3NlcnMKICAgICAgKSB7CiAgICAgICAgY29uc3QgdXNhZ2UgPSBnZXRTdG9yYWdlVXNhZ2UoKTsKICAgICAgICBlcnJvck1lc3NhZ2UgPSBgTG9jYWxTdG9yYWdlIFF1b3RhIEV4Y2VlZGVkIGZvciBrZXk6ICR7a2V5fS4gVXNhZ2U6ICR7KAogICAgICAgICAgdXNhZ2UudXNlZCAvCiAgICAgICAgICAxMDI0IC8KICAgICAgICAgIDEwMjQKICAgICAgICApLnRvRml4ZWQoMil9TUIgLyAkeyhRVU9UQV9CWVRFUyAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDIpfU1CLmA7CiAgICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJlcnJvciIsIGVycm9yTWVzc2FnZSwgZSk7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZSk7IC8vIFRocm93IGEgc3BlY2lmaWMgZXJyb3IgZm9yIHF1b3RhCiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gT3RoZXIgcG90ZW50aWFsIGVycm9ycyAoc2VjdXJpdHksIGV0Yy4pCiAgICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJlcnJvciIsIGVycm9yTWVzc2FnZSwgZSk7CiAgICAgICAgdGhyb3cgZTsgLy8gUmUtdGhyb3cgdGhlIG9yaWdpbmFsIGVycm9yCiAgICAgIH0KICAgIH0KICB9OwoKICBjb25zdCBfcmVtb3ZlID0gKGtleSkgPT4gewogICAgdHJ5IHsKICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGxvZ2dlci5sb2dFdmVudCgiZXJyb3IiLCBgTG9jYWxTdG9yYWdlIFJFTU9WRSBFcnJvcjogJHtrZXl9YCwgZSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9OwoKICBjb25zdCBnZXRBcnRpZmFjdEtleSA9IChhcnRpZmFjdElkLCB2ZXJzaW9uID0gImxhdGVzdCIpID0+IHsKICAgIC8vIFVzaW5nIHNpbXBsZSBjb25jYXRlbmF0aW9uLCBlbnN1cmluZyBwYXJ0cyBhcmUgdmFsaWQgc3RyaW5ncwogICAgaWYgKAogICAgICAhYXJ0aWZhY3RJZCB8fAogICAgICB0eXBlb2YgYXJ0aWZhY3RJZCAhPT0gInN0cmluZyIgfHwKICAgICAgdHlwZW9mIHZlcnNpb24gIT09ICJzdHJpbmciCiAgICApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgIGBJbnZhbGlkIGFyZ3VtZW50cyBmb3IgZ2V0QXJ0aWZhY3RLZXk6IElEPSR7YXJ0aWZhY3RJZH0sIFZlcnNpb249JHt2ZXJzaW9ufWAKICAgICAgKTsKICAgIH0KICAgIC8vIEJhc2ljIHNhbml0aXphdGlvbjogcmVwbGFjZSBwb3RlbnRpYWxseSBwcm9ibGVtYXRpYyBjaGFycyBsaWtlICc6JyBvciAnLycKICAgIGNvbnN0IGNsZWFuSWQgPSBhcnRpZmFjdElkLnJlcGxhY2UoL1s6L10vZywgIl8iKTsKICAgIGNvbnN0IGNsZWFuVmVyc2lvbiA9IHZlcnNpb24ucmVwbGFjZSgvWzovXS9nLCAiXyIpOwogICAgcmV0dXJuIGAke0xTX1BSRUZJWH1hcnRpZmFjdDoke2NsZWFuSWR9OiR7Y2xlYW5WZXJzaW9ufWA7CiAgfTsKCiAgY29uc3QgZ2V0QXJ0aWZhY3RDb250ZW50ID0gKGFydGlmYWN0SWQsIHZlcnNpb24gPSAibGF0ZXN0IikgPT4gewogICAgcmV0dXJuIF9nZXQoZ2V0QXJ0aWZhY3RLZXkoYXJ0aWZhY3RJZCwgdmVyc2lvbikpOwogIH07CgogIGNvbnN0IHNldEFydGlmYWN0Q29udGVudCA9IChhcnRpZmFjdElkLCB2ZXJzaW9uID0gImxhdGVzdCIsIGNvbnRlbnQpID0+IHsKICAgIC8vIEltcG9ydGFudDogVXNlIHRoZSBzYW1lIGtleSBnZW5lcmF0aW9uIGxvZ2ljIGFzIGdldEFydGlmYWN0Q29udGVudAogICAgY29uc3Qga2V5ID0gZ2V0QXJ0aWZhY3RLZXkoCiAgICAgIGFydGlmYWN0SWQsCiAgICAgIHZlcnNpb24uZW5kc1dpdGgoIi5qcyIpIHx8IHZlcnNpb24uZW5kc1dpdGgoIi5qc29uIikKICAgICAgICA/IHZlcnNpb24KICAgICAgICA6IGAke3ZlcnNpb259LmltcGwuanNgCiAgICApOyAvLyBBZGp1c3QgYmFzZWQgb24gaG93IHZlcnNpb24gaXMgdXNlZAogICAgaWYgKHZlcnNpb24gPT09ICJtY3AuanNvbiIgfHwgdmVyc2lvbiA9PT0gImltcGwuanMiKSB7CiAgICAgIGtleSA9IGdldEFydGlmYWN0S2V5KGFydGlmYWN0SWQsIHZlcnNpb24pOwogICAgfSBlbHNlIHsKICAgICAgLy8gRmFsbGJhY2sgb3IgZGVmYXVsdCBpZiBvbmx5IElEIGFuZCBjb250ZW50IGFyZSBwYXNzZWQKICAgICAga2V5ID0gZ2V0QXJ0aWZhY3RLZXkoYXJ0aWZhY3RJZCwgImxhdGVzdCIpOwogICAgfQoKICAgIHJldHVybiBfc2V0KGtleSwgY29udGVudCk7CiAgfTsKCiAgY29uc3QgZGVsZXRlQXJ0aWZhY3QgPSAoYXJ0aWZhY3RJZCwgdmVyc2lvbiA9ICJsYXRlc3QiKSA9PiB7CiAgICAvLyBBbGxvdyBkZWxldGluZyBzcGVjaWZpYyB2ZXJzaW9ucyBsaWtlICJtY3AuanNvbiIgb3IgImltcGwuanMiIGRpcmVjdGx5CiAgICBjb25zdCBrZXkgPSBnZXRBcnRpZmFjdEtleShhcnRpZmFjdElkLCB2ZXJzaW9uKTsKICAgIHJldHVybiBfcmVtb3ZlKGtleSk7CiAgfTsKCiAgY29uc3QgbGlzdEFydGlmYWN0cyA9ICgpID0+IHsKICAgIGNvbnN0IGFydGlmYWN0cyA9IFtdOwogICAgY29uc3QgcHJlZml4ID0gYCR7TFNfUFJFRklYfWFydGlmYWN0OmA7CiAgICB0cnkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxvY2FsU3RvcmFnZS5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IGxvY2FsU3RvcmFnZS5rZXkoaSk7CiAgICAgICAgaWYgKGtleT8uc3RhcnRzV2l0aChwcmVmaXgpKSB7CiAgICAgICAgICBjb25zdCBwYXJ0cyA9IGtleS5zdWJzdHJpbmcocHJlZml4Lmxlbmd0aCkuc3BsaXQoIjoiKTsKICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPj0gMikgewogICAgICAgICAgICAvLyBFeHBlY3RpbmcgSUQ6dmVyc2lvbiBhdCBsZWFzdAogICAgICAgICAgICBjb25zdCBpZCA9IHBhcnRzWzBdOwogICAgICAgICAgICBjb25zdCB2ZXJzaW9uID0gcGFydHMuc2xpY2UoMSkuam9pbigiOiIpOyAvLyBSZWpvaW4gaWYgdmVyc2lvbiBoYWQgJzonCiAgICAgICAgICAgIGFydGlmYWN0cy5wdXNoKHsgaWQ6IGlkLCB2ZXJzaW9uOiB2ZXJzaW9uLCBrZXk6IGtleSB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxvZ2dlci5sb2dFdmVudCgid2FybiIsIGBGb3VuZCBtYWxmb3JtZWQgYXJ0aWZhY3Qga2V5OiAke2tleX1gKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJlcnJvciIsICJGYWlsZWQgdG8gbGlzdCBhcnRpZmFjdHMgZnJvbSBsb2NhbFN0b3JhZ2UiLCBlKTsKICAgIH0KICAgIHJldHVybiBhcnRpZmFjdHM7CiAgfTsKCiAgY29uc3QgZ2V0U3RhdGUgPSAoKSA9PiB7CiAgICBjb25zdCBqc29uID0gX2dldChzdGF0ZUtleSk7CiAgICBpZiAoIWpzb24pIHJldHVybiBudWxsOwogICAgdHJ5IHsKICAgICAgcmV0dXJuIEpTT04ucGFyc2UoanNvbik7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGxvZ2dlci5sb2dFdmVudCgKICAgICAgICAiZXJyb3IiLAogICAgICAgIGBGYWlsZWQgdG8gcGFyc2Ugc3RhdGUgZnJvbSBsb2NhbFN0b3JhZ2U6ICR7ZS5tZXNzYWdlfS4gUmVtb3ZpbmcgaW52YWxpZCBzdGF0ZS5gCiAgICAgICk7CiAgICAgIF9yZW1vdmUoc3RhdGVLZXkpOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9OwoKICBjb25zdCBzYXZlU3RhdGUgPSAoc3RhdGVPYmopID0+IHsKICAgIGlmICghc3RhdGVPYmogfHwgdHlwZW9mIHN0YXRlT2JqICE9PSAib2JqZWN0IikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgc3RhdGUgb2JqZWN0IHByb3ZpZGVkIHRvIHNhdmVTdGF0ZS4iKTsKICAgIH0KICAgIHRyeSB7CiAgICAgIGNvbnN0IHN0YXRlU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoc3RhdGVPYmopOwogICAgICByZXR1cm4gX3NldChzdGF0ZUtleSwgc3RhdGVTdHJpbmcpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBsb2dnZXIubG9nRXZlbnQoImVycm9yIiwgIkZhaWxlZCB0byBzYXZlIHN0YXRlIiwgZSk7CiAgICAgIC8vIFJlLXRocm93IHNwZWNpZmljIFF1b3RhRXhjZWVkZWRFcnJvciBpZiBjYXVnaHQgYnkgX3NldAogICAgICBpZiAoZS5tZXNzYWdlLmluY2x1ZGVzKCJRdW90YSBFeGNlZWRlZCIpKSB7CiAgICAgICAgdGhyb3cgZTsKICAgICAgfQogICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBzYXZlIHN0YXRlOiAke2UubWVzc2FnZX1gKTsKICAgIH0KICB9OwoKICBjb25zdCByZW1vdmVTdGF0ZSA9ICgpID0+IHsKICAgIHJldHVybiBfcmVtb3ZlKHN0YXRlS2V5KTsKICB9OwoKICAvLyBTZXNzaW9uIHN0YXRlIGZ1bmN0aW9ucyByZW1vdmVkIGFzIEFQSSBrZXkgaXMgaGFuZGxlZCBkaXJlY3RseSBieSBTdGF0ZU1hbmFnZXIgbm93LgoKICBjb25zdCBjbGVhckFsbFJlcGxvaWREYXRhID0gKCkgPT4gewogICAgbG9nZ2VyLmxvZ0V2ZW50KCJ3YXJuIiwgIkluaXRpYXRpbmcgc3RvcmFnZSBjbGVhciBmb3IgRHJlYW1lciBkYXRhLiIpOwogICAgbGV0IGtleXNUb1JlbW92ZSA9IFtdOwogICAgbGV0IHJlbW92ZWRDb3VudCA9IDA7CiAgICB0cnkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxvY2FsU3RvcmFnZS5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IGxvY2FsU3RvcmFnZS5rZXkoaSk7CiAgICAgICAgaWYgKAogICAgICAgICAga2V5ICYmCiAgICAgICAgICAoa2V5LnN0YXJ0c1dpdGgoTFNfUFJFRklYKSB8fAogICAgICAgICAgICBrZXkgPT09IHN0YXRlS2V5IHx8CiAgICAgICAgICAgIGtleSA9PT0gInNlc3Npb25LZXkiKSAvKiBvbGQgc2Vzc2lvbiBrZXkgKi8KICAgICAgICApIHsKICAgICAgICAgIGtleXNUb1JlbW92ZS5wdXNoKGtleSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGtleXNUb1JlbW92ZS5mb3JFYWNoKChrZXkpID0+IHsKICAgICAgICBpZiAoX3JlbW92ZShrZXkpKSB7CiAgICAgICAgICByZW1vdmVkQ291bnQrKzsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBsb2dnZXIubG9nRXZlbnQoCiAgICAgICAgImluZm8iLAogICAgICAgIGBSZW1vdmVkICR7cmVtb3ZlZENvdW50fSBrZXlzIGZyb20gbG9jYWxTdG9yYWdlLmAKICAgICAgKTsKCiAgICAgIHRyeSB7CiAgICAgICAgc2Vzc2lvblN0b3JhZ2UuY2xlYXIoKTsgLy8gQ2xlYXIgc2Vzc2lvbiBzdG9yYWdlIHRvbwogICAgICAgIGxvZ2dlci5sb2dFdmVudCgiaW5mbyIsICJDbGVhcmVkIFNlc3Npb25TdG9yYWdlLiIpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgbG9nZ2VyLmxvZ0V2ZW50KCJ3YXJuIiwgIkZhaWxlZCB0byBjbGVhciBTZXNzaW9uU3RvcmFnZS4iLCBlKTsKICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICBsb2dnZXIubG9nRXZlbnQoImVycm9yIiwgYEVycm9yIGR1cmluZyBjbGVhckFsbFJlcGxvaWREYXRhYCwgZSk7CiAgICB9CiAgICByZXR1cm4gcmVtb3ZlZENvdW50OwogIH07CgogIHJldHVybiB7CiAgICBMU19QUkVGSVgsCiAgICBnZXRBcnRpZmFjdEtleSwKICAgIGdldEFydGlmYWN0Q29udGVudCwKICAgIHNldEFydGlmYWN0Q29udGVudCwKICAgIGRlbGV0ZUFydGlmYWN0LAogICAgbGlzdEFydGlmYWN0cywKICAgIGdldFN0YXRlLAogICAgc2F2ZVN0YXRlLAogICAgcmVtb3ZlU3RhdGUsCiAgICAvLyBObyBzZXNzaW9uIHN0YXRlIG1ldGhvZHMgZXhwb3J0ZWQKICAgIGNsZWFyQWxsUmVwbG9pZERhdGEsCiAgICBnZXRTdG9yYWdlVXNhZ2UsCiAgfTsKfTsKCmV4cG9ydCBkZWZhdWx0IFN0b3JhZ2VNb2R1bGU7Cg==
--- CATS_END_FILE ---
